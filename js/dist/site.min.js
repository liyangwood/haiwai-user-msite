"use strict";!function(e,t,i){var n=e();e.fn.dropdownHover=function(i){return n=n.add(this.parent()),this.each(function(){var i,a=e(this).parent(),o={delay:500,instantlyCloseOthers:!0},r={delay:e(this).data("delay"),instantlyCloseOthers:e(this).data("close-others")},s=e.extend(!0,{},o,s,r);a.hover(function(){s.instantlyCloseOthers===!0&&n.removeClass("open"),t.clearTimeout(i),e(this).addClass("open")},function(){i=t.setTimeout(function(){a.removeClass("open")},s.delay)})})}}(jQuery,this),function(){this.KG&&(this._KG=KG),this.KG={}}.call(window),function(){var e="http://beta.haiwai.com";KG.config={root:"/haiwai-user-msite",SiteRoot:e,ApiRoot:e+"/service/api/",MD5_KEY:"m.y^w8oP01K#gs",GoogleMapApiKey:"AIzaSyCjKJoA5eBc75v5pQurBQ3IjP4vNkfoOzw",WeixinAppID:"wx4c519e506d840934",WeixinAppSecret:"a160e78f682317dbf6ed8ffe4e56bc30",WeixinLoginRedirectUrl:"http://beta.haiwai.com/pc/page/site/index.html",SJAPP_AppleStore_Url:"https://itunes.apple.com/us/app/hai-wai-tong-cheng-shang-jia/id974815137"},KG.Const={},KG["default"]={BizBigBgPic:"../../image/default_bg_pic.png",articleImage:KG.config.SiteRoot+"/images/lifetools_default_article.png",couponImage:KG.config.SiteRoot+"/images/default_event_logo.png",storeImage:"../../image/store_default.png"};var t={image:"http://www.sinomedianet.com/haiwai2015.3.19/images/default_avatar.png",defaultImage:"http://www.sinomedianet.com/haiwai2015.3.19/images/default_avatar.png",email:"",userid:14678,tel:"",token:"",isLogin:!0};KG.user={get:function(e){return e?t[e]:t},reset:function(){t=_.extend(t,{image:"",email:"",userid:"",token:"",isLogin:!1})},logout:function(){var e={act:"logout",func:"passport"};return e=util.addUserIdToRequestData(e),KG.request.ajax(e,function(e,t){e&&(KG.user.reset(),util.storage.set("current-login-user",null),location.reload())})},getUserDetailWithToken:function(e,i){e.pk_id&&(t.userid=e.pk_id,t.token=e.token,t.email=e.email,KG.request.getUserDetailInfo({},function(e,n){e&&(t.image=n.avatar_url,/^http/.test(t.image)&&(t.image=KG.config.SiteRoot+t.image),t.isLogin=!0,_.extend(t,n),util.storage.set("current-login-user",t),i(t))}))},login:function(e,t,i){var n=function(e,n){n.pk_id?KG.user.getUserDetailWithToken(n,t):i(n.msg?n.msg:n)};KG.request.login(e,n,i)},register:function(e,t,i){return KG.request.register(e,t,i)},update:function(){KG.request.getUserDetailInfo({},function(e,i){e&&(t.image=i.avatar_url,/^http/.test(t.image)&&(t.image=KG.config.SiteRoot+t.image),t.isLogin=!0,_.extend(t,i),util.storage.set("current-login-user",t))})},checkLogin:function(e){e=e||function(){};var i=util.storage.get("current-login-user");i&&i.token?(_.extend(t,i),KG.request.checkLogin({},function(i,n){i?(t.image=KG.config.SiteRoot+n.avatar_url,_.extend(t,n),t.isLogin=!0,e()):(KG.user.reset(),e())})):(KG.user.reset(),e())}};var i={};KG.data={get:function(e){return e?i[e]:i},add:function(e){util.extend(i,e||{})}}}();
!function(){function t(t){return a[t]||null}function e(){return"IObject.random-"+i++}"function"!=typeof Object.create&&(Object.create=function(t){var e=function(){};return e.prototype=t,new e});var n={extend:function(t,e){return e=e||!1,$.extend(e,this,t),this},proxy:function(t,e){return $.isArray(e)||(e=Array.prototype.slice.call(arguments,1)),t.apply(this,e)},call:function(t,e,n){return $.isArray(n)||(n=Array.prototype.slice.call(arguments,2)),e.apply(t,n)},getParent:function(t){var e=this.__base,n=this.__name;if(!t&&!n)return e;for(;e;){if(t&&e.__name===t)return e;if(n!==e.__name)return e;e=e.__base}return e},callParent:function(t,e,n){"string"!=typeof e&&(n=e,e=null);var r,a,i=null;return r=e?this.getParent(e):this.__base||this,r&&(a=r.fn[t],i=a.apply(this,n)),i}},r=function(t,e){return $.extend(t,e)},a={},i=0,o=function(i,o){var s=arguments;"string"!=typeof i?(o=s[0],i=e()):t(i)&&alert(i+" is already exist");var c=null;if(o.ParentClass&&(c=o.ParentClass,delete o.ParentClass),c&&"string"==typeof c&&(c=t(c),!c))throw console.log(o,i),o.ParentClass+" is not exist";var u=function(){this._init&&this._init.apply(this,arguments)};return o.Static&&(u._static=o.Static,delete o.Static),c?(u.prototype=Object.create(c.prototype||c),u.prototype.__base=c,u.prototype.constructor=u,u.prototype.__static=u._static):u.prototype.fn=o,u.fn=u.prototype,$.extend(u.fn,n),o&&r(u.fn,o),u.fn.__type="IObject",u.fn.__name=i,a[i]=u,u},s={define:o,getByName:t,getAll:function(){return a}};KG.Class=s}();
"use strict";!function(){var e=1,t={};_.extend(t,_),t.extend(t,{addUserIdToRequestData:function(e){return e=e||{},e.userid=KG.user.get("userid"),e.token=KG.user.get("token"),e},formatDate:function(e,t){function o(e){return 10>e?"0"+e:e}10===e.toString().length&&(e=1e3*parseInt(e));var i=new Date(e),n=i.getFullYear(),a=o(i.getMonth()+1),r=o(i.getDate()),l=o(i.getHours()),s=o(i.getMinutes()),c=o(i.getSeconds());return t.replace("yy",n).replace("mm",a).replace("dd",r).replace("h",l).replace("m",s).replace("s",c)},getUuid:function(){return"uuid_"+e++},uploadImage:function(e,t){if(e){var o=new FileReader;o.onload=function(e){var o=e.target.result;KG.request.uploadImage({image:o},function(e,o){e&&t(o.files[0])})},o.readAsDataURL(e)}},readFile:function(e,t){var o=new FileReader;o.onload=function(e){var o=e.target.result;t(o)},o.readAsDataURL(e)},getQrCode:function(e,t){return t=t||240,"http://api.qrserver.com/v1/create-qr-code/?size="+t+"x"+t+"&data="+encodeURIComponent(e)},showPageLoading:function(e){e=e||!1,e?$("#fakeLoader").show().fakeLoader({timeToHide:2e4,spinner:"spinner7",bgColor:"rgba(0,0,0,0)"}):$("#fakeLoader").hide()},loading:function(e){e=e||!1,e?$("#fakeLoader1").show().fakeLoader({timeToHide:5e4,spinner:"spinner7",bgColor:"rgba(0,0,0,0)"}):$("#fakeLoader1").hide()},replaceHtmlImgSrcToAbsolute:function(e){var t=new RegExp("<img.*src=(\"|')([^\"']+)(\"|')\\s*([\\w]+=(\"|')([^\"']*)(\"|')\\s*)*/>","g");return e.replace(t,function(e){console.log(e);var t=arguments[2];return/^http/.test(t)?e:e.replace(t,KG.config.SiteRoot+t)})},removeHtmlTag:function(e){return e.replace(/<([^>]*)>/g,"")},getLatAndLongWithAddress:function(e,t){var o="https://maps.googleapis.com/maps/api/geocode/json?address="+e+"&key="+KG.config.GoogleMapApiKey;$.getJSON(o,{},function(e){"OK"===e.status&&t(e.results[0].geometry.location)})}}),t.cookie={get:function(e){var t,o=new RegExp("(^| )"+e+"=([^;]*)(;|$)","gi");return(t=o.exec(unescape(document.cookie)))?t[2]:null},set:function(e,t,o,i,n){i=i||"/",o=o||"never";var a=e+"="+escape(t);if(o){"never"==o&&(o=5256e4);var r=new Date;r.setTime(r.getTime()+60*o*1e3),a+="; expires="+r.toGMTString()}i&&(a+="; path="+i),n&&(a+="; domain="+n),document.cookie=a},remove:function(e,t,o){document.cookie=e+"="+(t?"; path="+t:"")+(o?"; domain="+o:"")+"; expires="+new Date(0).toGMTString()}},t.dom={scrollTo:function(e){var t=$(window);t.scrollTop(e)},showErrorPopover:function(e,t,o){var i="#ff0000";return t===!1?void e.popover("destroy"):(o=o||{},void e.popover({placement:o.placement||"bottom",html:!0,trigger:o.trigger||"click",content:'<span style="color:'+i+'">'+t+"</span>"}).popover("show"))}};var o={};t.message={register:function(e,t){var i=function(i,n){n=o[e]?o[e].data:n,t(i,n)};if($("body").unbind(e).bind(e,i),o[e]){var n=o[e];t(null,n.data)}},publish:function(e,t){o[e]={data:t},$("body").trigger(e,t)}},t.dialog={init:function(){var e=['<div class="modal fade" id="kg_modal_dialog" tabindex="-1" role="dialog">','<div class="modal-dialog" role="document">','<div class="modal-content box">',"</div>","</div>","</div>"].join("");e=$(e),e.on("hidden.bs.modal",function(){var t=e.find(".box");t.find(".js_yes").unbind("click"),t.find(".js_no").unbind("click"),t.empty()}),e.appendTo("body")},get:function(e){$("#kg_modal_dialog").length<1&&t.dialog.init();var o=$("#kg_modal_dialog");if(!e)return o;var i=t.extend({title:"信息提示",body:"点击确认，我们将为您删除这个店铺的所有信息，包括基本信息，图片，店铺评级和评论等，并且不能再找回这些信息，请谨慎操作。",foot:!0,type:"confirm",YesText:"确认",YesFn:t.noop,NoText:"取消",NoFn:function(e){e()},end:null},e),n=['{{if type!=="toast"}}','<div class="modal-header">','<button type="button" class="close" data-dismiss="modal" aria-label="Close"><i class="fa fa-times"></i></button>',"</div>","{{/if}}",'<div class="modal-body">',"{{if title}}",'<h4 class="hw-title">{{#title}}</h4>',"{{/if}}",'{{if body}}<div class="hw-body">{{#body}}</div>{{/if}}',"</div>","{{if foot}}",'<div class="modal-footer">','<button type="button" class="hw-btn hw-light-btn js_no">{{NoText}}</button>','{{if YesText}}<button type="button" class="hw-btn hw-blue-btn js_yes">{{YesText}}</button>{{/if}}',"</div>","{{/if}}"].join("");return n=template.compile(n)(i),o.find(".box").html(n),o.find(".js_yes").click(function(e){i.YesFn(function(){t.dialog.hide()},e)}),o.find(".js_no").click(function(e){i.NoFn(function(){t.dialog.hide()},e)}),o.attr("class","modal fade"),e["class"]&&o.addClass(e["class"]),o},show:function(e){var o=t.dialog.get(e);e.beforeShowFn&&e.beforeShowFn.call(o),$("body").hasClass("modal-open")?o.addClass("in"):o.modal("show")},hide:function(){var e=t.dialog.get();e.modal("hide")},showImageList:function(e,o){var i=['<div class="js_box">',"{{each list as item index}}",'<div role="BaseLoadingImageBox" param="{{index}}" data-url="{{item}}" class="img-item"></div>',"{{/each}}","</div>"].join("");i=template.compile(i)({list:e}),t.dialog.show({body:i,foot:!1,"class":"hw-dialog-imglist",title:"("+e.length+")"});var n=t.dialog.get();KG.component.init(n.find(".js_box")),n.find(".js_box").on("click",".img-item",function(){var e=$(this).attr("param");return o(e),!1})},showFocusImage:function(e,o){var i=['<div id="cb_cccc" class="carousel slide" data-ride="carousel">','<ol class="carousel-indicators">',"{{each list}}",'<li data-target="#cb_cccc" data-slide-to="{{$index}}" class="{{if index==$index}}active{{/if}}"></li>',"{{/each}}","</ol>",'<div class="carousel-inner" role="listbox">',"{{each list as url}}",'<div class="item {{if index==$index}}active{{/if}}">','<img src="{{url}}">',"</div>","{{/each}}","</div>",'<a class="left carousel-control" href="#cb_cccc" role="button" data-slide="prev">','<span class="glyphicon glyphicon-chevron-left glyphicon-menu-left" aria-hidden="true"></span>','<span class="sr-only">Previous</span>',"</a>",'<a class="right carousel-control" href="#cb_cccc" role="button" data-slide="next">','<span class="glyphicon glyphicon-chevron-right glyphicon-menu-right" aria-hidden="true"></span>','<span class="sr-only">Next</span>',"</a>","</div>"].join("");return i=template.compile(i)({list:o,index:e}),t.dialog.show({body:i,foot:!1,"class":"hw-carousel",title:""}),t.dialog.get()},confirm:function(e){var o={title:e.msg,body:!1,NoText:"取消",YesText:e.YesText||"确认","class":"hw-confirm",YesFn:e.YesFn};e.title&&(o.title=e.title,o.body=e.msg),t.dialog.show(o)},confirm1:function(e){var o={title:e.msg,body:!1,NoText:"取消",YesText:e.YesText||"确认","class":"hw-confirm1",YesFn:e.YesFn};t.dialog.show(o)},showQrCode:function(e,o){var i='<div class="hw-qr"><img src="'+t.getQrCode(e,200)+'" /></div>';t.dialog.show({body:i,title:o||"打开微信扫一扫以下二维码即可打开本店页面，点击屏幕右上角分享按钮",foot:!1,"class":"hw-dialog-qrcode"})},showWeixinLoginQrCode:function(e){var o='<div class="hw-qr" id="js_weixin_qr"></div>';return t.dialog.show({body:o,title:"",foot:!1,"class":"hw-dialog-qrcode"}),console.log(e),new WxLogin({id:"js_weixin_qr",appid:KG.config.WeixinAppID,scope:"snsapi_login",redirect_uri:encodeURIComponent(e),state:"aaa",style:"black",href:""})},showLoginBox:function(e){var o={foot:!1,"class":"hw-dialog-login",body:'<div class="js_role" role="HWLoginRegBoxComp" data-type="login"></div>',beforeShowFn:function(){var e=this;KG.component.initWithElement(e.find(".js_role"))}};t.dialog.show(o)},showRegBox:function(e){var o={foot:!1,"class":"hw-dialog-login",body:'<div class="js_role" role="HWLoginRegBoxComp" data-type="reg"></div>',beforeShowFn:function(){var e=this;KG.component.initWithElement(e.find(".js_role"))}};t.dialog.show(o)},alert:function(e,o){t.dialog.show({foot:!1,title:e,body:"<p>"+o+"</p>","class":"hw-dialog-alert"})},showCouponDetail:function(e){var o={foot:!1,title:"","class":"hw-dialog-coupon",body:'<div class="js_role" role="HWSiteCouponDetailComp" data-coupon="'+e+'"></div>',beforeShowFn:function(){var e=this;KG.component.initWithElement(e.find(".js_role"))}};t.dialog.show(o)},showSelectLocationRegion:function(){var e={foot:!1,title:"选择地区","class":"hw-dialog-region",body:'<div class="js_role" role="HWSelectRegionLocation"></div>',beforeShowFn:function(){var e=this;KG.component.initWithElement(e.find(".js_role"))}};t.dialog.show(e)}},t.alert=function(e){t.dialog.alert(e)},t.toast={showError:function(e,o){var i='<div class="hw-icon" style="border: none;"><i style="color: #f4a62a; top:4px;font-size:32px;" class="fa fa-exclamation-circle"></i></div>';t.dialog.alert(i+e,"")},alert:function(e,o){o=o||"";var i='<div class="hw-icon"><i class="fa fa-check"></i></div>';t.dialog.alert(i+e,o),t.delay(function(){try{t.dialog.hide()}catch(e){}},3e3)}},t.url={param:function(e,t){t=t||location.search,e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var o=new RegExp("[\\?&]"+e+"=([^&#]*)"),i=o.exec(t);return null===i?"":decodeURIComponent(i[1].replace(/\+/g," "))},hash:function(){return location.hash.replace(/^#/,"")}},t.storage={set:function(e,o,i){i=t.extend({expires:"max"},i||{});var n=JSON.stringify({data:o});window.localStorage.setItem(e,n)},get:function(e){var t=window.localStorage.getItem(e);return t?JSON.parse(t).data:null}},t.path={go:function(e){location.href=e},article:function(e){return"../view/article.html?id="+e},store:function(e){return"../view/store.html?id="+e},toMSiteStore:function(e){return KG.config.SiteRoot+"/mobile/ionic/store.html?id="+e},toMSiteArticle:function(e){return KG.config.SiteRoot+"/mobile/ionic/article.html?id="+e},toMSiteCoupon:function(e){return KG.config.SiteRoot+"/mobile/ionic/action.html?id="+e}},t.validate={email:function(e){var t=/^(?:[\w\!\#\$\%\&\'\*\+\-\/\=\?\^\`\{\|\}\~]+\.)*[\w\!\#\$\%\&\'\*\+\-\/\=\?\^\`\{\|\}\~]+@(?:(?:(?:[a-zA-Z0-9](?:[a-zA-Z0-9\-](?!\.)){0,61}[a-zA-Z0-9]?\.)+[a-zA-Z0-9](?:[a-zA-Z0-9\-](?!$)){0,61}[a-zA-Z0-9]?)|(?:\[(?:(?:[01]?\d{1,2}|2[0-4]\d|25[0-5])\.){3}(?:[01]?\d{1,2}|2[0-4]\d|25[0-5])\]))$/;return t.test(e)},AmericanPhone:function(e){var t=/^[0-9]{10}$/;return t.test(e)}},window.util=KG.util=t,!t.url.param("debug")}(),function(){template.helper("equal",function(e,t){return e===t}),template.helper("absImage",function(e){return/^http/.test(e)?e:KG.config.SiteRoot+e}),template.helper("formatDate",function(e,t){return util.formatDate(e,t||"yy年mm月dd日 h:m:s")}),template.helper("storeFullAddress",function(e){var t="";return e.address&&(t+=e.address+", "),e.city&&(t+=e.city+", "),e.state&&(t+=e.state.toUpperCase()+" "),e.zip&&(t+=e.zip),t}),template.helper("storeFullAddress1",function(e){return e.address_t+", "+e.city+", "+e.state+" "+e.zip}),template.helper("defaultUserImage",function(e){return e?e:KG.user.get("defaultImage")}),template.helper("decode",function(e){if(!e)return"";var t;try{t=decodeURIComponent(e)}catch(o){t=e}return t}),template.helper("htmlToText",function(e){var t="";try{t=decodeURIComponent(e).replace(/<([^>]*)>/g,"")}catch(o){t=e.replace(/<([^>]*)>/g,"")}return t}),template.helper("toArticlePath",function(e){return util.path.article(e)}),template.helper("toStorePath",function(e){return util.path.store(e)}),template.helper("logoPath",function(e){var t=e.logo[0].path;return/^http/.test(t)?t:KG.config.SiteRoot+t})}(),$(function(){window.fbAsyncInit=function(){FB.init({appId:"250258495319287",cookie:!0,xfbml:!0,version:"v2.5"})},function(e,t,o){var i,n=e.getElementsByTagName(t)[0];e.getElementById(o)||(i=e.createElement(t),i.id=o,i.src="//connect.facebook.net/en_US/sdk.js",n.parentNode.insertBefore(i,n))}(document,"script","facebook-jssdk");var e=["email","first_name","last_name","name","gender","picture"].join(",");window.util.Facebook={getTokenWithData:function(e,t){alert(JSON.stringify(e)),t()},login:function(t){FB.login(function(o){console.log(o),"connected"===o.status?FB.api("/me",function(e){console.log(e),util.Facebook.getTokenWithData(e,t)},{fields:e}):(util.toast.showError("登录失败"),_.delay(function(){location.reload()},2e3))})}}});
KG.request={ajax:function(t,e,a){var i=KG.config.ApiRoot+"?format=json",n=t.method||"get";delete t.method;var r=$.Deferred();t.url&&(i+="&"+t.url,delete t.url),"post"===n&&(i+="&func="+t.func,i+="&act="+t.act);var d="json";return t.jsonp&&(d="jsonp",delete t.jsonp),$.ajax({type:n,url:i,data:t,dataType:d,success:function(t){e&&e.call(null,t.status>0,t["return"]),r.resolve(t["return"])},error:function(t){a&&a(t),r.reject(t)}}),r},defer:function(t,e,a){var i=[];util.each(t,function(t){i.push(t())}),$.when.apply($,i).then(e,a)},mockData:function(t,e,a){var i=$.Deferred();return util.delay(function(){e&&e(!0,t),i.resolve(t)},500),i},getBizList:function(t,e,a){var i={func:"biz",userid:KG.user.get("userid"),detail:1,token:KG.user.get("token")};return this.ajax(i,e,a)},getBizDetailById:function(t,e,a){var i={func:"biz",act:"view",bizid:t.bizId,userid:KG.user.get("userid"),token:KG.user.get("token")};return this.ajax(i,e,a)},getBizCouponList:function(t,e,a){var i=[{id:123,logo:"/images/165/118/upload/classifiedinfo/19/f9/05/19f905692cf998e30745e31e9f3d28e9.jpg",title:"全场满100元送午餐券",count:100,bizInfo:{name:"小肥羊Fremont店",address:"Fremont, CA 98765"},stop:!0,startTime:1449772731230,endTime:1449772831230},{id:234,logo:"/images/165/118/upload/classifiedinfo/19/f9/05/19f905692cf998e30745e31e9f3d28e9.jpg",title:"全场满100元送午餐券",count:100,bizInfo:{name:"小肥羊Fremont店",address:"Fremont, CA 98765"},startTime:1449772731230,endTime:1449772831230}];return this.mockData(i,e,a)},getSystemMessageList:function(t,e,a){var i={func:"sysmsg"};return util.addUserIdToRequestData(i),console.log(i),this.ajax(i,e,a)},getSystemMessageDetail:function(t,e,a){var i={func:"sysmsg",act:"view",id:t.id};return util.addUserIdToRequestData(i),this.ajax(i,e,a)},deleteSystemMessageById:function(t,e,a){var i={func:"sysmsg",act:"delete"};return t.id?i["id[1]"]=t.id:t.ids&&util.each(t.ids,function(t,e){i["id["+(e+1)+"]"]=t}),util.addUserIdToRequestData(i),this.ajax(i,e,a)},uploadImage:function(t,e,a){var i={func:"article",act:"upload",method:"post",type:"image","uploadfield[]":t.image};return this.ajax(i,e,a)},uploadUserImage:function(t,e,a){var i={func:"passport",method:"post",act:"upload","uploadfield[]":t.image};return i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},getAllAddressAreaInfo:function(t,e,a){var i={func:"biz",act:"get_allregion"};return this.ajax(i,e,a)},getUserDetailInfo:function(t,e,a){var i={act:"getuser",check:md5(KG.config.MD5_KEY+KG.user.get("userid")),func:"passport",userid:KG.user.get("userid")};return this.ajax(i,function(t,a){e(!0,a[i.userid])},a)},getAllStoreCategoryList:function(t,e,a){var i={func:"biz",act:"tags"};return this.ajax(i,e,a)},getAllStoreTagByCategory:function(t,e,a){var i={func:"biz",act:"taglist",biztagid:t.catId};return this.ajax(i,e,a)},getMyfavStoreList:function(t,e,a){var i={func:"biz",act:"bookmark"};return t.is_active&&(i.is_active="1"),t.not_open&&(i.visible="-1"),i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},deleteMyFavStore:function(t,e,a){var i={func:"biz",act:"delete_bookmark",type:"biz",id:t.id,entityID:t.bizId};return i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},deleteMyFavCoupon:function(t,e,a){var i={func:"biz",act:"delete_bookmark",type:"classifiedinfo",id:t.id,entityID:t.id};return i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},getMycouponList:function(t,e,a){var i={func:"event",act:"bookmark"};return t.is_active&&(i.is_active="1"),t.not_active&&(i.is_active="0"),util.addUserIdToRequestData(i),this.ajax(i,e,a)},getSiteArticleList:function(t,e,a){var i={func:"view",act:"article_list",category_id:t.category};return"hot"===i.category_id&&delete i.category_id,t.lastid&&(i.lastid=t.lastid),this.ajax(i,e,a)},sendSmsToUserPhone:function(t,e,a){var i={func:"sms",act:"send_event",number:t.number,biz_name:encodeURIComponent(t.biz_name),event_title:encodeURIComponent(t.event_title),entityID:t.id};return util.addUserIdToRequestData(i),this.ajax(i,e,a)},modifyUserInfo:function(t,e,a){var i={func:"passport",act:"update",nick:t.nickname,region:t.region,contact_email:t.contact_email||"",email:t.email,tel:t.tel,wechat:t.wechat,signature:t.description};return i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},createStoreByStep1:function(t,e,a){var i={func:"biz",act:"pc_add",step:1,bizname:t.bizName,biztel:t.bizTel,biztagid:t.bizTagId,sec_tags:t.tags,address:t.address,city:t.city,state:t.state,zip:t.zip};return t.timeinfo&&_.isArray(t.timeinfo)&&_.each(t.timeinfo,function(t,e){i["timeinfo["+e+"][daytime]"]=t.daytime.join(","),i["timeinfo["+e+"][weektime]"]=t.weektime.join(",")}),i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},saveStoreByStep1:function(t,e,a){var i={func:"biz",act:"update",bizid:t.bizId,biztagid:t.bizTagId,name_cn:t.bizName,city:t.city,state:t.state,zip:t.zip,address:t.address,tel:t.bizTel,sec_tags:t.tags};return t.timeinfo&&_.isArray(t.timeinfo)&&_.each(t.timeinfo,function(t,e){i["timeinfo["+e+"][daytime]"]=t.daytime.join(","),i["timeinfo["+e+"][weektime]"]=t.weektime.join(",")}),i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},createStoreByStep2:function(t,e,a){var i={func:"biz",act:"pc_add",step:2,biz_tmpid:t.bizTmpId,wechat:t.wechat,description:t.description};return util.extend(i,t.dynamic||{}),i=util.addUserIdToRequestData(i),console.log(i),this.ajax(i,e,a)},saveStoreByStep2:function(t,e,a){var i={func:"biz",act:"update_field",bizid:t.bizId,website:t.website,briefintro:t.description,wechat:t.wechat};return util.extend(i,t.dynamic||{}),i=util.addUserIdToRequestData(i),console.log(i),this.ajax(i,e,a)},getTmpStoreDynamicField:function(t,e,a){var i={func:"biz",act:"get_dynamic_fields",main_tagid:t.mainTagId};return this.ajax(i,e,a)},getStoreDynamicField:function(t,e,a){var i={func:"biz",act:"get_biz_dynamic_fields",bizid:t.bizId,main_tagid:t.tagid};return this.ajax(i,e,a)},createStoreByStep3:function(t,e,a){var i={func:"biz",act:"pc_add",step:3,biz_tmpid:t.bizTmpId||"",background_pic:t.bgPic};return t.logo&&(i.logo=t.logo),util.each(t.imageList||[],function(t,e){i["uploadfield["+e+"]"]=t}),i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},updateStoreByStep3:function(t,e,a){var i={func:"biz",act:"update_upload",method:"post",bizid:t.bizId,background_pic:t.bgPic};return i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},getStoreBigBackgroundPic:function(t,e,a){var i={func:"biz",act:"get_background_pic",main_tagid:t.mainTagId};return this.ajax(i,e,a)},uploadTmpBizLogo:function(t,e,a){var i={func:"biz",act:"upload",method:"post",logo:1,"uploadfield[]":t.image};return"tmp"===t.type?(i.tmp=1,i.biz_tmpid=t.bizId):i.bizid=t.bizId,i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},uploadStoreImage:function(t,e,a){var i={func:"biz",act:"upload",method:"post","uploadfield[]":t.image,bizid:t.bizId};return"tmp"===t.type&&(i.biz_tmpid=t.bizId,i.tmp=1,delete i.bizid),i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},createStoreCouponEvent:function(t,e,a){var i={func:"event",act:"post",method:"post",subject:t.subject,description:t.description,fk_entityID:t.biz,start_date:t.startDate,end_date:t.endDate};return i.start_date=moment.utc(i.start_date).unix(),i.end_date=moment.utc(i.end_date).unix(),util.each(t.imageList||[],function(t,e){i["files["+e+"]"]=t}),t.id&&(i.id=t.id),i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},getUserArticleAndCouponList:function(t,e,a){var i={func:"passport",act:"get_article_event",lastid_article:t.lastid_article};return i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},getUserCouponList:function(t,e,a){var i={func:"event",act:"list",lastid:t.lastid};return t.is_active&&(i.is_active=t.is_active),i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},getUserArticleList:function(t,e,a){var i={func:"article",act:"index",lastid:t.lastid_article};return i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},getArticleCategoryList:function(t,e,a){var i={func:"article",act:"tags"};return this.ajax(i,e,a)},createStoreArticle:function(t,e,a){var i={func:"article",act:"post",method:"post",category_id:t.category,title:t.title,msgbody:t.msgbody,fk_entityID:t.bizId};return t.id&&(i.id=t.id),i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},deleteCouponById:function(t,e,a){var i={func:"event",act:"del",id:t.id};return i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},changeStoreOpenStatus:function(t,e,a){var i={func:"biz",act:"closed",bizid:t.bizId,visible:t.status?1:-1};return i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},getStoreArticleDetail:function(t,e,a){var i={func:"article",act:"view",id:t.id};return i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},getCouponDetail:function(t,e,a){var i={func:"event",act:"view",id:t.id};return i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},login:function(t,e,a){var i={func:"passport",act:"login",method:"post",email:t.username,loginCode:md5(t.username+t.password+KG.config.MD5_KEY)};return this.ajax(i,e,a)},register:function(t,e,a){var i={func:"passport",act:"register",email:t.email,password:t.password,confirm_password:t.confirm_password,tou_accepted:1};return this.ajax(i,e,a)},checkLogin:function(t,e,a){var i={func:"passport",act:"checkToken",token:KG.user.get("token")};return this.ajax(i,e,a)},changePassword:function(t,e,a){var i={func:"passport",act:"password",userid:KG.user.get("userid"),password:t.password,old_password:t.old,pc:1};return i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},getStoreDetail:function(t,e,a){var i={func:"biz",act:"view",bizid:t.id};return i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},addFavForStore:function(t,e,a){var i={func:"biz",act:"add_bookmark",type:"biz",entityID:t.bizId};return i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},getStoreListByTag:function(t,e,a){var i={func:"view",act:"biz_list",tag:t.tag,subtag:t.subtag,subregion:t.subregion,page:t.page,publisher_type:t.publisher_type};return t.dy&&_.extend(i,t.dy),this.ajax(i,e,a)},getStoreCommentData:function(t,e,a){var i={func:"comment",act:"list",bizid:t.bizId,lastid:t.lastid,dataType:2};return t.has_pic&&(i.has_pic=1),this.ajax(i,e,a)},sendStoreComment:function(t,e,a){var i={func:"comment",act:"post",method:"post",bizid:t.bizId,msgbody:t.msg,dataType:2,dataID:t.bizId,star:t.star};return t.id&&(i.replyid=t.id,i.act="reply"),t.has_pic&&(i.has_pic="1"),i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},reportStoreComment:function(t,e,a){var i={func:"comment",act:"report",id:t.id,type:t.type,msgbody:t.msgbody||"",method:"post"};return i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},addLikeToStoreComment:function(t,e,a){var i={func:"comment",act:"buzz",id:t.id};return i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},getCouponListByTag:function(t,e,a){var i={func:"view",act:"event_list",tag:t.tag,subregion:t.subregion,lastid:t.lastid};return this.ajax(i,e,a)},getSiteHomePageData:function(t,e,a){var i={func:"view"};return this.ajax(i,e,a)},deleteStoreById:function(t,e,a){var i={func:"biz",act:"del",bizid:t.id};return i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},claimStoreById:function(t,e,a){var i={func:"biz",act:"claim_biz",bizid:t.id};return i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},searchStoreByKeyword:function(t,e,a){var i={func:"view",act:"biz_search",keyword:t.keyword,page:t.page||1};return this.ajax(i,e,a)},sendResetPasswordEmail:function(t,e,a){var i={func:"passport",act:"reset_password",email:t.email};return this.ajax(i,e,a)},resetPassword:function(t,e,a){var i={func:"passport",act:"modify_password",email:t.email,checkpassword:t.check,password:t.password};return this.ajax(i,e,a)},deleteStoreImage:function(t,e,a){var i={func:"biz",act:"delfile",fileid:t.fileid,bizid:t.bizId};return i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},getHotLocationRegion:function(t,e,a){var i={func:"passport",act:"get_region"};return this.ajax(i,e,a)},setHotLocationRegion:function(t,e,a){var i={func:"passport",act:"set_region",regionID:t.regionID};return this.ajax(i,e,a)},oauthLoginWithWeixinCode:function(t,e,a){var i={func:"passport",act:"mobile_login",login_type:"wechat",code:t.code};return this.ajax(i,e,a)},uploadCouponImage:function(t,e,a){var i={func:"event",act:"upload",method:"post","uploadfield[]":t.image,eventID:t.id};return i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},deleteArticle:function(t,e,a){var i={func:"article",act:"del",id:t.id};return i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},pcRenZhengStore:function(t,e,a){var i={func:"biz",act:"verified",bizid:t.bizId,tel_tmp:t.tel};return i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},deleteCouponImage:function(t,e,a){var i={func:"event",act:"delfile",fileid:t.fileid,eventID:t.id};return i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},getAdsDetail:function(t,e,a){var i={func:"biz",act:"ads_view",postid:t.id};return t.bizinfo&&(i.bizinfo=1),i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},createAds:function(t,e,a){var i={func:"biz",method:"post",act:"ads_post",fk_entityID:t.bizId,fk_main_tag_id:t.tag,title:t.title,ad1:t.ad1,ad2:t.ad2,tel:t.tel,pic:t.logo,type:t.type,fk_region_id:t.region,share:encodeURIComponent(t.html)};return t.id&&(i.postid=t.id),i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},resubmitAds:function(t,e,a){var i={func:"biz",act:"ads_updatetime",postid:t.id};return i=util.addUserIdToRequestData(i),this.ajax(i,e,a)}};
"use strict";!function(){KG.Class.define("BaseComponent",{_init:function(t,i,e){var n=this;this.box=t,this.config=e||{},this._initProp(),this.initStart(),this.getData(t,i,function(t){n.data=t,n.initVar(),n._initView(),n._initEvent(),n._initEnd()})},getTemplate:function(){},initVar:function(){},_initView:function(){this.initView(),this.html=template.compile(this.getTemplate())(this.data),this.elem=$(this.html),KG.component.init(this.elem),this.jq=util.extend(this.setJqVar(),this.callParent("setJqVar"))},setJqVar:function(){return{}},_initEvent:function(){this.initEvent(),util.message.register(this.__name,this.registerMessage.bind(this))},_initEnd:function(){this.elem.data("kg-obj",this);var t=this.box.attr("style"),i=this.box.attr("class"),e=this.box.attr("param");this.elem.attr("style",t),this.elem.addClass(i),this.elem.attr("param",e),this.box.replaceWith(this.elem),this.initEnd()},getData:function(t,i,e){e.call(this,{})},_initProp:function(){var t=util.extend(this.defineProperty(),this.callParent("defineProperty")),i={},e=this.box;util.each(t,function(t,n){t=t||{};var a=e.data(n);i[n]=util.isUndefined(a)?t.defaultValue:util.isFunction(t.getter)?t.getter(a):a}),this.prop=i},defineProperty:function(){return{}},initView:util.noop,initEnd:util.noop,initEvent:util.noop,registerMessage:util.noop,initStart:util.noop}),KG.Class.define("Header",{ParentClass:"BaseComponent",getTemplate:function(){return['<nav class="kg-header-comp">','<div class="container" id="js_header_comp">','<a class="logo" href="/"></a>','<div class="hw-loc js_loc" style="display: none;">',"<span></span>",'<i class="icon fa fa-caret-down"></i>',"</div>",'<div class="input-group search js_search">','<span class="input-group-addon hand js_tosearch"><i class="icon"></i></span>','<input type="text" class="form-control" data-placeholder="搜索店铺，专家服务...">',"</div>","{{if user.isLogin && user.has_biz}}",'<div class="right">','<div class="dropdown" style="margin-right: 40px;">','<button data-href="../mybiz/index.html" id="js_right_dd_1" type="button" data-toggle="dropdown" data-hover="dropdown" aria-haspopup="true" aria-expanded="false">','<img src="../../image/aa.png" />',"</button>",'<div class="dropdown-menu" aria-labelledby="js_right_dd_1">','<a href="../mybiz/index.html">我的店铺</a>','<a href="../mybiz/coupon.html">店铺优惠</a>','<a href="../mybiz/article.html">店铺文章</a>',"</div>","</div>",'<div class="dropdown">','<button data-href="../myfav/list.html" id="js_right_dd_2" class="c2" type="button" data-toggle="dropdown" data-hover="dropdown" aria-haspopup="true" aria-expanded="false">','<img src="{{user.image}}" />',"</button>",'<div class="dropdown-menu" aria-labelledby="js_right_dd_2">','<a href="../myfav/list.html">我的收藏</a>','<a href="../mycoupon/list.html">我的领取</a>','<a href="../mysys/index.html">系统消息</a>','<a href="../mycount/info.html">账户设置</a>','<a class="js_logout" href="javascript:void(0)">退出登录</a>',"</div>","</div>","{{else if user.isLogin && !user.has_biz}}",'<div class="right">','<a style="float: left;margin-right: 20px;" class="hw-light-btn hw-btn" href="../site/landing.html">我是商家</a>','<div style="top:3px;" class="dropdown">','<button data-href="../myfav/list.html" id="js_right_dd_2" class="c2" type="button" data-toggle="dropdown" data-hover="dropdown" aria-haspopup="true" aria-expanded="false">','<img src="{{user.image}}" />',"</button>",'<div class="dropdown-menu" aria-labelledby="js_right_dd_2">','<a href="../myfav/list.html">我的收藏</a>','<a href="../mycoupon/list.html">我的领取</a>','<a href="../mysys/index.html">系统消息</a>','<a href="../mycount/info.html">账户设置</a>','<a class="js_logout" href="javascript:void(0)">退出登录</a>',"</div>","</div>","{{else}}",'<div class="right">','<a class="hw-light-btn hw-btn" href="../site/landing.html">我是商家</a>','<a href="javascript:void(0)" class="hw-a js_login">登录</a>','<a href="javascript:void(0)" class="hw-a js_reg">注册</a>',"</div>","{{/if}}","</div>","</div>","</nav>"].join("")},getData:function(t,i,e){var n=KG.user.get();e({user:n})},initEvent:function(){this.data.user.isLogin?this.initEventByAfterLogin():this.initEventByBeforeLogin();var t=this.elem.find(".js_search");t.find("input").keyup(function(t){if(13!==t.keyCode)return!1;var i=$(this).val();return i?void(location.href="../site/search.html?keyword="+i):!1}),t.find(".js_tosearch").click(function(){var i=t.find("input").val();return i?void(location.href="../site/search.html?keyword="+i):(t.find("input").focus(),!1)}),this.elem.find(".js_loc").click(function(){util.dialog.showSelectLocationRegion()}),this.elem.find("button[data-href]").click(function(){var t=$(this).data("href");return location.href=t,!1})},initEventByAfterLogin:function(){this.elem.find(".js_logout").click(function(){KG.user.logout()})},initEventByBeforeLogin:function(){this.elem.find(".js_login").click(function(){util.dialog.showLoginBox()}),this.elem.find(".js_reg").click(function(){util.dialog.showRegBox()})},initEnd:function(){var t=KG.data.get("keyword");t&&this.elem.find(".js_search").find("input").val(t);var i=util.cookie.get("region_cn")||"旧金山湾区";this.elem.find(".js_loc").show().find("span").html(i),this.elem.find('[data-hover="dropdown"]').dropdownHover(),this.elem.find("input[data-placeholder]").focus(function(){var t=$(this);t.val()&&t.val()!==t.data("placeholder")||t.removeClass("blur").val("")}).blur(function(){var t=$(this);t.val()||t.addClass("blur").val(t.data("placeholder"))}).blur()}}),KG.Class.define("HeadingNav",{ParentClass:"BaseComponent",getTemplate:function(){return['<nav class="kg-header-nav-comp">','<div class="container">','<a href="../mybiz/index.html" class="nav js_mybiz">我的店铺</a>','<a href="../myfav/list.html" class="nav js_myfav">我的收藏</a>','<a href="../mycoupon/list.html" class="nav js_mycoupon">我的优惠</a>','<a href="../mysys/index.html" class="nav js_mysys">系统消息</a>','<a href="../mycount/info.html" class="nav js_mycount">账户</a>',"</div>","</nav>"].join("")},getData:function(t,i,e){var n=KG.data.get("page").split("-");n=n[0]||"",e({page:n})},initEnd:function(){var t=this.data.page;this.elem.find(".js_"+t).addClass("active")}}),KG.Class.define("HWSelectRegionLocation",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="hw-HWSelectRegionLocation">',"{{each list as item index}}",'<button param="{{index}}" class="js_one hw-btn hw-light-btn">{{item.cn}}</button>',"{{/each}}","</div>"].join("")},getData:function(t,i,e){KG.request.getHotLocationRegion({},function(t,i){var n=[];_.each(i,function(t,i){n.push({id:t.id,cn:t.area_name,name:i})}),e({list:n})})},initEvent:function(){var t=this;this.elem.on("click",".js_one",function(){var i=$(this),e=i.attr("param"),n=t.data.list[e];util.cookie.set("regionID",n.id),util.cookie.set("region_name",n.name),util.cookie.set("region_cn",n.cn),KG.request.setHotLocationRegion({regionID:n.id},function(t,i){location.reload()})})},initEnd:function(){var t=util.cookie.get("regionID"),i=0;t&&(i=_.findIndex(this.data.list,function(i){return i.id.toString()===t}),this.elem.find(".js_one").eq(i).addClass("active"))}}),KG.Class.define("HWLoginRegBoxComp",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="hw-loginRegBoxComp">','<div class="c-tlt">','<h4><b>加入海外同城</b><b style="margin-left: 85px;">让生活更简单</b></h4>','<img src="../../image/haiwai1.png" />',"</div>",'<div class="c-left js_left">',"</div>",'<div class="c-right">',"<h4>用以下账号直接登录</h4>",'<a href="javascript:void(0)" class="hw-btn hw-weixin"><i class="icon"></i>微信扫一扫登录</a>','<a href="javascript:void(0)" class="hw-btn hw-fb"><i class="icon"></i>facebook登录</a>',"</div>",'<div class="c-btm">',"</div>","</div>"].join("")},setJqVar:function(){return{tlt:this.elem.find(".c-tlt h4 b"),left:this.elem.find(".js_left"),btm:this.elem.find(".c-btm")}},setLoginBox:function(){this.jq.tlt.hide();var t=["<h4>登录海外同城</h4>",'<div class="c-error"></div>','<input type="text" class="js_email" placeholder="邮箱" />','<input type="password" class="js_pwd" placeholder="密码" />','<button class="hw-btn hw-blue-btn js_loginBtn">登录</button>','<p>忘记账号或密码？<a href="#">在这里找回</a></p>'].join("");this.jq.left.html(t);var i=['<p>还没有海外帐户？<a class="hw-btn js_toReg">注册</a></p>'].join("");this.jq.btm.html(i)},setRegBox:function(){var t=['<div class="c-error"></div>','<input type="text" class="js_email" placeholder="邮箱" />','<input type="password" class="js_pwd" placeholder="密码" />','<input type="password" class="js_pwd2" placeholder="确认密码" />','<button class="hw-btn hw-blue-btn js_regBtn">注册</button>','<p>点击注册表示您同意海外同城的<a href="#">使用协议</a>和<a href="#">隐私保护协议</a></p>'].join("");this.jq.left.html(t),this.jq.tlt.show();var i=['<h6>已有海外帐户？<a href="javascript:void(0)" class="js_toLogin">直接登录</a></h6>'].join("");this.jq.btm.html(i)},defineProperty:function(){return{type:{defaultValue:"reg"}}},showError:function(t){this.elem.find(".c-error").html(t)},initEvent:function(){var t=this;this.elem.on("click",".js_toReg",this.setRegBox.bind(this)),this.elem.on("click",".js_toLogin",this.setLoginBox.bind(this)),this.elem.on("click",".js_regBtn",function(){var i=t.getRegisterValue();console.log(i),KG.user.register(i,function(e,n){if(e){var a={username:i.email,password:i.password};KG.user.login(a,function(){location.reload()},function(t){alert(t)})}else t.showError(n)})}),this.elem.on("click",".js_loginBtn",function(){var i=t.getLoginValue();KG.user.login(i,function(){location.reload()},function(i){t.showError(i)})}),this.elem.on("click",".hw-weixin",function(){return util.dialog.showWeixinLoginQrCode(KG.config.WeixinLoginRedirectUrl),!1}),this.elem.on("click",".hw-fb",function(){util.Facebook.login(function(){util.dialog.hide()})})},getLoginValue:function(){var t={username:this.jq.left.find(".js_email").val(),password:this.jq.left.find(".js_pwd").val()};return t},getRegisterValue:function(){return{email:this.jq.left.find(".js_email").val(),password:this.jq.left.find(".js_pwd").val(),confirm_password:this.jq.left.find(".js_pwd2").val()}},initEnd:function(){"login"===this.prop.type?this.setLoginBox():"reg"===this.prop.type&&this.setRegBox()}})}(),KG.component={initEach:function(t,i,e){e=e||{},new(KG.Class.getByName(t))(i,e)},init:function(t){t=t||$("body");var i=t.find("[role]");i.each(function(){var t=$(this);if(!t.attr("init-end")&&!t.attr("init-self")){var i=t.attr("role");KG.component.initEach(i,t,{})}})},initWithElement:function(t,i,e){var n=t.attr("role");if(n)return new(KG.Class.getByName(n))(t,i,e)},getObj:function(t){var i=t.data("kg-obj");return i||null}},$(function(){return util.url.param("code")&&"aaa"===util.url.param("state")?(util.showPageLoading(!0),KG.request.oauthLoginWithWeixinCode({code:util.url.param("code")},function(t,i){util.showPageLoading(!1),t?KG.user.getUserDetailWithToken(i,function(t){return t.email?(location.href="../site/index.html",!1):(util.toast.alert("登录成功，请补充资料"),void _.delay(function(){location.href="../mycount/info.html"},1500))}):(util.toast.showError(i),util.delay(function(){location.href="../site/index.html"},2e3))}),!1):(util.showPageLoading(!0),void KG.user.checkLogin(function(){var t=KG.user.get();KG.data.get("needLogin")?t.isLogin?KG.component.init():location.href="../site/landing.html?redirect_url="+location.href:KG.component.init(),util.showPageLoading(!1)}))});
KG.Class.define("BaseForm",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="container hw-comp-bform">',this.getInsideTemplate(),"</div>"].join("")},getInsideTemplate:function(){}}),KG.Class.define("BaseInput",{ParentClass:"BaseComponent",defineProperty:function(){return{value:{defaultValue:""},label:{},require:{},type:{defaultValue:"text"},delbtn:{}}},getTemplate:function(){return['<div class="form-group hw-comp-BaseInput">','<label class="lab {{if require}}require{{/if}}" for="{{uuid}}">{{label}}</label>','<label class="control-label hw-err"></label>','<input type="{{type}}" class="form-control" id="{{uuid}}" placeholder="{{placeholder}}">',"</div>"].join("")},getData:function(e,t,i){var n=this.prop;i({value:n.value,label:n.label,require:n.require,type:n.type,placeholder:e.attr("placeholder")||"",uuid:"lb_"+util.getUuid()})},initEvent:function(){var e=this;if(this.prop.delbtn){var t=this.elem.find("input");t.after('<i class="fa del fa-times-circle" style="display: none;"></i>'),this.jq.delBtn=this.elem.find(".del"),this.jq.delBtn.click(function(){t.val(""),e.checkDeleteIcon(),t.focus()}),t.bind("keyup",this.checkDeleteIcon.bind(this)),t.bind("paste",this.checkDeleteIcon.bind(this))}},initEnd:function(){this.prop.value&&this.elem.find("input").val(this.prop.value)},checkDeleteIcon:function(){var e=this.elem.find("input").val();e?this.jq.delBtn.show():this.jq.delBtn.hide()},focus:function(){this.elem.find("input").focus()},getValue:function(){return this.elem.find("input").val()},setValue:function(e){this.elem.find("input").val(e)},showError:function(e){e?(this.elem.addClass("has-error"),this.elem.find(".hw-err").html(e)):(this.elem.removeClass("has-error"),this.elem.find(".hw-err").html(""))},reset:function(){this.elem.find("input").val(""),this.showError(!1)}}),KG.Class.define("BaseUploadImage",{ParentClass:"BaseComponent",setJqVar:function(){return{img:this.elem.find(".js_img"),btn:this.elem.find(".js_btn"),fileInput:this.elem.find('input[type="file"]')}},defineProperty:function(){return{image:{}}},initEvent:function(){var e=this.jq.btn,t=(this.jq.img,this);this.jq.fileInput.bind("change",function(i){var n=this.files[0];e.button("loading"),t.uploadImageFn(n,function(){e.button("reset")})})},uploadImageFn:function(e,t){var i=this;util.uploadImage(e,function(e){var e=KG.config.SiteRoot+e;i.jq.img.attr("src",e),t()})}}),KG.Class.define("StarRank",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="hw-comp-star">',"</div>"].join("")},initStart:function(){this.rank=0,this.enableClick=!1},getData:function(e,t,i){this.rank=parseFloat(e.data("rank"))||0,e.data("enable")&&(this.enableClick=!0),i({})},render:function(){for(var e=this.rank,t=[],i=1;6>i;i++)e>i?t.push("full"):i===e?t.push("full"):i===e+.5?t.push("half"):t.push("empty");var n=["{{each list as item index}}",'{{if item==="full"}}','<i index="{{index}}" class="icon fa fa-star icon_full"></i>','{{else if item==="half"}}','<i index="{{index}}" class="icon fa fa-star-half-o icon_half"></i>',"{{else}}",'<i index="{{index}}" class="icon fa fa-star-o icon_empty"></i>',"{{/if}}","{{/each}}"].join("");n=template.compile(n)({list:t}),this.elem.html(n)},setValue:function(e){this.rank=e,this.render()},getValue:function(){return this.rank},initEnd:function(){this.render()},initEvent:function(){var e=this;this.enableClick&&this.elem.on("click","i.fa",function(t){var i=$(t.target),n=i.attr("index");i.hasClass("icon_empty")?e.rank=parseFloat(n)+1:i.hasClass("icon_full")&&(e.rank=parseInt(n,10)),0===e.rank&&(e.rank=1),e.render()}).addClass("hand")}}),KG.Class.define("BaseSelectInput",{ParentClass:"BaseInput",getTemplate:function(){return['<div class="form-group hw-comp-BaseSelectInput">','<label class="lab {{if require}}require{{/if}}">{{label}}</label>','<label class="control-label hw-err"></label>','<div class="dropdown hw-drop">','<button id="{{uuid}}" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">','<input type="text" readonly="true" class="form-control js_input" placeholder="{{placeholder}}">','<i class="icon fa fa-caret-down"></i>',"</button>",'<ul class="dropdown-menu" aria-labelledby="{{uuid}}">',"{{each list as item}}",'<li index="{{$index}}" class="js_drop">',this.getEachHtml(),"</li>","{{/each}}","</ul>","</div>","</div>"].join("")},initVar:function(){this.index=-1},getData:function(e,t,i){this.clickCallback=t.clickCallback,this.getEachHtml=t.getEachHtml||function(){return"{{item}}"};var n=this.prop;i({value:n.value,label:n.label,require:n.require,placeholder:e.attr("placeholder")||"",uuid:"dl_"+util.getUuid(),list:t.list})},initEvent:function(){var e=this,t=this.elem.find(".js_input");this.elem.find(".js_drop").click(function(){t.val($(this).text());var i=$(this).attr("index");e.index=i,e.clickCallback(e.data.list[i])})},initEnd:function(){},getValue:function(){return this.index<0?{}:this.data.list[this.index]},setValue:function(e){this.elem.find(".js_drop").filter('[index="'+e+'"]').trigger("click")},setOnlyValue:function(e){this.elem.find(".js_input").val(e)},disable:function(e){e=e||!1,e?(this.elem.find("button").attr("disabled",e),this.elem.find(".js_input").attr("disabled",e)):(this.elem.find("button").removeAttr("disabled"),this.elem.find(".js_input").removeAttr("disabled"))}}),KG.Class.define("BaseLoadingImageBox",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="hw-comp-BaseLoadingImageBox hw-center-image">','<i class="icon icon-loading"></i>',"</div>"].join("")},defineProperty:function(){return{url:{}}},initEnd:function(){var e=this,t=this.prop.url,i=new Image;i.src=t,console.log(t),$(i).load(function(i){e.renderImage($(this)[0],t)})},renderImage:function(e,t){var i="",n="width",a=this.elem.width(),l=this.elem.height();e.width/e.height>=a/l?i="width:auto;height:100%;":(i="width:100%;height:auto;",n="height"),this.elem.empty();var l='<img style="'+i+'" src="'+t+'" />';"width"===n?this.elem.html(l):this.elem.html(l).addClass("hw-flex-start-image")}}),KG.Class.define("BaseLoadingMoreStatusBar",{ParentClass:"BaseComponent",getTemplate:function(){return['<nav class="hw-comp-BaseLoadingMoreStatusBar">','<i class="loading" style="display: none;"></i>','<b class="js_more">加载更多</b>',"</nav>"].join("")},setJqVar:function(){return{loading:this.elem.find(".loading"),b:this.elem.find(".js_more")}},setState:function(e){"loading"===e?(this.jq.loading.show(),this.jq.b.hide()):"loaded"===e?(this.jq.loading.hide(),this.jq.b.show()):"hide"===e&&this.elem.hide()},setEvent:function(e){var t=this;this.jq.b.unbind("click").bind("click",function(i){t.setState("loading"),e(function(){t.setState("loaded")},t)})},trigger:function(){this.jq.b.trigger("click")}});
KG.Class.define("SiteHeadingNav",{ParentClass:"BaseComponent",getTemplate:function(){return['<nav class="kg-header-nav-comp kg-site-header-nav-comp">','<div class="container">','<a href="javascript:void(0)" class="nav js_tab">本地商家<i class="icon glyphicon glyphicon-chevron-down"></i></a>','<a href="../site/couponlist.html" class="nav js_couponList">本地优惠</a>','<a href="../site/articlelist.html?category=hot" class="nav js_articleList">生活指南</a>','<a href="http://www.haiwai.com" target="_blank" class="nav js_cat">分类信息</a>',"</div>",'<div class="hw-box container">','<div class="left nodis"></div>',"</div>","</nav>"].join("")},defineProperty:function(){return{leftshow:{defaultValue:!1}}},initStart:function(){this.navData=[{logo:"food.png",title:[["餐饮美食",131]],children:[[["中国菜",131,135],["川菜",131,142],["粤菜",131,140],["火锅",131,148],["湘菜",131,150],["上海菜",131,138],["港式茶餐厅",131,141],["台湾菜",131,137]],[["日本料理",131,159],["韩国菜",131,166],["泰国菜",131,161],["越南菜",131,162],["西餐厅",131,165],["意大利菜",131,157],["法国菜",131,168]],[["奶茶店",131,181],["咖啡厅",131,188],["冰品店",131,182],["面包/蛋糕店",131,178]]]},{logo:"sat.png",title:[["教育、",214],["托儿、",226],["培训",245]],children:[[["课后辅导",214,214],["SAT",214,215],["数学",214,549],["英语",214,216],["中文学校",214,217],["钢琴",214,219],["小提琴",214,220],["其它乐器",214,221],["游泳",214,225],["武术",214,224],["艺术/绘画",214,223],["舞蹈",214,222],["教育咨询",214,610]],[["幼儿园",226,226],["托儿所",226,547],["双语幼儿园",226,609],["蒙特梭利教育",226,607]],[["职业培训",245,245],["电脑/IT",245,234],["地产执照",245,233],["社区大学",245,229],["驾驶学校",245,247]]]},{logo:"cleaner.png",title:[["家装、",41],["清洁、",459],["搬家",450]],children:[[["装修",41,41],["厨卫装修",41,36],["橱柜",41,37],["地毯地板",41,38],["门窗",41,50],["屋顶",41,55],["通渠",41,47],["电工",41,48],["空调/暖气",41,49]],[["清洁服务",459,459],["地毯清洗",459,212]],[["搬家公司",450,450]]]},{logo:"car.png",title:[["汽车经销、",67],["维修",195]],children:[[["汽车经销",67,67],["宝马",67,75],["奔驰",67,98],["奥迪",67,73],["雷克萨斯",67,93],["讴歌",67,71],["丰田",67,107],["本田",67,85],["大众",67,108]],[["汽车维修",195,195],["板金/喷漆",195,190],["传动器",195,200],["轮胎",195,191],["汽车玻璃",195,199]]]},{logo:"lawer.png",title:[["理财、",369],["保险、",383],["律师",391]],children:[[["理财",369,369],["会计师/会计服务",369,366],["报税服务",369,368],["财务规划",369,367],["教育基金",369,252]],[["保险",383,383],["医疗保险",383,384],["汽车保险",383,385],["房屋保险",383,386],["人寿保险",383,387]],[["律师",391,391],["人体伤害诉讼",391,392],["家事法",391,393],["刑事法",391,394],["酒后驾车处理",391,395],["移民法",391,396],["民事法",391,397],["商业法",391,398],["专利/商标法",391,399],["遗产法",391,404],["房地产法",391,405],["资产规划",391,613]]]},{logo:"loan.png",title:[["房产经纪、",27],["贷款",375]],children:[[["房产经纪",27,27],["贷款服务",27,375],["房地产估价",27,33],["地产管理",27,62]]]},{logo:"doctor.png",title:[["中医、",294],["牙医、",345],["家庭医生",297]],children:[[["中医",294,294],["针灸",294,295],["推拿",294,296],["中药参茸行",294,357]],[["牙科医生",345,345],["儿童牙科",345,346],["牙齿矫正",345,347],["人工植牙",345,348],["假牙修复",345,349],["根管治疗",345,351],["牙周病治疗",345,352]],[["家庭医生",297,297],["小儿科",297,298],["妇产科",297,301],["内科",297,305],["皮肤科",297,313],["整形外科",297,333]]]},{logo:"relax.png",title:[["美容休闲、",533],["旅游",479]],children:[[["美容休闲",533,533],["美发",533,531],["美甲",533,532],["医学美容",533,334],["足疗/脚底按摩",533,344],["KTV",533,498]],[["旅游",479,479],["旅行社",479,0],["机场接送",479,203],["旅游包车",479,204]]]},{logo:"store.png",title:[["私家小店",643]],children:[[["私家美食",643,645],["服装饰品",643,650],["生活用品",643,648],["其他",643,651]]]}]},getData:function(t,e,i){var n=KG.data.get("page").split("-");n=n[1]||"",i({page:n})},setJqVar:function(){return{left:this.elem.find(".hw-box .left")}},initEvent:function(){var t=this.jq.left;this.prop.leftshow?t.removeClass("nodis"):this.elem.find(".js_tab").add(t).hover(function(){t.show()},function(){t.hide()})},initEnd:function(){this.setLeftBox();var t=this.data.page;this.elem.find(".js_"+t).addClass("active"),"index"===t&&this.elem.find(".js_tab").addClass("active")},setLeftBox:function(){var t=this,e="";_.each(this.navData,function(i){var n=['<div class="hw-item">','<div class="hw-one">','<img src="../../image/site/'+i.logo+'" />','<p class="cp">',"{{each list as item}}",'<a href="../site/storelist.html?tag={{item[1]}}">{{item[0]}}</a>',"{{/each}}","</p>","</div>",t.getRightBoxHtml(i.children),"</div>"].join("");n=template.compile(n)({list:i.title}),e+=n}),this.jq.left.html(e),this.jq.left.find(".hw-item").hover(function(){$(this).addClass("hover");var t=$(this).next(".hw-item");1===t.length&&t.addClass("second");var e=$(this).find(".right");e.show()},function(){$(this).removeClass("hover");var t=$(this).next(".hw-item");1===t.length&&t.removeClass("second");var e=$(this).find(".right");e.hide()})},getRightBoxHtml:function(t){if(t=t||[],t.length<1)return"";var e='<div class="right nodis">';return _.each(t,function(t){e+="<dl>";var i="",n="";_.each(t,function(t){var e="cb",o="../site/storelist.html?tag="+t[1];t[2]===t[1]?(e="ca",i+='<a class="'+e+'" href="'+o+'" target="_self">'+t[0]+"</a>"):0===t[2]?n+='<a class="'+e+'" href="'+o+'" target="_self">'+t[0]+"</a>":(o+="&subtag="+t[2],n+='<a class="'+e+'" href="'+o+'" target="_self">'+t[0]+"</a>")}),i?(e+="<dt>"+i+"</dt>",e+='<dd style="width:470px;">'+n+"</dd>"):e+="<dd>"+n+"</dd>",e+="</dl>"}),e+="</div>"}}),KG.Class.define("HWSiteCouponDetailComp",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="hw-HWSiteCouponDetailComp">','<div class="ca js_sbox nodis">',"</div>",'<div class="cb js_box nodis"></div>','<div class="cc js_acbox nodis"></div>','<div class="js_loading" style="display: none;">Loading ...</div>',"</div>"].join("")},defineProperty:function(){return{coupon:{}}},loading:function(t){var e=this.elem.find(".js_loading");t?e.css({"text-align":"center","font-size":"17px"}).show():e.hide()},getData:function(t,e,i){this.id=this.prop.coupon,this.couponData={},i({})},initEnd:function(){var t=this;this.loading(!0),KG.request.getCouponDetail({id:this.id},function(e,i){e&&(console.log(i),t.couponData=i,t.loading(!1),t.setStoreBoxHtml(i),t.setCouponBoxHtml(i),t.setActionBoxHtml(i))})},setJqVar:function(){return{storeBox:this.elem.find(".js_sbox"),box:this.elem.find(".js_box"),actionBox:this.elem.find(".js_acbox")}},setStoreBoxHtml:function(t){if(!t.bizinfo.entityID)return void this.jq.storeBox.hide();var e=['<div class="">','<img src="{{biz.logo[0].path | absImage}}" />','<a href="{{biz.entityID | toStorePath}}" class="h4">{{biz.name_cn || biz.name_en}}</a>',"<p>{{biz | storeFullAddress}}</p>","</div>"].join("");e=template.compile(e)({biz:t.bizinfo}),this.jq.storeBox.html(e).show()},setCouponBoxHtml:function(t){var e=["<h4>{{data.subject}}</h4>","{{#dyHtml}}","<label>活动详情</label>","<p>{{#data.description | decode}}</p>","{{if data.files[0]}}",'<div class="hw-img"><img src="{{data.files[0].path | absImage}}" /></div>',"{{/if}}"].join(""),i="";_.each(t.dynamic_field||[],function(t){i+="<label>"+t.field_name+"</label><p>"+t.value+"</p>"}),console.log(!t.top_start_time||parseInt(t.top_start_time)<1||!t.top_end_time||parseInt(t.top_end_time)<1||-1!==t.top_end_time.indexOf("unlimit")),i+=!t.top_start_time||parseInt(t.top_start_time)<1||!t.top_end_time||parseInt(t.top_end_time)<1||-1!==t.top_end_time.indexOf("unlimit")?"<label>活动时间</label><p>不限时间</p>":"<label>活动时间</label><p>"+moment.unix(t.top_start_time).utc().format("MM/DD/YYYY")+" &nbsp;&nbsp;到&nbsp;&nbsp; "+moment.unix(t.top_end_time).utc().format("MM/DD/YYYY")+"</p>",e=template.compile(e)({data:t,dyHtml:template.compile(i)({data:t})}),this.jq.box.html(e),this.jq.box.removeClass("nodis"),t.bizinfo.entityID&&this.jq.box.css({"margin-top":"60px"})},setActionBoxHtml:function(t){var e=['<div style="width:400px;margin: 0 auto;" class="js_tel" role="BaseInput" placeholder="请输入手机号"></div>','<button class="hw-btn hw-blue-btn js_getCoupon">领取优惠</button>'].join("");e=template.compile(e)({data:t}),this.jq.actionBox.html(e).removeClass("nodis"),KG.component.init(this.jq.actionBox)},initEvent:function(){var t=this;this.elem.on("click",".js_getCoupon",function(){var e=KG.component.getObj(t.elem.find(".js_tel")),i=e.getValue();return i&&util.validate.AmericanPhone(i)?(e.showError(),void KG.request.sendSmsToUserPhone({number:i,biz_name:t.couponData.bizinfo.name_cn||t.couponData.bizinfo.name_en,event_title:t.couponData.subject,id:t.couponData.pk_id},function(t,e){t?util.toast.alert("短信已成功发送至 "+i,"出示短信内容给商家，就可以享受优惠！"):util.toast.showError(e)})):(e.showError("电话格式不正确"),void e.focus())})}});
KG.Class.define("HWIndexFocesImage",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="hw-index-focusimage">','<div id="carousel-11" class="carousel slide" data-ride="carousel">','<ol class="carousel-indicators">',"{{each list as item}}",'<li data-target="#carousel-11" data-slide-to="{{$index}}" class="{{if $index<1}}active{{/if}}"></li>',"{{/each}}","</ol>",'<div class="carousel-inner" init-self="true" role="listbox">',"{{each list as item}}",'<a href="{{item.link}}" target="_blank" class="item img-item{{if $index<1}} active{{/if}}">','<img class="js_cimg" src="{{item.pic}}" />',"</a>","{{/each}}","</div>","</div>","</div>"].join("")},getData:function(e,t,i){i({list:t.list})},initEnd:function(){this.elem.find(".carousel").carousel({interval:6e3})}}),KG.Class.define("HWIndexHotNavComp",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="hw-HWIndexHotNavComp">',"<h4>热门导航</h4>","<dd>","{{each list1 as item}}",'{{if item.link}}<a href="{{item.link}}" target="_blank">{{item.title}}</a>{{/if}}',"{{/each}}","</dd>","<dd>","{{each list2 as item}}",'{{if item.link}}<a href="{{item.link}}" target="_blank">{{item.title}}</a>{{/if}}',"{{/each}}","</dd>","<dd>","{{each list3 as item}}",'{{if item.link}}<a href="{{item.link}}" target="_blank">{{item.title}}</a>{{/if}}',"{{/each}}","</dd>","</div>"].join("")},getData:function(e,t,i){var a=t.top,s=t.middle,l=t.bottom;i({list1:a,list2:s,list3:l})}}),KG.Class.define("HWSiteIndexAppBanner",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="hw-HWSiteIndexAppBanner">','<div class="appcom">','<a href="/pc/page/site/landing.html" class="button">商家免费入驻</a>','<div class="slogan">',"<p>免费下载商家版App</p>","<p>随时随地轻松管理店铺</p>","</div>",'<a class="appad" target="_blank" href="'+KG.config.SJAPP_AppleStore_Url+'">','<img src="{{root}}/images_beta/app.png" alt="">',"</a>",'<a class="appstore" target="_blank" href="'+KG.config.SJAPP_AppleStore_Url+'">','<img src="{{root}}/images_beta/appstore.png" alt="">',"</a>","</div>","</div>"].join("")},getData:function(e,t,i){i({root:KG.config.SiteRoot})}}),KG.Class.define("HWSiteIndexAppBanner1",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="appcom hw-HWSiteIndexAppBanner1">','<div class="bw">','<a class="hw-btn hw-blue-btn" target="_blank" href="../site/landing.html">商家免费入驻</a>',"</div>",'<a class="appad" href="'+KG.config.SJAPP_AppleStore_Url+'" target="_blank">','<img src="{{root}}/images_beta/appp.png" alt="">',"</a>",'<div class="slogan">',"<p>免费下载商家版App</p>","<p>随时随地轻松管理店铺</p>","</div>",'<a class="appstore" target="_blank" href="'+KG.config.SJAPP_AppleStore_Url+'">','<img src="{{root}}/images_beta/appstore.png" alt="">',"</a>","</div>"].join("")},getData:function(e,t,i){i({root:KG.config.SiteRoot})}}),KG.Class.define("HWSiteIndexHotCoupon",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="hw-HWSiteIndexHotCoupon">',"<dt>","<label>热门优惠</label>",'<a href="../site/couponlist.html" class="hw-a">查看全部优惠</a>',"</dt>",'<dd class="js_box"></dd>',"</div>"].join("")},setJqVar:function(){return{box:this.elem.find(".js_box")}},setListHtml:function(e){var t=["{{each list as item}}",'<div param="{{item.pk_id}}" class="hw-each">','<div role="BaseLoadingImageBox" data-url="{{item.files[0].path | absImage}}" class="hw-logo"></div>',"<h4>{{item.bizinfo.name_cn || item.bizinfo.name_en}}</h4>",'<span class="hw-address">{{item.bizinfo.city}} {{item.bizinfo.state}}</span>',"<h3>{{item.subject}}</h3>","</div>","{{/each}}"].join("");t=template.compile(t)({list:e}),this.jq.box.html(t),KG.component.init(this.jq.box)},registerMessage:function(e,t){this.setListHtml(t)},initEvent:function(){this.elem.on("click",".hw-each",function(e){var t=$(this).attr("param");util.dialog.showCouponDetail(t)})}}),KG.Class.define("HWSiteIndexNewStoreRecommend",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="hw-HWSiteIndexNewStoreRecommend">',"<dt>","<label>新店推荐</label>","</dt>",'<dd class="js_box"></dd>',"</div>"].join("")},setJqVar:function(){return{box:this.elem.find(".js_box")}},registerMessage:function(e,t){var i=t,a=[];_.each(i,function(e,t){e.taglist="",e.taginfo&&(e.taglist=_.map(e.taginfo,function(e){return e.name}).join("，")),t%5===0&&(a[t/5]=[]),a[Math.floor(t/5)].push(e)}),this.setListHtml(a)},setListHtml:function(e){var t=['<div class="item hw-onebox{{if $index<1}} active{{/if}}">',"{{each item as one}}",'<a class="hw-one" href="{{one.entityID | toStorePath}}" target="_blank">','<img src="{{one.logo[0].path | absImage}}" />',"<h4>{{one.name_cn || one.name_en}}</h4>",'<p class="hw-p">{{one.city}} {{one.state}}</p>','<p class="hw-n">{{one.taglist}}</p>',"</a>","{{/each}}","</div>"].join(""),i=['<div id="carousel-22" class="carousel slide" data-ride="carousel">','<ol class="carousel-indicators">',"{{each list as item}}",'<li data-target="#carousel-22" data-slide-to="{{$index}}" class="{{if $index<1}}active{{/if}}"></li>',"{{/each}}","</ol>",'<div class="carousel-inner" init-self="true" role="listbox">',"{{each list as item}}",t,"{{/each}}","</div>",'<a class="left carousel-control" href="#carousel-22" init-self="true" role="button" data-slide="prev">','<span class="icon fa fa-angle-left" aria-hidden="true"></span>',"</a>",'<a class="right carousel-control" href="#carousel-22" init-self="true" role="button" data-slide="next">','<span class="icon fa fa-angle-right" aria-hidden="true"></span>',"</a>","</div>"].join("");i=template.compile(i)({list:e}),this.jq.box.html(i),this.jq.box.find(".carousel").carousel({interval:5e3})}}),KG.Class.define("HWSiteIndexHotArticle",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="hw-HWSiteIndexHotArticle">',"<dt>","<label>生活指南</label>","</dt>",'<dd class="js_box"></dd>',"</div>"].join("")},setJqVar:function(){return{box:this.elem.find(".js_box")}},setLeftBox:function(e,t){var i=['<div class="detail lef">','<h2 class="stitle">最新文章</h2>','<a href="{{top.id | toArticlePath}}" target="_blank" class="fl top">','<div class="topimg">','<img class="" alt="" src="{{top.pic | absImage}}">',"</div>",'<div class="toptitle">{{top.title}}</div>','<div class="toptext">',"{{top.description}}","</div>","</a>",'<div class="m20">','<div class="list">','<ul class="l_ul1">',"{{each list as item}}",'<li> <span class="round">●</span><a target="_blank" class="check_more2" href="{{item.id | toArticlePath}}">{{item.title}}</a> </li>',"{{/each}}","</ul>","</div>","</div>","</div>"].join("");i=template.compile(i)({top:e,list:t}),this.jq.box.append(i)},setRightBox:function(e){var t=['<div class="detail rig">','<h2 class="stitle">热门文章</h2>','<div class="m20">','<div class="list">','<ul class="l_ul1">',"{{each list as item index}}",'<li> <strong class="roundb"><span>{{index+1}}</span></strong>','<a target="_blank" class="check_more2" href="{{item.id | toArticlePath}}">{{item.title}}</a></li>',"{{/each}}","</ul>","</div>","</div>","</div>"].join("");t=template.compile(t)({list:e}),this.jq.box.append(t)},registerMessage:function(e,t){this.setLeftBox(t.top,t.list),this.setRightBox(t.right)}}),KG.Class.define("HWSiteIndexDataComp",{ParentClass:"BaseComponent",getTemplate:function(){return'<div class="nodis"></div>'},getData:function(){util.loading(!0),KG.request.getSiteHomePageData({},function(e,t){console.log(t),util.loading(!1),KG.component.initWithElement($('div[role="HWIndexFocesImage"]'),{list:t.votes}),KG.component.initWithElement($('div[role="HWIndexHotNavComp"]'),t.bar_hot),util.message.publish("HWSiteIndexHotCoupon",t.classifiedinfo),util.message.publish("HWSiteIndexNewStoreRecommend",t.biz),util.message.publish("HWSiteIndexHotArticle",{top:t.lifetools.lifetools_top,list:t.lifetools.lifetools_new,right:t.lifetools.lifetools_hot})})}});
KG.Class.define("SiteStoreFilterComp",{ParentClass:"BaseComponent",getTemplate:function(){return['<div style="min-height: 50px;" class="hw-SiteStoreFilterComp">','<div class="c">',"<label>营业特色</label>",'<p class="js_cat">',"</p>","</div>",'<div class="c js_dybox">',"</div>",'<div class="c">',"<label>地区</label>",'<p class="js_loc">',"</p>","</div>","</div>"].join("")},initStart:function(){this.tag=null,this.dy={},this.region=null},setTagListHtml:function(t){var i=_.values(t),a=['<span param="all">不限</span>',"{{each list as item}}",'<span param="{{item.tag_id}}">{{item.name}}</span>',"{{/each}}"].join("");a=template.compile(a)({list:i}),this.jq.catBox.html(a)},setDynamicListHtml:function(t){var i=["<label>{{title}}</label>",'<p class="">','<span dy_id="{{id}}" param="all">不限</span>',"{{each list as val}}",'<span dy_id="{{id}}" param="{{val}}">{{val}}</span>',"{{/each}}","</p>"].join(""),a="";_.each(t,function(t,e){a+=template.compile(i)({title:t.field_name,list:t.options,id:e})}),this.jq.dybox.html(a)},setRegionListHtml:function(t){var i=['<span param="all">不限</span>',"{{each list as item}}",'<span param="{{item.id}}">{{item.name}}</span>',"{{/each}}"].join("");i=template.compile(i)({list:t}),this.jq.locBox.html(i)},getData:function(t,i,a){a({})},setJqVar:function(){return{catBox:this.elem.find(".js_cat"),locBox:this.elem.find(".js_loc"),dybox:this.elem.find(".js_dybox")}},initEvent:function(){var t=this;this.jq.catBox.on("click","span",function(i){var a=$(this);return a.hasClass("active")?!1:(t.jq.catBox.find("span").removeClass("active"),a.addClass("active"),t.tag=a.attr("param"),void t.setFilter())}),this.jq.locBox.on("click","span",function(i){var a=$(this);return a.hasClass("active")?!1:(t.jq.locBox.find("span").removeClass("active"),a.addClass("active"),t.region=a.attr("param"),void t.setFilter())}),this.jq.dybox.on("click","span",function(i){var a=$(this);return a.hasClass("active")?!1:(a.parent().find("span").removeClass("active"),a.addClass("active"),t.dy[a.attr("dy_id")]=a.attr("param"),void t.setFilter())})},setFilter:function(){var t={subtag:"all"!==this.tag?this.tag:"-1",subregion:"all"!==this.region?this.region:"-1"};t.dy={},_.each(this.dy,function(i,a){"all"!==i&&(t.dy["dyf_"+a+"_s"]=i)}),console.log(t),util.message.publish("HWSiteStoreListPage",t)},initEnd:function(){},setHtmlEnd:function(t){var i=t.catId||"all",a=t.regionId||"all";this.jq.catBox.find('span[param="'+i+'"]').addClass("active"),this.jq.locBox.find('span[param="'+a+'"]').addClass("active"),this.jq.dybox.find('span[param="all"]').addClass("active")},registerMessage:function(t,i){this.setTagListHtml(i.catlist),this.setDynamicListHtml(i.dynamic.option),this.setRegionListHtml(i.subregion),this.setHtmlEnd(i)}}),KG.Class.define("SiteStoreAscComp",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="hw-SiteStoreAscComp">','<div class="hw-box">','<label><input checked="true" type="radio" param="0" name="SiteStoreAscComp" />查看全部</label>','<label><input type="radio" param="4" name="SiteStoreAscComp" />只看优惠商家</label>','<label><input type="radio" param="3" name="SiteStoreAscComp" />只看认证商家</label>',"</div>","</div>"].join("")},initEvent:function(){this.elem.find(".hw-box label input").change(function(t){var i=$(this);if(i.prop("checked")){var a=i.attr("param");util.message.publish("HWSiteStoreListPage",{publisher_type:a})}})},initEnd:function(){}}),KG.Class.define("HWSiteStoreListPage",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="hw-HWSiteStoreListPage">','<div role="SiteStoreFilterComp"></div>','<div role="SiteStoreAscComp"></div>','<div class="box js_box nodis"></div>','<div class="box1 js_box1 nodis"></div>','<div class="hw-cpage js_cpage"></div>',"</div>"].join("")},initStart:function(){this.page=1,this.dy={},this.publisher_type=0},setJqVar:function(){return{box:this.elem.find(".js_box"),box1:this.elem.find(".js_box1"),pageBox:this.elem.find(".js_cpage")}},getData:function(t,i,a){var e=this;return this.tagId=util.url.param("tag"),this.subTagId=util.url.param("subtag"),this.regionId=util.url.param("subregion"),this.tagId?(util.loading(!0),void e.getListData(function(t){a({}),util.message.publish("SiteStoreFilterComp",{catlist:t.second_tagid,dynamic:t.dy_fields,subregion:t.subregion,catId:e.subTagId,regionId:e.regionId}),util.loading(!1),e.setBoxHtml(t.list)})):void alert("wrong param")},registerMessage:function(t,i){var a=this;i.subtag&&(this.subTagId=i.subtag),i.subregion&&(this.regionId=i.subregion),i.dy&&(this.dy=i.dy),i.publisher_type&&(this.publisher_type=i.publisher_type),this.page=1,util.loading(!0),this.getListData(function(t){a.setBoxHtml(t.list,!1),util.loading(!1)})},initEvent:function(){var t=this;this.jq.pageBox.on("click",".js_more",function(){t.jq.pageBox.find(".loading").show(),t.jq.pageBox.find(".js_more").hide(),t.page++,t.getListData(function(i){t.setBoxHtml(i.list,!0)})}),this.elem.on("click",".js_coupon_item",function(t){var i=$(this).attr("param");return util.dialog.showCouponDetail(i),!1})},checkLoadingState:function(t){var i=this;t.length>19?(i.jq.pageBox.show(),i.jq.pageBox.find(".loading").hide(),i.jq.pageBox.find(".js_more").show()):i.jq.pageBox.hide()},initEnd:function(){this.setLoadingStateHtml()},getListData:function(t){var i=this,a={tag:this.tagId,subtag:this.subTagId,subregion:this.regionId,publisher_type:this.publisher_type,dy:this.dy,page:this.page};"-1"===a.subtag&&delete a.subtag,"-1"===a.subregion&&delete a.subregion,KG.request.getStoreListByTag(a,function(a,e){a&&(t(e),i.checkLoadingState(e.list))})},getItemTemplate:function(){return["{{each list as item}}",'<a href="{{item.entityID_i | toStorePath}}" target="_blank" class="hw-one">','<div class="hw-logo"><img src="{{item.logo[0].path | absImage}}" /></div>','<div class="right">',"<h4>{{item.name_cn_cntmw}}</h4>",'<span class="hw-address">{{item | storeFullAddress}}</span>',"</div>","</a>","{{/each}}"].join("")},getItemTemplate1:function(){return["{{each list as item}}",'<a href="{{item.entityID | toStorePath}}" target="_blank" class="hw-one1">','<div class="hw-logo" role="BaseLoadingImageBox" data-url="{{item | logoPath}}"></div>','<div class="right">',"<h4>{{item.name_cn || item.name_en}}</h4>",'{{if item.verified_time}}<i class="icon icon-v">v</i>{{/if}}','<div class="ca">','<div class="hw-star" role="StarRank" data-rank="{{item.star}}"></div>',"<span>{{item.commentnum}}条评论</span>","</div>",'<div class="hw-address">地址 : {{item | storeFullAddress}}</div>',"{{if item.event}}",'<div param="{{item.event.pk_id}}" class="hw-coupon js_coupon_item">','<i class="icon"></i>{{item.event.subject}}',"</div>","{{/if}}","</div>","</a>","{{/each}}"].join("")},setBoxHtml:function(t,i){i=i||!1;var a=this.getItemTemplate1();a=template.compile(a)({list:t}),i?this.jq.box1.append(a).show():this.jq.box1.html(a).show(),KG.component.init(this.jq.box1)},setLoadingStateHtml:function(){var t=['<nav class="c-lb"><i class="loading" style="display: none;"></i><b class="js_more">加载更多</b></nav>'].join("");this.elem.find(".js_cpage").html(t)},setIndexPageHtml:function(t){for(var i=["<nav>",'<ul class="pagination">',"<li>",'<a href="javascript:void(0)" class="js_prev">上一页</a>',"</li>","{{each pageList as item}}",'<li><a href="javascript:void(0)" class="js_p">{{item}}</a></li>',"{{/each}}","<li>",'<a href="javascript:void(0)" class="js_next">下一页</a>',"</li>","</ul>","</nav>"].join(""),a=t.totalPage||5,e=[],s=0;a>s;s++)e.push(s+1);i=template.compile(i)({pageList:e}),this.jq.pageBox.html(i)}});
KG.Class.define("SiteCouponFilterComp",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="hw-SiteCouponFilterComp">','<div class="c">',"<label>优惠分类</label>",'<p class="js_cat">',"</p>","</div>",'<div class="c js_dybox">',"</div>",'<div class="c">',"<label>地区</label>",'<p class="js_loc">',"</p>","</div>","</div>"].join("")},initStart:function(){this.tag=null,this.region=null},setTagListHtml:function(t){var i=_.values(t),a=['<span param="all">不限</span>',"{{each list as item}}",'<span param="{{item.pk_id}}">{{item.name}}</span>',"{{/each}}"].join("");a=template.compile(a)({list:i}),this.jq.catBox.html(a)},setRegionListHtml:function(t){var i=['<span param="all">不限</span>',"{{each list as item}}",'<span param="{{item.id}}">{{item.name}}</span>',"{{/each}}"].join("");i=template.compile(i)({list:t}),this.jq.locBox.html(i)},getData:function(t,i,a){a({})},setJqVar:function(){return{catBox:this.elem.find(".js_cat"),locBox:this.elem.find(".js_loc")}},initEvent:function(){var t=this;this.jq.catBox.on("click","span",function(i){var a=$(this);return a.hasClass("active")?!1:(t.jq.catBox.find("span").removeClass("active"),a.addClass("active"),t.tag=a.attr("param"),void t.setFilter())}),this.jq.locBox.on("click","span",function(i){var a=$(this);return a.hasClass("active")?!1:(t.jq.locBox.find("span").removeClass("active"),a.addClass("active"),t.region=a.attr("param"),void t.setFilter())})},setFilter:function(){var t={tag:"all"!==this.tag?this.tag:"all",subregion:"all"!==this.region?this.region:"all"};console.log(t),util.message.publish("HWSiteCouponListPage",t)},initEnd:function(){},setHtmlEnd:function(t){var i=t.catId||"all",a=t.regionId||"all";this.jq.catBox.find('span[param="'+i+'"]').addClass("active"),this.jq.locBox.find('span[param="'+a+'"]').addClass("active")},registerMessage:function(t,i){this.setTagListHtml(i.catlist),this.setRegionListHtml(i.subregion),this.setHtmlEnd(i)}}),KG.Class.define("SiteCouponAscComp",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="hw-SiteCouponAscComp">',"<b>&nbsp;</b>","</div>"].join("")}}),KG.Class.define("HWSiteCouponListPage",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="hw-HWSiteCouponListPage">','<div role="SiteCouponFilterComp"></div>','<div style="margin-top: 24px;" class="nodis" role="SiteCouponAscComp"></div>','<div class="box js_box nodis"></div>','<div class="box1 js_box1 nodis"></div>','<div class="hw-cpage js_cpage"></div>',"</div>"].join("")},initStart:function(){this.lastid=null,this.listData=[]},setJqVar:function(){return{box:this.elem.find(".js_box"),box1:this.elem.find(".js_box1"),pageBox:this.elem.find(".js_cpage")}},getData:function(t,i,a){var s=this;this.tagId=util.url.param("tag")||null,this.regionId=util.url.param("subregion"),util.loading(!0),s.getListData(function(t){console.log(t),s.listData=t.list,util.message.publish("SiteCouponFilterComp",{catlist:t.event_tag,subregion:t.subregion,catId:s.tagId,regionId:s.regionId}),util.loading(!1),s.setBoxHtml(t.list)}),a({})},registerMessage:function(t,i){var a=this;this.tagId=i.tag,this.regionId=i.subregion,this.lastid=null,this.listData=[],util.loading(!0),this.getListData(function(t){a.listData=t.list,a.setBoxHtml(t.list,!1),util.loading(!1)})},initEvent:function(){var t=this;this.jq.pageBox.on("click",".js_more",function(){t.jq.pageBox.find(".loading").show(),t.jq.pageBox.find(".js_more").hide(),t.page++,t.getListData(function(i){t.listData=t.listData.concat(i.list),t.setBoxHtml(i.list,!0)})}),this.jq.box.on("click",".hw-one",function(t){var i=$(this).attr("param");util.dialog.showCouponDetail(i)})},checkLoadingState:function(t){t=t||[];var i=this;t.length>19?(i.jq.pageBox.show(),i.jq.pageBox.find(".loading").hide(),i.jq.pageBox.find(".js_more").show()):i.jq.pageBox.hide()},initEnd:function(){this.setLoadingStateHtml(),util.url.param("viewid")&&util.dialog.showCouponDetail(util.url.param("viewid"))},getListData:function(t){var i=this;this.lastid=_.last(this.listData)?_.last(this.listData).pk_id:null;var a={};"all"!==this.tagId&&(a.tag=this.tagId,this.lastid=_.last(this.listData)?_.last(this.listData).bizinfo.entityID:null),"all"!==this.regionId&&(a.subregion=this.regionId),a.lastid=this.lastid,KG.request.getCouponListByTag(a,function(a,s){a&&(t(s),i.checkLoadingState(s.list))})},getItemTemplate:function(){return["{{each list as item}}",'<div param="{{item.pk_id}}" class="hw-one">','<div role="BaseLoadingImageBox" data-url="{{item | logoPath}}" class="hw-logo"></div>','<a href="{{item.bizinfo.entityID | toStorePath}}"><h4>{{item.bizinfo.name_cn || item.bizinfo.name_en}}</h4></a>','<div class="hw-address">{{item.bizinfo.city}} {{item.bizinfo.state}}</div>',"<h3>{{item.subject}}</h3>","</div>","{{/each}}"].join("")},setBoxHtml:function(t,i){i=i||!1;var a=this.getItemTemplate();a=template.compile(a)({list:t}),i?this.jq.box.append(a).show():this.jq.box.html(a).show(),KG.component.init(this.jq.box)},setLoadingStateHtml:function(){var t=['<nav class="c-lb"><i class="loading" style="display: none;"></i><b class="js_more">加载更多</b></nav>'].join("");this.elem.find(".js_cpage").html(t)},setIndexPageHtml:function(t){for(var i=["<nav>",'<ul class="pagination">',"<li>",'<a href="javascript:void(0)" class="js_prev">上一页</a>',"</li>","{{each pageList as item}}",'<li><a href="javascript:void(0)" class="js_p">{{item}}</a></li>',"{{/each}}","<li>",'<a href="javascript:void(0)" class="js_next">下一页</a>',"</li>","</ul>","</nav>"].join(""),a=t.totalPage||5,s=[],e=0;a>e;e++)s.push(e+1);i=template.compile(i)({pageList:s}),this.jq.pageBox.html(i)}});
KG.Class.define("SiteAticleListLeftNav",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="hw-SiteAticleListLeftNav">',"{{each list as item}}",'<a class="h4" href="articlelist.html?category={{item.category_id}}">{{item.name}}</a>',"{{/each}}","</div>"].join("")},getData:function(t,i,e){var a=[],s=util.url.param("category");KG.request.getArticleCategoryList({},function(t,i){a=[{category_id:"hot",name:"热门精选"}].concat(i).concat(a),e({list:a,cat:s.toString()})})},initEvent:function(){},initEnd:function(){var t=this,i=this.data.cat,e=_.findIndex(this.data.list,function(t){return t.category_id===i});this.elem.find(".h4").eq(e).addClass("active"),util.message.publish("HWSiteArticleListPage",{category:t.data.list[e]}),this.elem.affix({offset:{top:this.elem.offset().top}})}}),KG.Class.define("HWSiteArticleListPage",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="hw-HWSiteArticleListPage">','<div class="hw-head">','<label class="js_title"></label>',"</div>",'<div class="hw-box js_box"></div>','<div class="hw-cpage js_cpage"></div>',"</div>"].join("")},getData:function(t,i,e){var a=KG.data.get("categoryID");console.log(a),util.loading(!0),KG.request.getSiteArticleList({category:a},function(t,i){util.loading(!1),t&&(console.log(i),e({list:i.list,cat:a}))})},initEnd:function(){this.setBoxHtml(this.data.list),this.setLoadingStateHtml(),this.data.list.length>0?(this.lastid=this.data.list[this.data.list.length-1].id,this.jq.pageBox.find(".loading").hide(),this.jq.pageBox.find(".js_more").show()):this.jq.pageBox.hide()},setTitle:function(t){this.elem.find(".js_title").html(t)},registerMessage:function(t,i){var e=i.category;this.setTitle(e.name)},getItemTemplate:function(){return["{{each list as item}}",'<div  class="hw-one">','<div class="hw-img" role="BaseLoadingImageBox" data-url="{{item | logoPath}}"></div>','<a target="_blank" href="../view/article.html?id={{item.id}}" class="hw-h4">{{item.title}}</a>',"{{if item.bizinfo}}",'<a href="../view/store.html?id={{item.bizinfo.entityID}}" target="_blank" class="hw-biz">','<img src="{{item.bizinfo | logoPath}}" />',"<b>{{item.bizinfo.name_cn || item.bizinfo.name_en}}</b>","<p>{{item.bizinfo | storeFullAddress}}</p>","</a>","{{else}}","<h6>{{item.description | decode}}</h6>","{{/if}}","<p>",'<span class="hw-time">{{item.dateline | formatDate:"yy年mm月dd日"}}</span>','<span class="hw-view">','<i class="fa fa-eye"></i>',"{{item.reads}}","</span>","</p>","</div>","{{/each}}"].join("")},setBoxHtml:function(t){_.map(t,function(t){return t.description=t.msgbody.replace(/<([^>]*)>/g,""),t});var i=this.getItemTemplate();i=template.compile(i)({list:t}),this.elem.find(".js_box").append(i),KG.component.init(this.elem.find(".js_box"))},initVar:function(){this.lastid=this.data.length>0?this.data.list[this.data.list.length-1].id:null},setJqVar:function(){return{pageBox:this.elem.find(".js_cpage")}},initEvent:function(){var t=this;this.jq.pageBox.on("click",".js_more",function(){t.jq.pageBox.find(".loading").show(),t.jq.pageBox.find(".js_more").hide(),KG.request.getSiteArticleList({category:t.data.cat,lastid:t.lastid},function(i,e){i&&(t.setBoxHtml(e.list),e.list.length>0?(t.lastid=e.list[e.list.length-1].id,t.jq.pageBox.find(".loading").hide(),t.jq.pageBox.find(".js_more").show()):t.jq.pageBox.hide())})})},setLoadingStateHtml:function(){var t=['<nav class="c-lb"><i class="loading" style="display: none;"></i><b class="js_more">加载更多</b></nav>'].join("");this.elem.find(".js_cpage").html(t)},setIndexPageHtml:function(t){for(var i=["<nav>",'<ul class="pagination">',"<li>",'<a href="javascript:void(0)" class="js_prev">上一页</a>',"</li>","{{each pageList as item}}",'<li><a href="javascript:void(0)" class="js_p">{{item}}</a></li>',"{{/each}}","<li>",'<a href="javascript:void(0)" class="js_next">下一页</a>',"</li>","</ul>","</nav>"].join(""),e=t.totalPage||5,a=[],s=0;e>s;s++)a.push(s+1);i=template.compile(i)({pageList:a}),this.elem.find(".js_cpage").html(i)}});
!function(){KG.Class.define("HWSiteArticleDetailPage",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="hw-SiteArticleDetailPage">','<a class="hw-tag" href="../site/articlelist.html?category=hot">精选内容<a/>{{if category}} <span class="hw-tag">|</span> <a href="../site/articlelist.html?category={{category.category_id}}" class="hw-tag">{{category.name}}</a>{{/if}}',"<h3>{{data.title}}</h3>",'<p class="hw-st">','<span class="hw-time">{{data.dateline | formatDate:"yy年mm月dd日"}}</span>','<span class="hw-wx js_share">','<i class="fa fa-weixin"></i>',"分享","</span>",'<span class="hw-view">','<i class="fa fa-eye"></i>',"{{data.reads}}","</span>","</p>","{{if bizInfo}}",'<a class="hw-biz" href="{{bizInfo.entityID | toStorePath}}" style="display: block;">','<img src="{{bizInfo | logoPath}}" />',"<h6>{{bizInfo.name_cn}}</h6>",'<p class="hw-p">{{bizInfo | storeFullAddress}}</p>',"</a>","{{/if}}",'<div class="hw-article">{{#data.msgbody}}</div>','<div class="hw-share">','<b class="js_share"><i class="fa fa-weixin"></i>分享文章到微信</b>',"</div>","</div>"].join("")},getData:function(i,t,e){var a=KG.data.get("id");util.loading(!0),KG.request.getStoreArticleDetail({id:a},function(i,t){if(console.log(t),util.loading(!1),i){try{t.view.msgbody=decodeURIComponent(t.view.msgbody)}catch(s){}console.log(t.view.msgbody),t.view.msgbody=util.replaceHtmlImgSrcToAbsolute(t.view.msgbody),e({id:a,data:t.view,category:t.category,bizInfo:t.biz}),util.message.publish("HWSiteArticleDetailRightMoreCommentComp",{hotList:t.hot}),t.relative&&util.message.publish("HWSiteArticleDetailMoreComp",{list:t.relative,biz:t.biz})}})},initEvent:function(){var i=this.data.id;this.elem.on("click",".js_share",function(){util.dialog.showQrCode(util.path.toMSiteArticle(i),"打开微信扫一扫以下二维码即可打开本页面，点击屏幕右上角分享按钮")})}}),KG.Class.define("HWSiteArticleDetailMoreComp",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="hw-HWSiteArticleDetailMoreComp no_dis">','<div class="hw-head">','<label class="js_title">本店更多文章</label>',"</div>",'<div class="hw-box js_box">',"</div>","</div>"].join("")},getData:function(i,t,e){e({})},registerMessage:function(i,t){this.setListHtml(t.list,t.biz)},initEvent:function(){this.elem.on("click",".hw-biz",function(){var i=$(this).attr("param");return location.href=i,!1})},setListHtml:function(i,t){var e=["{{each list as item}}",'<a class="hw-one" style="display: block" href="article.html?id={{item.id}}">','<div class="hw-img" role="BaseLoadingImageBox" data-url="{{item.pic | absImage}}"></div>',"<h4>{{item.title}}</h4>",'<div param="{{bizInfo.entityID | toStorePath}}" class="hw-biz">','<img src="{{bizInfo | logoPath}}" />',"<h6>{{bizInfo.name_cn}}</h6>",'<p class="hw-p">{{bizInfo | storeFullAddress}}</p>',"</div>",'<p style="display: block;">','<span class="hw-time">{{item.msgbody | htmlToText}}</span>','<span class="hw-view">','<i class="fa fa-eye"></i>',"{{item.reads}}","</span>","</p>","</a>","{{/each}}"].join("");e=template.compile(e)({list:i||[],bizInfo:i.length>0?i[0].bizinfo:{}}),this.elem.find(".js_box").html(e),KG.component.init(this.elem.find(".js_box")),i.length>0&&this.elem.removeClass("no_dis")}}),KG.Class.define("HWSiteArticleDetailRightMoreCommentComp",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="hw-HWSiteArticleDetailRightMoreCommentComp">','<div class="hw-head">','<label class="js_title">热门文章</label>',"</div>",'<div class="hw-box js_box">',"</div>","</div>"].join("")},setListHtml:function(i){var t=["{{each list as item}}",'<a href="article.html?id={{item.id}}" class="hw-one">',"<h4>{{item.title}}</h4>","</a>","{{/each}}"].join("");t=template.compile(t)({list:i||[]}),this.elem.find(".js_box").html(t)},getData:function(i,t,e){e({})},registerMessage:function(i,t){this.setListHtml(t.hotList)}})}();
KG.Class.define("HWSiteStoreBigBackgroundImage",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="c-bg"><img src="" /></div>'].join("")},registerMessage:function(t,e){this.elem.css({top:$(".hw-site-page").offset().top-24}),this.elem.find("img").attr("src",e)}}),KG.Class.define("UploadStoreCommentImage",{ParentClass:"BaseUploadImage",getTemplate:function(){return['<div class="hw-UploadStoreCommentImage">','<div class="hw-add js_add">','<i class="icon fa fa-plus-square-o"></i>',"<p>上传图片</p>",'<input class="js_input" type="file" />',"</div>","</div>"].join("")},defineProperty:function(){return{image:{}}},getData:function(t,e,i){i({image:this.prop.image})},setAddStatus:function(t){var e;e=t?"上传中...":"上传图片",this.jq.add.find("p").html(e)},setJqVar:function(){return{add:this.elem.find(".js_add"),fileInput:this.elem.find('input[type="file"]')}},initEvent:function(){var t=this;this.jq.fileInput.change(function(){var e=this.files[0];t.setAddStatus(!0),t.uploadImageFn(e,function(e,i){t.addNewImage(e),t.check(),t.setAddStatus(!1)}),$(this).val("")}),this.elem.on("click",".js_del",function(){var e=$(this);return util.dialog.confirm1({YesText:"删除",msg:"您确定要删除这张照片吗？",YesFn:function(i){e.parent(".js_img").remove(),t.check(),i()}}),!1})},check:function(){var t=this.getValue();t.length>4?this.jq.add.hide():this.jq.add.show()},getValue:function(){var t=this.elem.find(".js_img");return _.map(t,function(t){return $(t).find("img").attr("src")})},getEachHtml:function(t){var e=['<div class="hw-one js_img">','<img src="{{url}}" />','<b class="js_del">删除</b>',"</div>"].join("");return template.compile(e)({url:t})},addNewImage:function(t){var e=this.getEachHtml(t);this.jq.add.after(e)},uploadImageFn:function(t,e){util.uploadImage(t,function(t){var t=KG.config.SiteRoot+t;e(t)})},reset:function(){this.elem.find(".js_img").remove(),this.check()}}),KG.Class.define("HWSiteStoreDetailPage",{ParentClass:"BaseComponent",getTemplate:function(){var t=['<div class="c-top">','<img class="hw-logo" src="{{biz.logo[0].path | absImage}}" />','{{if biz.verified=="unverified"}}<p class="hw-renling">申请认领</p>{{/if}}','<div class="c-r">','<h4>{{biz.name_cn||biz.name_en}}{{if biz.verified=="yes"}}<i class="icon icon-v">v</i>{{/if}}</h4>','<div class="hw-star" role="StarRank" data-rank="{{biz.star}}"></div>','<a href="#hw-id-reply" class="hw-rp">{{biz.commentnum}}条评论</a>','<p class="hw-p">地址：{{biz | storeFullAddress}}</p>','<p class="hw-p">特色：{{biz.tag_name}}</p>','<p class="hw-p">电话：{{biz.tel}}</p>','{{if biz.events&&biz.events[0]}}<p param="{{biz.events[0].pk_id}}" class="hw-coupon js_coupon_item"><i class="icon"></i>{{biz.events[0].subject}}</p>{{/if}}',"</div>",'<b class="hw-act js_fav" style="left:750px;"><i class="icon fa fa-heart-o"></i>收藏</b>','<b class="hw-act js_reply" style="left: 850px;"><i class="icon fa fa-pencil-square-o"></i>评论</b>','<b class="hw-act js_share" style="left: 950px;"><i class="icon fa fa-wechat"></i>分享</b>',"</div>"].join(""),e=['<div style="margin-top: 16px;" class="c-box">','<dt class="c-title"><p>简介</p></dt>','<dd class="c-content hw-brief">',"{{biz.briefintro | htmlToText}}","</dd>","</div>"].join(""),i=['<div style="margin-top: 16px;" class="c-box">','<div style="width:100%;height: 300px;" class="js_map"></div>','<dd class="c-content">',"{{each biz.dynamic_list as item}}","{{if item.value}}",'<p class="hw-la">{{item.title}} : {{item.value}}</p>',"{{/if}}","{{/each}}","</dd>","</div>"].join(""),a=['<div style="margin-top: 15px;" class="c-box">','<dt class="c-title"><p>营业时间</p></dt>','<dd class="c-content">',"{{each biz.timeinfo_list as item}}",'<p class="hw-la">{{item.day}} : {{item.time}}</p>',"{{/each}}","</dd>","</div>"].join(""),s=["{{if biz.events.length>0}}",'<div style="margin-top: 15px;" class="c-box">','<dt class="c-title"><p>本店优惠</p></dt>','<dd class="c-content js_coupon_box" style="padding: 0 15px;">',"</dd>","</div>","{{/if}}"].join(""),n=["{{if biz.articles.length>0}}",'<div style="margin-top: 15px;" class="c-box">','<dt class="c-title"><p>本店文章</p></dt>','<dd class="c-content js_article_box" style="padding: 0 15px;">',"</dd>","</div>","{{/if}}"].join(""),o=["{{if biz.files.length > 0}}",'<div style="margin-top: 15px;" class="c-box">','<dt class="c-title">',"<p>图片 ({{biz.files.length}})</p>",'<b class="js_showimg hand">全部图片</b>',"</dt>",'<dd class="c-content hw-imglist" style="padding: 0 15px;">',"{{if biz.files.length>0}}",'<div id="carousel-11" class="carousel slide" data-ride="carousel">','<div class="carousel-inner" init-self="true" role="listbox">',"{{each biz.image_list as item}}",'<div class="item{{if $index<1}} active{{/if}}">',"{{each item as one}}",'<div class="img-item js_cimg" param="{{one.index}}" data-url="{{one.path | absImage}}" role="BaseLoadingImageBox"></div>',"{{/each}}","</div>","{{/each}}","</div>",'<a class="left carousel-control" href="#carousel-11" init-self="true" role="button" data-slide="prev">','<span class="glyphicon glyphicon-chevron-left glyphicon-menu-left" aria-hidden="true"></span>',"</a>",'<a class="right carousel-control" href="#carousel-11" init-self="true" role="button" data-slide="next">','<span class="glyphicon glyphicon-chevron-right glyphicon-menu-right" aria-hidden="true"></span>',"</a>","</div>","{{/if}}","</dd>","</div>","{{/if}}"].join(""),l=['<div id="hw-id-reply" style="margin-top: 15px;" class="c-box js_cmbox">','<dt class="c-title">',"<p>评论</p>","</dt>",'<dd class="c-content" style="padding: 0">','<div class="db hw-wp">','<a href="javascript:void(0)" class="hw-img">',"{{if user.isLogin}}",'<img src="{{user.image}}" />',"<p>{{user.nick}}</p>","{{else}}",'<img src="{{user.defaultImage}}" />',"<p>未登录用户</p>","{{/if}}","</a>",'<div class="r hw-time">','<div class="js_rank" style="margin-top:2px;" role="StarRank" data-enable="true" data-rank="0"></div>',"</div>",'<div class="r hw-ta nodis">','<textarea class="form-control" placeholder="请写下您的评论~"></textarea>','<div class="js_comment_img" role="UploadStoreCommentImage"></div>','<button data-loading-text="发表中..." class="hw-btn hw-blue-btn">发表评论</button>',"</div>","</div>",'<div class="df js_rpcat">','<b class="">全部评论</b>',"<b>图片评论</b>","</div>",'<div class="dp"></div>','<nav class="hw-loadingmore-bar"><i class="loading" style="display: none;"></i><b class="js_more">加载更多</b></nav>',"</dd>","</div>"].join("");return['<div class="hw-HWSiteStoreDetailPage">',t,'<div class="hw-left-box">',o,s,n,l,"</div>",'<div class="hw-right-box">',a,i,e,"</div>","</div>"].join("")},makeBizData:function(t){var e=_.map(t.tags,function(t){return t.name});t.tag_name=e.join("，"),e=_.map(t.dyfields,function(t){return{title:t.field_name,value:_.isArray(t.value)?t.value.join("，"):t.value}}),t.dynamic_list=e;var i={monday:"周一",tuesday:"周二",wednesday:"周三",thursday:"周四",friday:"周五",saturday:"周六",sunday:"周日"};return e=[],console.log(t.timeinfo),t.timeinfo&&_.each(t.timeinfo.format,function(t,a){return t&&_.isArray(t)?void _.each(t,function(t,s){t=t.split(",");var n;n=_.contains(t,"休业")?"休息":t.join(" - ");var o="",l="";o=a.split(" - "),l=i[o[0]],o[1]&&(l+=" - "+i[o[1]]),e.push({day:l,time:n})}):!0}),t.timeinfo_list=e,e=[],_.each(t.files,function(t,i){i%4===0&&(e[Math.floor(i/4)]=[]),t.index=i,e[Math.floor(i/4)][i%4]=t}),t.image_list=e,t.imagelist=_.map(t.files,function(t){return/^http/.test(t.path)?t.path:KG.config.SiteRoot+t.path}),t.articles=_.map(t.articles,function(t){return t.image||(t.image=KG["default"].articleImage),t}),t.role=t.is_owner?"admin":"user",t},initStart:function(){this.bizId=KG.data.get("id"),this.commentData=[],this.commentData_pic=[],this.lastCommentId_pic=null,this.lastCommentId=null,this.commentType="all",this.rpId=null,this.commentImage=null},getData:function(t,e,i){var a=this,s=this.bizId;KG.request.getStoreDetail({id:s},function(t,e){if(t){var n=a.makeBizData(e);i({id:s,biz:n,user:KG.user.get()});var o=n.background_pic.length>5?n.background_pic:KG["default"].BizBigBgPic;util.message.publish("HWSiteStoreBigBackgroundImage",o)}else util.toast.showError(e)})},showFocusImage:function(t){var e=this,i=util.dialog.showFocusImage(t,e.data.biz.imagelist),a='<div style="position: relative;font-size: 16px;line-height: 25px;top:-10px;" class="hand"><i style="margin-right:10px;font-size:18px;position:relative;top:2px;" class="icon glyphicon glyphicon-th"></i>返回相册</div>';a=$(a),a.click(function(){util.dialog.showImageList(e.data.biz.imagelist,function(t){e.showFocusImage(t)})}),i.find(".carousel").before(a)},initEvent:function(){var t=this;this.elem.find(".hw-imglist").on("click",".js_cimg",function(e){var i=$(this).attr("param");t.showFocusImage(i)}),this.elem.on("click",".js_showimg",function(){util.dialog.showImageList(t.data.biz.imagelist,function(e){t.showFocusImage(e)})}),this.elem.find(".c-top").on("click",".js_share",function(){var e=util.path.toMSiteStore(t.bizId);util.dialog.showQrCode(e)}).on("click",".js_fav",function(){var e=$(this);KG.user.get("isLogin")?KG.request.addFavForStore({bizId:t.data.id},function(t,i){t?e.html('<i class="icon fa fa-heart"></i>已收藏').removeClass("js_fav").addClass("js_fav_on"):alert(i)}):util.dialog.showLoginBox()}).on("click",".js_fav_on",function(){var e=$(this);KG.request.deleteMyFavStore({bizId:t.data.id},function(t,i){t&&e.html('<i class="icon fa fa-heart-o"></i>收藏').removeClass("js_fav_on").addClass("js_fav")})}).on("click",".js_reply",function(){KG.user.get("isLogin")?(t.rpId=null,t.showReplyTextarea()):util.dialog.showLoginBox()}),this.elem.find(".js_rank").click(function(){if(!KG.user.get("isLogin"))return util.dialog.showLoginBox(),!1;var e=KG.component.getObj(t.elem.find(".js_rank"));console.log(e.getValue()),parseFloat(e.getValue())>0&&t.showReplyTextarea()}),this.elem.find(".js_cmbox .db .hw-ta").find(".hw-btn").click(function(){t.sendComment($(this))}),this.elem.find(".js_cmbox").on("click",".js_rp",function(e){var i=$(this).closest(".hw-rpeach");if(i.find(".js_rpbox").length>0)return i.find(".js_rpbox").remove(),!1;t.elem.find(".js_cmbox").find(".js_rpbox").remove(),t.rpId=$(this).attr("param");var a=$(t.getCommentRpHtml(t.rpId));a.appendTo(i).slideDown(200,function(){i.find("textarea").focus()})}).on("click",".js_like",function(t){var e=$(t.target).attr("param");KG.request.addLikeToStoreComment({id:e},function(e,i){e&&$(t.target).html("赞("+i+")")})}).on("click",".js_jp",function(e){var i=$(this),a=i.parents(".hw-rpeach").find(".hw-img").find("p[title]").text(),s=i.attr("param");t.showJuBaoReplyDialog({toName:a,id:s})}),this.elem.find(".js_cmbox").on("click",".js_rpbox .hw-btn",function(){var e=t.elem.find(".js_cmbox").find(".js_rpbox"),i=e.attr("param");t.replyComment(i,e)}),this.elem.on("click",".hw-renling",function(e){if(!KG.user.get("isLogin"))return util.dialog.showLoginBox(),!1;var i='<div class="hw-icon"><i class="fa fa-check"></i></div>';util.dialog.show({foot:!0,title:i+"成功提交申请，我们会在24小时内电话联系您。","class":"hw-confirm",body:'<div style="text-align:center;"><div style="width:400px;margin:0 auto;" class="js_tel" role="BaseInput" data-label="请输入您的联系电话" data-require="true" placeholder="e.g. 5107687776"></div></div>',YesFn:function(e){var i=util.dialog.get(),a=KG.component.getObj(i.find(".js_tel")),s=a.getValue();return s?util.validate.AmericanPhone(s)?(a.showError(),void KG.request.pcRenZhengStore({tel:s,bizId:t.bizId},function(t,e){t?util.toast.alert("提交成功， 请留意您的电话"):util.toast.showError(e)})):(a.showError("电话格式错误"),a.focus(),!1):(a.showError("请输入您的联系电话"),a.focus(),!1)},beforeShowFn:function(){var t=this;KG.component.init(t.find(".hw-body"))}})}),this.elem.on("click",".js_coupon_item",function(t){var e=$(this).attr("param");util.dialog.showCouponDetail(e)}),this.elem.on("click",".js_showCommentBidImage",function(t){var e=$(this),i=e.parents(".hw-rpimgbox").find("img");i=_.map(i,function(t){return $(t).attr("src")}),util.dialog.showFocusImage(e.attr("param"),i)});var e=this.elem.find(".js_rpcat").find("b");e.eq(0).click(function(){var i=$(this);return i.hasClass("active")?!1:(i.addClass("active"),e.eq(1).removeClass("active"),t.commentType="all",t.commentData=[],void t.getCommentData(function(t){e.eq(0).html("全部评论("+t.all+")"),e.eq(1).html("图片评论("+t.has_pic+")")}))}),e.eq(1).click(function(){var i=$(this);return i.hasClass("active")?!1:(i.addClass("active"),e.eq(0).removeClass("active"),t.commentType="pic",t.commentData_pic=[],void t.getCommentData(function(t){e.eq(0).html("全部评论("+t.all+")"),e.eq(1).html("图片评论("+t.has_pic+")")}))}),this.elem.find(".js_cmbox").on("click",".js_more",function(e){"pic"===t.commentType?t.lastCommentId_pic=_.last(t.commentData_pic).id:t.lastCommentId=_.last(t.commentData).id,t.getCommentData()})},showReplyTextarea:function(t){var e=this.elem.find(".js_cmbox .db"),i=e.find(".hw-ta");i.hasClass("nodis")&&(util.dom.scrollTo(e.offset().top),i.removeClass("nodis")),t&&i.find("textarea").val(t).focus()},replyComment:function(t,e){var i=this,a=e.find("textarea"),s=a.val();return s?void KG.request.sendStoreComment({bizId:i.bizId,msg:s,id:t},function(a,n){if(e.remove(),a){console.log(n);var o=KG.user.get(),l={basecode:t,dataID:i.bizId,dataType:"2",datetime:(new Date).getTime(),fk_entityID:i.bizId,id:n,is_report:"0",msgbody:s,treelevel:"0",userID:o.userid,userinfo:o},c=_.find(i.commentData,{id:t.toString()});c.reply=l,c.treelevel="0",i.setCommentBoxHtml()}}):void util.dom.showErrorPopover(a,"请输入评论")},sendComment:function(t){var e=this,i=this.elem.find(".js_cmbox .db .hw-ta").find("textarea"),a=i.val();if(!a)return util.dom.showErrorPopover(i,"请输入评论",{trigger:"focus"}),void i.focus();util.dom.showErrorPopover(i,!1);var s=KG.component.getObj(this.elem.find(".js_rank")),n=this.commentImage.getValue(),o={bizId:e.bizId,star:s.getValue()};n.length>0&&(o.has_pic=!0),a+=_.map(n,function(t){return'<img src="'+t+'" />'}).join(""),o.msg=a,t.button("loading"),KG.request.sendStoreComment(o,function(l,c){if(t.button("reset"),l){console.log(c);var r=KG.user.get(),d={basecode:c.toString(),dataID:e.bizId,dataType:"2",datetime:(new Date).getTime(),fk_entityID:e.bizId,id:c.toString(),is_report:"0",msgbody:util.removeHtmlTag(a),star:s.getValue(),treelevel:"0",userID:r.userid,userinfo:r,buzz:0,pic:n};"pic"===e.commentType&&o.has_pic?(e.commentData_pic=[d].concat(e.commentData_pic),e.setCommentBoxHtml()):"all"===e.commentType&&(e.commentData=[d].concat(e.commentData),e.setCommentBoxHtml()),e.setCommentBoxHtml(),s.setValue(0),i.val(""),e.commentImage.reset(),e.rpId=null,e.elem.find(".js_cmbox .db .hw-ta").addClass("nodis")}})},initEnd:function(){var t=this,e=template.helpers.storeFullAddress(this.data.biz),i=KG.data.get("startFN");i&&util.getLatAndLongWithAddress(e,function(e){i(e.lat,e.lng,{name:"Test Store",elem:t.elem.find(".js_map")[0]})}),this.data.biz.is_booked&&this.elem.find(".js_fav").html('<i class="icon fa fa-heart"></i>已收藏').removeClass("js_fav").addClass("js_fav_on"),t.initArticleBox(),t.initCouponBox(),location.hash&&util.delay(function(){location.href=location.hash},1e3),this.elem.find(".js_rpcat").find("b").eq(0).trigger("click"),this.commentImage=KG.component.getObj(this.elem.find(".js_comment_img")),this.showAdsBanner()},getCommentRpHtml:function(t){var e=['<div param="{{replyId}}" style="display: none;" class="js_rpbox c-rp-area">','<textarea class="form-control"></textarea>','<button class="hw-btn hw-blue-btn">回复</button>',"</div>"].join("");return template.compile(e)({replyId:t||""})},getCommentData:function(t){t=t||util.noop;var e=this;this.elem.find(".js_cmbox").find(".c-content .dp").html("");var i=this.elem.find(".js_cmbox .hw-loadingmore-bar"),a=i.find(".loading"),s=i.find(".js_more");a.show(),s.hide(),i.show();var n={bizId:this.bizId};"all"===this.commentType?n.lastid=this.lastCommentId:"pic"===this.commentType&&(n.has_pic=!0,n.lastid=this.lastCommentId_pic),KG.request.getStoreCommentData(n,function(n,o){if(n){console.log(o);var l=o.count;o=o.list,o.length>20?(a.hide(),s.show()):i.hide(),"all"===e.commentType?e.commentData=e.commentData.concat(o):"pic"===e.commentType&&(e.commentData_pic=e.commentData_pic.concat(o)),e.setCommentBoxHtml(),t(l)}else i.hide()})},setCommentBoxHtml:function(){var t=["{{each list as item}}",'<div class="hw-rpeach">','<a href="javascript:void(0)" class="hw-img">','<img src="{{item.userinfo.avatar_url | absImage}}" />','<p title="{{item.userinfo.nick}}">{{item.userinfo.nick}}</p>',"</a>",'<div class="r hw-time">','<div role="StarRank" data-rank={{item.star}}></div>','<span>{{item.datetime | formatDate:"mm/dd/yy"}}</span>',"</div>",'<p class="r hw-msg">{{item.msgbody}}</p>',"{{if item.pic}}",'<div style="margin-top: 10px;" class="hw-rpimgbox">',"{{each item.pic as url index}}",'<div class="hw-center-image"><img class="js_showCommentBidImage hand" param="{{index}}" src="{{url}}" /></div>',"{{/each}}","</div>","{{/if}}",'<p style="margin-top:10px;" class="r hw-action">','{{if role=="admin"}}<span param="{{item.id}}" nick="{{item.userinfo.nick}}" class="js_rp">回复</span>{{/if}}','<span param="{{item.id}}" class="js_like">赞({{item.buzz}})</span>','<span param="{{item.id}}" class="js_jp">举报</span>',"</p>","{{if item.reply}}",'<div class="c-rp">','<img src="{{item.reply.userinfo.avatar_url | absImage}}" />',"<p>店主回复：</p>","<p>{{item.reply.msgbody}}</p>","</div>","{{/if}}","</div>","{{/each}}"].join(""),e=this.elem.find(".js_cmbox"),i=this.commentData;"pic"===this.commentType&&(i=this.commentData_pic),t=template.compile(t)({list:i,role:this.data.biz.role}),e.find(".c-title p").html("评论（"+this.commentData.length+"）"),e.find(".c-content .dp").html(t),KG.component.init(e.find(".c-content .dp"))},initArticleBox:function(){var t=this;if(!this.data.biz.articles||this.data.biz.articles.length<1)return!1;var e=this.elem.find(".js_article_box").data("number",0),i=this.data.biz.articles,a=function(){var a=e.data("number"),s=!1,n=[];i.length>a+5?(s=!0,n=i.slice(0,a+5)):n=i.slice(0,i.length),e.data("number",n.length),t.setArticleListHtml(n,s)};e.on("click",".hw-more",a),a()},setArticleListHtml:function(t,e){var i=this.elem.find(".js_article_box"),a=["{{each list as item}}",'<a href="../view/article.html?id={{item.id}}" target="_blank" style="display: block;" class="hw-item hw-art">','<div class="hw-img" data-url="{{item | logoPath}}" role="BaseLoadingImageBox"></div>',"<h4>{{item.title}}</h4>",'<p class="hw-time">{{item.dateline | formatDate:"mm/dd/yy"}}</p>','<p class="hw-lt">{{item.msgbody | htmlToText}}</p>',"</a>","{{/each}}",'{{if flag}}<p class="hw-more">查看更多</p>{{/if}}'].join("");a=template.compile(a)({list:t,flag:e}),i.html(a),KG.component.init(i)},initCouponBox:function(){var t=this;if(!this.data.biz.events||this.data.biz.events.length<1)return!1;var e=this.elem.find(".js_coupon_box").data("number",0),i=this.data.biz.events,a=function(){var a=e.data("number"),s=!1,n=[];i.length>a+5?(s=!0,n=i.slice(0,a+5)):n=i.slice(0,i.length),e.data("number",n.length),t.setCouponListHtml(n,s)};e.on("click",".hw-more",a),a()},setCouponListHtml:function(t,e){var i=this.elem.find(".js_coupon_box"),a=["{{each list as item}}",'<div class="hw-item hw-cp js_coupon_item" param="{{item.pk_id}}" style="cursor: pointer">','<div class="hw-img" data-url="{{item | logoPath}}" role="BaseLoadingImageBox"></div>',"<h4>{{item.subject}}</h4>",'<p class="hw-lt">{{item.count}}人已领取</p>','<button class="hw-btn hw-blue-btn">立即领取</button>',"</div>","{{/each}}",'{{if flag}}<p class="hw-more">查看更多</p>{{/if}}'].join("");a=template.compile(a)({list:t,flag:e}),i.html(a),KG.component.init(i)},showJuBaoReplyDialog:function(t){var e=t.id,i=['<div class="hw-jubao-box">',"<p>请选择举报类型</p>",'<label class="left"><input value="有害信息" name="jubao" type="radio" /> 有害信息</label>','<label class="right"><input value="色情暴力" name="jubao" type="radio" /> 色情暴力</label>','<label style="top:70px;" class="left"><input value="垃圾广告" name="jubao" type="radio" /> 垃圾广告</label>','<label style="top:70px;" class="right"><input value="无关内容" name="jubao" type="radio" /> 无关内容</label>','<label style="top:110px;" class="left"><input value="其他" name="jubao" type="radio" /> 其他（请写下举报原因）</label>','<textarea class="form-control" row="3"></textarea>',"</div>"].join(""),a={foot:!0,"class":"hw-660-dialog",title:"举报<b>"+t.toName+"</b>的评论",body:i,YesText:"举报",YesFn:function(){var t=util.dialog.get(),i=t.find(".hw-jubao-box"),a=_.filter(i.find("input"),function(t){return $(t).prop("checked")});a=$(a).val(),KG.request.reportStoreComment({id:e,type:a,msgbody:i.find("textarea").val()},function(t,e){t?util.toast.alert("举报成功，感谢您的参与！"):util.toast.showError(e)})},beforeShowFn:function(){var t=$(this),e=t.find(".hw-jubao-box");_.delay(function(){e.find("input").eq(0).prop("checked",!0)},100)}};util.dialog.show(a)},showAdsBanner:function(){if("admin"!==this.data.biz.role)return!1;var t=KG.user.get();if(!t||t.ads_postid)return!1;var e=['<div style="display: none;" class="hw-store-bottom-ads">',"<dd>",'<span>新用户专享，免费推广您的店铺到<a target="_blank" href="http://www.wenxuecity.com">文学城</a>首页</span>','<a href="../mybiz/createAds.html?store='+this.data.id+'" target="_blank" class="hw-btn hw-blue-btn">马上创建</a>',"</dd>","</div>"].join("");util.delay(function(){$(e).appendTo("body").slideDown()},2e3)}});
KG.Class.define("HWSiteSearchStoreListPage",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="hw-HWSiteStoreListPage">','<div class="hw-SiteStoreSearchFilterComp">',"“{{keyword}}”的搜索结果","</div>",'<div class="box js_box nodis"></div>','<div class="box1 js_box1 nodis"></div>','<div class="hw-cpage js_cpage"></div>',"</div>"].join("")},initStart:function(){this.keyword=KG.data.get("keyword"),this.page=1},setJqVar:function(){return{box:this.elem.find(".js_box"),box1:this.elem.find(".js_box1"),pageBox:this.elem.find(".js_cpage")}},getData:function(t,e,i){var a=this;return this.keyword?(util.loading(!0),void a.getListData(function(t){i({keyword:a.keyword}),util.loading(!1),a.setBoxHtml(t)})):void alert("wrong param")},registerMessage:function(t,e){},initEvent:function(){var t=this;this.jq.pageBox.on("click",".js_more",function(){t.jq.pageBox.find(".loading").show(),t.jq.pageBox.find(".js_more").hide(),t.page++,t.getListData(function(e){t.setBoxHtml(e,!0)})}),this.elem.on("click",".js_coupon_item",function(t){var e=$(this).attr("param");return util.dialog.showCouponDetail(e),!1})},checkLoadingState:function(t){var e=this;t.length>19?(e.jq.pageBox.show(),e.jq.pageBox.find(".loading").hide(),e.jq.pageBox.find(".js_more").show()):e.jq.pageBox.hide()},initEnd:function(){this.setLoadingStateHtml()},getListData:function(t){var e=this;KG.request.searchStoreByKeyword({keyword:e.keyword,page:e.page},function(i,a){console.log(a),i?(t(a),e.checkLoadingState(a)):(t([]),e.checkLoadingState([]))})},getItemTemplate1:function(){return["{{each list as item}}",'<a href="{{item.entityID | toStorePath}}" target="_blank" class="hw-one1">','<div class="hw-logo"><img src="{{item.logo[0].path | absImage}}" /></div>','<div class="right">',"<h4>{{item.name_cn || item.name_en}}</h4>",'{{if item.verified_time}}<i class="icon icon-v">v</i>{{/if}}','<div class="ca">','<div class="hw-star" role="StarRank" data-rank="{{item.star}}"></div>',"<span>{{item.commentnum}}条评论</span>","</div>",'<div class="hw-address">地址 : {{item | storeFullAddress}}</div>',"{{if item.event}}",'<div param="{{item.event.pk_id}}" class="hw-coupon js_coupon_item">','<i class="icon"></i>{{item.event.subject}}',"</div>","{{/if}}","</div>","</a>","{{/each}}"].join("")},setBoxHtml:function(t,e){e=e||!1;var i=this.getItemTemplate1();i=template.compile(i)({list:t}),e?this.jq.box1.append(i).show():this.jq.box1.html(i).show(),KG.component.init(this.jq.box1)},setLoadingStateHtml:function(){var t=['<nav class="c-lb"><i class="loading" style="display: none;"></i><b class="js_more">加载更多</b></nav>'].join("");this.elem.find(".js_cpage").html(t)}});
!function(){KG.Class.define("HWLandingTopBox",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="hw-landingTopBox container-fluid"><div class="container">',"<h3>创建网上店铺，直达百万顾客</h3>",'<p class="c1">',"两分钟建个高颜值的个性化店面<br/>","发优惠、发文章，微信群、朋友圈自由传播<br/>","海外最大的媒体平台帮你直达400万华人","</p>","{{if false}}",'<img src="{{user.image}}" class="hw-img" />',"{{else}}",'<img src="../../image/haiwai1.png" class="hw-img" />',"{{/if}}",'<div class="hw-box">',"</div>","</div></div>"].join("")},setJqVar:function(){return{box:this.elem.find(".hw-box")}},setLoginBox:function(){var i=['<input style="margin-top: 55px;" type="text" class="hw-input js_email" placeholder="邮箱" />','<input type="password" style="margin-top: 25px;" class="hw-input js_pwd" placeholder="密码" />','<a href="javascript:void(0)" class="hw-btn hw-blue-btn js_login">立即登录，创建店铺</a>','<p>还没有海外帐户？<b class="js_toReg">注册</b></p>'].join("");this.jq.box.html(i)},setRegBox:function(){var i=['<input style="margin-top: 10px;" type="text" class="hw-input js_email" placeholder="邮箱" />','<input type="password" style="margin-top: 15px;" class="hw-input js_pwd" placeholder="密码" />','<input type="password" style="margin-top: 15px;" class="hw-input js_pwd2" placeholder="确认密码" />','<a href="javascript:void(0)" style="margin-top: 15px;" class="hw-btn hw-blue-btn js_reg">立即注册，创建店铺</a>','<em>点击注册表示您同意海外同城的<a target="_blank" href="../help/terms.html">使用协议</a>和<a href="../help/privacy.html" target="_blank">隐私保护协议</a></em>','<p>已有海外帐户？<b class="js_toLogin">直接登录</b></p>'].join("");this.jq.box.html(i)},setAfterLoginBox:function(){var i='<a href="../mybiz/createStore.html" style="margin-top: 200px;" class="hw-btn hw-blue-btn">我是商家，创建店铺</a>';this.jq.box.html(i)},getData:function(i,a,t){var e=KG.user.get(),s=e.isLogin;t({isLogin:s,user:e})},initEvent:function(){var i=this;this.elem.on("click",".js_toReg",this.setRegBox.bind(this)),this.elem.on("click",".js_toLogin",this.setLoginBox.bind(this)),this.elem.on("click",".js_login",function(a){var t={username:i.jq.box.find(".js_email").val(),password:i.jq.box.find(".js_pwd").val()};KG.user.login(t,function(i){util.url.param("redirect_url")?location.href=util.url.param("redirect_url"):location.href="../mybiz/index.html"},function(i){util.toast.showError(i)})}),this.elem.on("click",".js_reg",function(a){var t={email:i.jq.box.find(".js_email").val(),password:i.jq.box.find(".js_pwd").val(),confirm_password:i.jq.box.find(".js_pwd2").val()};console.log(t),KG.user.register(t,function(i,a){if(i){var e={username:t.email,password:t.password};KG.user.login(e,function(){location.href="../mycount/info.html"},function(i){util.toast.showError(i)})}else util.toast.showError(a)})})},initEnd:function(){this.data.isLogin?(this.elem.addClass("hw-is-login"),this.setAfterLoginBox()):(this.setLoginBox(),this.elem.addClass("hw-not-login"))}}),KG.Class.define("HWLandingBigImage",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="hw-landingBigImage">','<div class="container-fluid"><div class="box c1">','<img src="../../image/landing/page01.png" />','<p class="p1">零成本投入，免费注册海外就可以创建<br/>高颜值、个性化店铺主页，并即刻分享到微信</p>','<p class="p2">扫描二维码，<br/>免费下载商家版App<br/>随时随地轻松管理店铺</p>',"</div></div>",'<div style="background: #f7f7f7;" class="container-fluid"><div class="box c2">','<img src="../../image/landing/page02.png" />',"<h3>发优惠，聚人气</h3>",'<p class="p1">优惠券、折扣、买赠…轻松发布各种优惠到<br/>海外同城平台，让更多的顾客认识和喜欢上<br/>您的店铺</p>',"</div></div>",'<div class="container-fluid"><div class="box c3">','<img src="../../image/landing/page03.png" />',"<h3>发文章，塑品牌</h3>",'<p class="p1">发表专业文章、店铺软文，塑造品牌形象，<br/>同步到微信，收获更多的点赞和粉丝</p>',"</div></div>",'<div style="background: #f7f7f7;" class="container-fluid"><div class="box c4">','<img src="../../image/landing/page04.png" />',"</div></div>","</div>"].join("")}}),KG.Class.define("HWLandingPageHeader",{ParentClass:"BaseComponent",getTemplate:function(){return['<nav class="kg-header-comp">','<div class="container" id="js_header_comp">','<a class="logo" href="/"></a>','<h1 style="font-weight:400;font-size: 36px;color: #f4a62a;line-height: 50px;margin-left: 150px;position:relative;top:-4px;">商家中心</h1>',"{{if user.isLogin}}",'<div class="right">',"{{if user.has_biz}}",'<div class="dropdown" style="margin-right: 40px;">','<button id="js_right_dd_1" data-href="../mybiz/index.html" data-hover="dropdown" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">','<img src="../../image/aa.png" />',"</button>",'<div class="dropdown-menu" aria-labelledby="js_right_dd_1">','<a href="../mybiz/index.html">我的店铺</a>','<a href="../mybiz/coupon.html">店铺优惠</a>','<a href="../mybiz/article.html">店铺文章</a>',"</div>","</div>","{{/if}}",'<div class="dropdown">','<button id="js_right_dd_2" data-href="../myfav/list.html" data-hover="dropdown" class="c2" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">','<img src="{{user.image}}" />',"</button>",'<div class="dropdown-menu" aria-labelledby="js_right_dd_2">','<a href="../myfav/list.html">我的收藏</a>','<a href="../mycoupon/list.html">我的优惠</a>','<a href="../mysys/index.html">系统消息</a>','<a href="../mycount/info.html">账户设置</a>',"</div>","</div>","{{/if}}","</div><!-- /.container-fluid -->","</nav>"].join("")},getData:function(i,a,t){t({user:KG.user.get()})},initEvent:function(){this.elem.find("button[data-href]").click(function(){var i=$(this).data("href");return location.href=i,!1})},initEnd:function(){this.elem.find('[data-hover="dropdown"]').dropdownHover()}})}();