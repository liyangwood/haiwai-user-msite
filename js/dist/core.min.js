"use strict";(function(){this.KG&&(this._KG=KG),this.KG={}}).call(window),function(){var t="http://beta.haiwai.com";KG.config={root:"/haiwai-user-msite",SiteRoot:t,ApiRoot:t+"/service/api/"},KG.Const={};var i={image:KG.config.root+"/image/user_default.png",defaultImage:KG.config.root+"/image/user_default.png",email:"haiwai@chinagate.com",userid:10051,tel:"5735769567",token:"f6fa860fbb037584c6fae08875cfa163",isLogin:!0};KG.user={get:function(t){return t?i[t]:i}};var e={};KG.data={get:function(t){return t?e[t]:e},add:function(t){util.extend(e,t||{})}}}();
!function(){function t(t){return a[t]||null}function e(){return"IObject.random-"+i++}"function"!=typeof Object.create&&(Object.create=function(t){var e=function(){};return e.prototype=t,new e});var n={extend:function(t,e){return e=e||!1,$.extend(e,this,t),this},proxy:function(t,e){return $.isArray(e)||(e=Array.prototype.slice.call(arguments,1)),t.apply(this,e)},call:function(t,e,n){return $.isArray(n)||(n=Array.prototype.slice.call(arguments,2)),e.apply(t,n)},getParent:function(t){var e=this.__base,n=this.__name;if(!t&&!n)return e;for(;e;){if(t&&e.__name===t)return e;if(n!==e.__name)return e;e=e.__base}return e},callParent:function(t,e,n){"string"!=typeof e&&(n=e,e=null);var r,a,i=null;return r=e?this.getParent(e):this.__base||this,r&&(a=r.fn[t],i=a.apply(this,n)),i}},r=function(t,e){return $.extend(t,e)},a={},i=0,o=function(i,o){var s=arguments;"string"!=typeof i?(o=s[0],i=e()):t(i)&&alert(i+" is already exist");var c=null;if(o.ParentClass&&(c=o.ParentClass,delete o.ParentClass),c&&"string"==typeof c&&(c=t(c),!c))throw console.log(o,i),o.ParentClass+" is not exist";var u=function(){this._init&&this._init.apply(this,arguments)};return o.Static&&(u._static=o.Static,delete o.Static),c?(u.prototype=Object.create(c.prototype||c),u.prototype.__base=c,u.prototype.constructor=u,u.prototype.__static=u._static):u.prototype.fn=o,u.fn=u.prototype,$.extend(u.fn,n),o&&r(u.fn,o),u.fn.__type="IObject",u.fn.__name=i,a[i]=u,u},s={define:o,getByName:t,getAll:function(){return a}};KG.Class=s}();
"use strict";!function(){var e=!0;e||(console.log=function(){})}(),function(){var e=1,t={};_.extend(t,_),t.extend(t,{addUserIdToRequestData:function(e){return e=e||{},e.userid=KG.user.get("userid"),e.token=KG.user.get("token"),e},formatDate:function(e,t){function o(e){return 10>e?"0"+e:e}10===e.toString().length&&(e=1e3*parseInt(e));var i=new Date(e),a=i.getFullYear(),n=o(i.getMonth()+1),l=o(i.getDate()),s=o(i.getHours()),d=o(i.getMinutes()),r=o(i.getSeconds());return t.replace("yy",a).replace("mm",n).replace("dd",l).replace("h",s).replace("m",d).replace("s",r)},getUuid:function(){return"uuid_"+e++},uploadImage:function(e,t){if(e){var o=new FileReader;o.onload=function(e){var o=e.target.result;KG.request.uploadImage({image:o},function(e,o){e&&t(o.files[0])})},o.readAsDataURL(e)}},getQrCode:function(e,t){return t=t||240,"https://api.qrserver.com/v1/create-qr-code/?size="+t+"x"+t+"&data="+encodeURIComponent(e)}});var o={};t.message={register:function(e,t){var i=function(i,a){a=o[e]?o[e].data:a,t(i,a)};if($("body").unbind(e).bind(e,i),o[e]){var a=o[e];t(null,a.data)}},publish:function(e,t){o[e]={data:t},$("body").trigger(e,t)}},t.dialog={init:function(){var e=['<div class="modal fade" id="kg_modal_dialog" tabindex="-1" role="dialog">','<div class="modal-dialog" role="document">','<div class="modal-content box">',"</div>","</div>","</div>"].join("");e=$(e),e.on("hidden.bs.modal",function(){var t=e.find(".box");t.find(".js_yes").unbind("click"),t.empty()}),e.appendTo("body")},get:function(e){$("#kg_modal_dialog").length<1&&t.dialog.init();var o=$("#kg_modal_dialog");if(!e)return o;var i=t.extend({title:"信息提示",body:"点击确认，我们将为您删除这个店铺的所有信息，包括基本信息，图片，店铺评级和评论等，并且不能再找回这些信息，请谨慎操作。",foot:!0,type:"confirm",YesText:"确认",YesFn:t.noop,NoText:"取消",end:null},e),a=['{{if type!=="toast"}}','<div class="modal-header">','<button type="button" class="close" data-dismiss="modal" aria-label="Close"><i class="fa fa-times"></i></button>',"</div>","{{/if}}",'<div class="modal-body">',"{{if title}}",'<h4 class="hw-title">{{title}}</h4>',"{{/if}}",'{{if body}}<div class="hw-body">{{#body}}</div>{{/if}}',"</div>","{{if foot}}",'<div class="modal-footer">','<button type="button" class="hw-btn hw-light-btn" data-dismiss="modal">{{NoText}}</button>','{{if YesText}}<button type="button" class="hw-btn hw-blue-btn js_yes">{{YesText}}</button>{{/if}}',"</div>","{{/if}}"].join("");return a=template.compile(a)(i),o.find(".box").html(a),o.find(".js_yes").click(function(e){i.YesFn(function(){t.dialog.hide()},e)}),o.attr("class","modal fade"),e["class"]&&o.addClass(e["class"]),o},show:function(e){var o=t.dialog.get(e);e.beforeShowFn&&e.beforeShowFn.call(o),o.modal()},hide:function(){var e=t.dialog.get();e.modal("hide")},showFocusImage:function(e,o){var i=['<div id="cb_cccc" class="carousel slide" data-ride="carousel">','<ol class="carousel-indicators">',"{{each list}}",'<li data-target="#cb_cccc" data-slide-to="{{$index}}" class="{{if index==$index}}active{{/if}}"></li>',"{{/each}}","</ol>",'<div class="carousel-inner" role="listbox">',"{{each list as url}}",'<div class="item {{if index==$index}}active{{/if}}">','<img src="{{url}}">',"</div>","{{/each}}","</div>",'<a class="left carousel-control" href="#cb_cccc" role="button" data-slide="prev">','<span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>','<span class="sr-only">Previous</span>',"</a>",'<a class="right carousel-control" href="#cb_cccc" role="button" data-slide="next">','<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>','<span class="sr-only">Next</span>',"</a>","</div>"].join("");i=template.compile(i)({list:o,index:e}),t.dialog.show({body:i,foot:!1,"class":"hw-carousel",title:""})},confirm:function(e){var o={title:e.msg,body:!1,NoText:"取消",YesText:e.YesText||"确认","class":"hw-confirm",YesFn:e.YesFn};e.title&&(o.title=e.title,o.body=e.msg),t.dialog.show(o)},confirm1:function(e){var o={title:e.msg,body:!1,NoText:"取消",YesText:e.YesText||"确认","class":"hw-confirm1",YesFn:e.YesFn};t.dialog.show(o)},showQrCode:function(e){var o='<div class="hw-qr"><img src="'+t.getQrCode(e,200)+'" /></div>';t.dialog.show({body:o,title:"打开微信扫一扫以下二维码即可打开本店页面，点击屏幕右上角分享按钮",foot:!1,"class":"hw-dialog-qrcode"})},showLoginBox:function(e){var o={foot:!1,"class":"hw-dialog-login",body:'<div class="js_role" role="HWLoginRegBoxComp" data-type="login"></div>',beforeShowFn:function(){var e=this;KG.component.initWithElement(e.find(".js_role"))}};t.dialog.show(o)},showRegBox:function(e){var o={foot:!1,"class":"hw-dialog-login",body:'<div class="js_role" role="HWLoginRegBoxComp" data-type="reg"></div>',beforeShowFn:function(){var e=this;KG.component.initWithElement(e.find(".js_role"))}};t.dialog.show(o)},alert:function(e){t.dialog.show({body:e,NoText:"确定",YesText:!1})}},t.alert=function(e){t.dialog.show({body:e,NoText:"确定",YesText:!1})},t.url={param:function(e,t){t=t||location.search,e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var o=new RegExp("[\\?&]"+e+"=([^&#]*)"),i=o.exec(t);return null===i?"":decodeURIComponent(i[1].replace(/\+/g," "))}},window.util=KG.util=t}(),function(){template.helper("equal",function(e,t){return e===t}),template.helper("absImage",function(e){return/^http/.test(e)?e:KG.config.SiteRoot+e}),template.helper("formatDate",function(e,t){return util.formatDate(e,t||"yy年mm月dd日 h:m:s")}),template.helper("storeFullAddress",function(e){return e.address+", "+e.city+", "+e.state+" "+e.zip}),template.helper("defaultUserImage",function(e){return e?e:KG.user.get("defaultImage")}),template.helper("decode",function(e){return decodeURIComponent(e)})}();
KG.request={ajax:function(t,e,a){var i=KG.config.ApiRoot+"?format=json",n=t.method||"get";delete t.method;var r=$.Deferred();return t.url&&(i+="&"+t.url,delete t.url),"post"===n&&(i+="&func="+t.func,i+="&act="+t.act),console.log(i),$.ajax({type:n,url:i,data:t,dataType:"json",success:function(t){e&&e.call(null,t.status>0,t["return"]),r.resolve(t["return"])},error:function(t){a&&a(t),r.reject(t)}}),r},defer:function(t,e,a){var i=[];util.each(t,function(t){i.push(t())}),$.when.apply($,i).then(e,a)},mockData:function(t,e,a){var i=$.Deferred();return util.delay(function(){e&&e(!0,t),i.resolve(t)},500),i},getBizList:function(t,e,a){var i={func:"biz",userid:KG.user.get("userid"),detail:1,token:KG.user.get("token")};return this.ajax(i,e,a)},getBizDetailById:function(t,e,a){var i={func:"biz",act:"view",bizid:t.bizId,userid:KG.user.get("userid"),token:KG.user.get("token")};return this.ajax(i,e,a)},getBizCouponList:function(t,e,a){var i=[{id:123,logo:"/images/165/118/upload/classifiedinfo/19/f9/05/19f905692cf998e30745e31e9f3d28e9.jpg",title:"全场满100元送午餐券",count:100,bizInfo:{name:"小肥羊Fremont店",address:"Fremont, CA 98765"},stop:!0,startTime:1449772731230,endTime:1449772831230},{id:234,logo:"/images/165/118/upload/classifiedinfo/19/f9/05/19f905692cf998e30745e31e9f3d28e9.jpg",title:"全场满100元送午餐券",count:100,bizInfo:{name:"小肥羊Fremont店",address:"Fremont, CA 98765"},startTime:1449772731230,endTime:1449772831230}];return this.mockData(i,e,a)},getSystemMessageList:function(t,e,a){var i={func:"sysmsg"};return util.addUserIdToRequestData(i),console.log(i),this.ajax(i,e,a)},getSystemMessageDetail:function(t,e,a){var i={func:"sysmsg",act:"view",id:t.id};return util.addUserIdToRequestData(i),this.ajax(i,e,a)},deleteSystemMessageById:function(t,e,a){var i={func:"sysmsg",act:"delete"};return t.id?i["id[1]"]=t.id:t.ids&&util.each(t.ids,function(t,e){i["id["+(e+1)+"]"]=t}),util.addUserIdToRequestData(i),this.ajax(i,e,a)},uploadImage:function(t,e,a){var i={url:"func=article&act=upload",type:"image","uploadfield[]":t.image};return this.ajax(i,e,a)},uploadUserImage:function(t,e,a){var i={func:"passport",act:"upload","uploadfield[]":t.image};return i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},getAllAddressAreaInfo:function(t,e,a){var i={func:"biz",act:"get_allregion"};return this.ajax(i,e,a)},getUserDetailInfo:function(t,e,a){var i={act:"getuser",check:KG.user.get("token"),func:"passport",userid:KG.user.get("userid")};return this.ajax(i,function(t,a){e(!0,a[i.userid])},a)},getAllStoreCategoryList:function(t,e,a){var i={func:"biz",act:"tags"};return this.ajax(i,e,a)},getAllStoreTagByCategory:function(t,e,a){var i={func:"biz",act:"taglist",biztagid:t.catId};return this.ajax(i,e,a)},getMyfavStoreList:function(t,e,a){var i={func:"biz",act:"bookmark"};return i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},deleteMyFavStore:function(t,e,a){var i={func:"biz",act:"delete_bookmark",type:"biz",id:t.id};return i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},deleteMyFavCoupon:function(t,e,a){var i={func:"biz",act:"delete_bookmark",type:"classifiedinfo",id:t.id};return i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},getMycouponList:function(t,e,a){var i={func:"event",act:"bookmark"};return util.addUserIdToRequestData(i),this.ajax(i,e,a)},getSiteArticleList:function(t,e,a){var i=[{id:1,title:"盘点旧金山里那些文艺范儿的店",image:"http://www.haiwai.com/images/750/438/upload/classifiedinfo/e3/53/03/e35303ef3c6a5477ef7dcd6f6698554c.jpg",description:"盘点旧金山里那些文艺范儿的店正文盘点旧金山里那些文艺范儿的店正文盘点旧金山里那些文艺范儿的店正文盘点旧金山里那些文艺范儿的店正文",dateline:Date.now(),bizInfo:{name:"沸腾渔乡",address:"290 Barber Ct, Milpitas, CA 95035",logo:"http://www.haiwai.com/upload/biz/9d/10/5f/9d105fef7bb81eb57103915d800b7bf7.jpg"},view:3002212},{id:1,title:"盘点旧金山里那些文艺范儿的店",image:"http://www.haiwai.com/images/750/438/upload/classifiedinfo/e3/53/03/e35303ef3c6a5477ef7dcd6f6698554c.jpg",description:"盘点旧金山里那些文艺范儿的店正文盘点旧金山里那些文艺范儿的店正文盘点旧金山里那些文艺范儿的店正文盘点旧金山里那些文艺范儿的店正文",dateline:Date.now(),bizInfo:{name:"沸腾渔乡",address:"290 Barber Ct, Milpitas, CA 95035",logo:"http://www.haiwai.com/upload/biz/9d/10/5f/9d105fef7bb81eb57103915d800b7bf7.jpg"},view:3002212},{id:1,title:"盘点旧金山里那些文艺范儿的店盘点旧金山里那些文艺范盘点旧金山里那些文艺范盘点旧金山里那些文艺范盘点旧金山里那些文艺范",image:"http://www.haiwai.com/images/750/438/upload/classifiedinfo/e3/53/03/e35303ef3c6a5477ef7dcd6f6698554c.jpg",description:"盘点旧金山里那些文艺范",bizInfo:{name:"沸腾渔乡",address:"290 Barber Ct, Milpitas, CA 95035",logo:"http://www.haiwai.com/upload/biz/9d/10/5f/9d105fef7bb81eb57103915d800b7bf7.jpg"},dateline:Date.now(),view:3002212}];return this.mockData(i,e,a)},getSiteArticleDetail:function(t,e,a){var i={id:1,title:"盘点旧金山里那些文艺范儿的店盘点旧金山里那些文艺范盘点旧金山里那些文艺范盘点旧金山里那些文艺范盘点旧金山里那些文艺范",bizInfo:{name:"沸腾渔乡",address:"290 Barber Ct, Milpitas, CA 95035",logo:"http://www.haiwai.com/upload/biz/9d/10/5f/9d105fef7bb81eb57103915d800b7bf7.jpg"},msgbody:'<p>田肥美，国殷富，战车万乘，奋击百万，沃野千里，蓄积饶多，地势形便，此所谓天府，天下之雄国也。川菜讲究色、香、味、形，在“味”字上下功夫，以味的多、广、厚著称。</p><img src="http://www.haiwai.com/upload/biz/9d/10/5f/9d105fef7bb81eb57103915d800b7bf7.jpg"/><p>川菜口味的组成，主要有“麻、辣、咸、甜酸、苦、香”7种味道，巧妙搭配，灵活多变，创制出麻辣、酸辣、红油、白油等几十种各具特色的符合味，味别之多，调制之妙，堪称中外菜肴之首，从而赢得了“一菜一格，百菜百味”的称誉。</p><img src="http://www.haiwai.com/upload/biz/4d/4e/2b/4d4e2b5204381465f411cfa32ea6666c.jpg"/>"/><p>川菜作为中国八大菜系之一，在烹饪史上占有极其重要的地位。它取材广泛，调味多变，菜式多样，口味清鲜醇浓并重，以善用麻辣著称，并以其别具一格的烹调方法和浓郁的地方味享誉中外，成为中华民族饮食文化中一颗璀璨的明珠。</p>',dateline:Date.now(),view:"1,211,311",tag:"精选内容 | 美食Tips"};return this.mockData(i,e,a)},sendSmsToUserPhone:function(t,e,a){var i={func:"sms",act:"send_event",number:t.number,biz_name:t.biz_name,event_title:t.event_title};return util.addUserIdToRequestData(i),this.ajax(i,e,a)},modifyUserInfo:function(t,e,a){var i={func:"passport",act:"update",nick:t.nickname,region:t.region,contact_email:t.contact_email||"",email:t.email,tel:t.tel,wechat:t.wechat,signature:t.description};return i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},createStoreByStep1:function(t,e,a){var i={func:"biz",act:"pc_add",step:1,bizname:t.bizName,biztel:t.bizTel,biztagid:t.bizTagId,sec_tags:t.tags,address:t.address,city:t.city,state:t.state,zip:t.zip};return i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},createStoreByStep2:function(t,e,a){var i={func:"biz",act:"pc_add",step:2,biz_tmpid:t.bizTmpId,wechat:t.wechat,description:t.description};return util.extend(i,t.dynamic||{}),i=util.addUserIdToRequestData(i),console.log(i),this.ajax(i,e,a)},getTmpStoreDynamicField:function(t,e,a){var i={func:"biz",act:"get_dynamic_fields",main_tagid:t.mainTagId};return this.ajax(i,e,a)},getStoreDynamicField:function(t,e,a){var i={func:"biz",act:"get_biz_dynamic_fields",bizid:t.bizId};return this.ajax(i,e,a)},createStoreByStep3:function(t,e,a){var i={func:"biz",act:"pc_add",step:3,biz_tmpid:t.bizTmpId,background_pic:t.bgPic};return util.each(t.imageList||[],function(t,e){i["uploadfield["+e+"]"]=t}),i=util.addUserIdToRequestData(i),console.log(i),this.ajax(i,e,a)},getStoreBigBackgroundPic:function(t,e,a){var i={func:"biz",act:"get_background_pic",main_tagid:t.mainTagId};return this.ajax(i,e,a)},uploadTmpBizLogo:function(t,e,a){var i={func:"biz",act:"upload",tmp:1,logo:1,biz_tmpid:t.bizTmpId,"uploadfield[]":t.image};return console.log(i),this.ajax(i,e,a)},createStoreCouponEvent:function(t,e,a){var i={func:"event",act:"post",method:"post",subject:t.subject,description:t.description,fk_entityID:t.biz,start_date:t.startDate,end_date:t.endDate};return util.each(t.imageList||[],function(t,e){i["uploadfield["+e+"]"]=t}),i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},getStoreArticleAndCouponList:function(t,e,a){var i={func:"biz",act:"get_article_event",bizid:t.bizId};return i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},getUserArticleAndCouponList:function(t,e,a){var i={func:"passport",act:"get_article_event"};return i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},getArticleCategoryList:function(t,e,a){var i={func:"article",act:"tags"};return this.ajax(i,e,a)},createStoreArticle:function(t,e,a){var i={func:"article",act:"post",method:"post",category_id:t.category,title:t.title,msgbody:t.msgbody,fk_entityID:t.bizId};return i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},deleteCouponById:function(t,e,a){var i={func:"event",act:"del",id:t.id};return i=util.addUserIdToRequestData(i),this.ajax(i,e,a)}};
"use strict";!function(){KG.Class.define("BaseComponent",{_init:function(t,e,i){var a=this;this.box=t,this.config=i||{},this._initProp(),this.getData(t,e,function(t){a.data=t,a.initVar(),a._initView(),a._initEvent(),a._initEnd()})},getTemplate:function(){},initVar:function(){},_initView:function(){this.initView(),this.html=template.compile(this.getTemplate())(this.data),this.elem=$(this.html),KG.component.init(this.elem),this.jq=util.extend(this.setJqVar(),this.callParent("setJqVar"))},setJqVar:function(){return{}},_initEvent:function(){this.initEvent(),util.message.register(this.__name,this.registerMessage.bind(this))},_initEnd:function(){this.elem.data("kg-obj",this);var t=this.box.attr("style"),e=this.box.attr("class");this.elem.attr("style",t),this.elem.addClass(e),this.box.replaceWith(this.elem),this.initEnd()},getData:function(t,e,i){i.call(this,{})},_initProp:function(){var t=util.extend(this.defineProperty(),this.callParent("defineProperty")),e={},i=this.box;util.each(t,function(t,a){t=t||{};var n=i.data(a);e[a]=util.isUndefined(n)?t.defaultValue:util.isFunction(t.getter)?t.getter(n):n}),this.prop=e},defineProperty:function(){return{}},initView:util.noop,initEnd:util.noop,initEvent:util.noop,registerMessage:util.noop}),KG.Class.define("HeadingNav",{ParentClass:"BaseComponent",getTemplate:function(){return['<nav class="kg-header-nav-comp">','<div class="container">','<a href="../mybiz/index.html" class="nav js_mybiz">我的店铺</a>','<a href="../myfav/list.html" class="nav js_myfav">我的收藏</a>','<a href="../mycoupon/list.html" class="nav js_mycoupon">我的优惠</a>','<a href="../mysys/index.html" class="nav js_mysys">系统消息</a>','<a href="../mycount/info.html" class="nav js_mycount">账户</a>',"</div>","</nav>"].join("")},getData:function(t,e,i){var a=KG.data.get("page").split("-");a=a[0]||"",i({page:a})},initEnd:function(){var t=this.data.page;this.elem.find(".js_"+t).addClass("active")}}),KG.Class.define("MybizLeftUserNav",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="hw-MybizLeftUserNav">','<a class="hw-img" href=""><img src="{{user.image}}" /></a>','<span class="hw-email">{{user.email}}</span>','<a href="index.html" class="hw-a js_index" style="margin-top: 24px;">我的店铺</a>','<a href="coupon.html" class="hw-a js_coupon">店铺优惠</a>','<a href="article.html" class="hw-a js_article">店铺文章</a>',"</div>"].join("")},getData:function(t,e,i){var a=KG.user.get(),n=KG.data.get("page").split("-");n=n[1]||"",i({user:a,page:n})},initEnd:function(){var t=this.data.page;this.elem.find(".js_"+t).addClass("active")}}),KG.Class.define("MybizRightStoreRank",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="hw-MybizRightStoreRank">',"<span>您的店铺吸引力</span>",'<b class="js_rg">{{range}}%</b>','<div class="range"><em style="width:{{range}}%;"></em></div>',"<p>如何创建有影响力的店铺？</p>",'<a style="margin-top: 20px;" href="">完善店铺信息增加认知度</a>','<a href="">更多精美图片增加可信度</a>','<a href="">多发文章增加专业度</a>','<a href="">常发活动增加活跃度</a>',"</div>"].join("")},setJqVar:function(){return{wr:this.elem.find(".range").find("em"),txt:this.elem.find(".js_rg")}},getData:function(t,e,i){var a=this.prop.range;i({range:a})},setValue:function(t){this.data.range=t,this.jq.wr.css("width",t+"%"),this.jq.txt.text(t+"%")},registerMessage:function(t,e){console.log(e),this.setValue(e)},defineProperty:function(){return{range:{defaultValue:0}}}}),KG.Class.define("MybizRunningStoreList",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="hw-comp-store-list">',"{{each list as item}}",'<div class="hw-each">','<img class="hw-img" src="{{item.logo | absImage}}" />',"<h4>{{item.name_cn}}</h4>","<p>{{item.address}}, {{item.city}}, {{item.state}}, {{item.zip}}</p>","<em>{{item.commentnum}}条新评论</em>",'<div class="r">','<a class="hw-a" href="editStore.html?id={{item.entityID}}">管理店铺</a>','<b class="hw-a js_share">分享</b>',"</div>","</div>","{{/each}}","</div>"].join("")},getData:function(t,e,i){KG.request.getBizList({},function(t,e){t&&i({list:e})})},initEvent:function(){this.elem.find(".js_share").click(function(){var t="http://www.haiwai.com";return util.dialog.showQrCode(t),!1})},initEnd:function(){util.delay(function(){util.message.publish("MybizRightStoreRank",80)},1e3)}}),KG.Class.define("MybizStopStoreList",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="hw-comp-store-list">',"{{each list as item}}",'<div class="hw-each">','<img class="hw-img" src="{{item.logo | absImage}}" />',"<h4>{{item.name_cn}}</h4>","<p>{{item.address}}, {{item.city}}, {{item.state}}, {{item.zip}}</p>","<em>{{item.commentnum}}条新评论</em>",'<div class="r">','<a class="hw-a js_restart" href="">重新营业</a>','<a class="hw-a js_del" href="">删除</a>',"</div>","</div>","{{/each}}","</div>"].join("")},getData:function(t,e,i){KG.request.getBizList({},function(t,e){t&&i({list:e})})},initEvent:function(){var t=this;this.elem.find(".js_restart").click(function(){util.dialog.show()}),this.elem.find(".js_del").click(function(){return util.dialog.confirm({title:"确认要删除这个店铺吗？",msg:"点击确认，我们将为您删除这个店铺的所有信息，包括基本信息，图片，店铺评级和评论等，并且不能再找回这些信息，请谨慎操作。",YesFn:t.deleteStore}),!1}),this.elem.find(".js_restart").click(function(t){})},deleteStore:function(t){t()}}),KG.Class.define("MybizRunningCouponList",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="hw-comp-store-list">',"{{each list as item}}",'<div class="hw-each">','<img class="hw-img" src="{{item.logo | absImage}}" />','<h4 style="margin-top: 20px;">{{item.subject}}</h4>','<p style="color: #9b9b9b;font-size: 14px;margin-top:15px;">{{item.count}}人已经领取</p>','<div class="r">','<a class="hw-a" href="editCoupon.html?id={{item.fk_entityID}}">管理优惠</a>','<a class="hw-a js_share" href="">分享</a>',"</div>","</div>","{{/each}}","</div>"].join("")},getData:function(t,e,i){KG.request.getUserArticleAndCouponList({},function(t,e){if(t){var a=[];util.each(e.event,function(t){"0"!=t.active_status&&a.push(t)}),i({list:a})}})}}),KG.Class.define("MybizStopCouponList",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="hw-comp-store-list">',"{{each list as item}}",'<div class="hw-each">','<img class="hw-img" src="{{item.logo | absImage}}" />','<h4 style="margin-top: 10px;height:20px;">{{item.subject}}</h4>','<p style="color: #9b9b9b;font-size: 14px;margin-top:10px;">{{item.count}}人已经领取</p>','<p style="color: #9b9b9b;font-size: 14px;margin-top:5px;">{{item.startTime}} 至 {{item.endTime}}</p>','<div class="r">','<a class="hw-a js_del" param="{{item.pk_id}}" style="margin-top: 30px;" href="javascript:void(0)">删除</a>',"</div>","</div>","{{/each}}","</div>"].join("")},getData:function(t,e,i){KG.request.getUserArticleAndCouponList({},function(t,e){if(t){var a=[];util.each(e.event,function(t){"0"==t.active_status&&(t.startTime=t.top_start_time>10?moment(1e3*t.top_start_time).format("YYYY-MM-DD"):"",t.endTime=t.top_end_time>10?moment(1e3*t.top_end_time).format("YYYY-MM-DD"):"",a.push(t))}),i({list:a})}})},initEvent:function(){this.elem.on("click",".js_del",function(t){var e=$(this),i=e.attr("param");util.dialog.confirm({msg:"确认删除此店铺么？",YesFn:function(t){KG.request.deleteCouponById({id:i},function(i,a){t(),i?e.closest(".hw-each").fadeOut(400,function(){$(this).remove()}):alert(a)})}})})}}),KG.Class.define("MybizCreateNewStore",{ParentClass:"BaseComponent",getTemplate:function(){var t={store:["添加新店铺","store_default.png","createStore.html"],coupon:["添加新优惠","coupon_default.png","createCoupon.html"],article:["添加新文章","article_default.png","createArticle.html"]},e=this.box.data("type");return['<a class="hw-MybizCreateNewStore" href="'+t[e][2]+'">','<div class="hw-img '+e+'"><img src="../../image/'+t[e][1]+'" /></div>','<i class="icon">＋</i>',"<b>",t[e][0],"</b>","</a>"].join("")},initEvent:function(){}}),KG.Class.define("MybizArticleList",{ParentClass:"BaseComponent",getTemplate:function(){return["<div>",'<div class="panel-heading">',"<b>文章 ({{list.length}})</b>","</div>",'<div class="hw-comp-store-list panel-body">',"{{each list as item}}",'<div class="hw-each">','<img class="hw-img" src="{{item.logo | absImage}}" />','<h4 style="margin-top:20px;">{{item.title}}</h4>','<p style="color: #9b9b9b;font-size: 14px;margin-top:20px;">发表于{{item.startTime | formatDate}}</p>','<div class="r">','<a class="hw-a" href="editArticle.html?id={{item.id}}">编辑</a>','<a class="hw-a" href="">分享</a>',"</div>","</div>","{{/each}}","</div>","</div>"].join("")},getData:function(t,e,i){KG.request.getUserArticleAndCouponList({},function(t,e){console.log(e),t&&i({list:e.article})})}}),KG.Class.define("BackPageLink",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="container hw-comp-BackPageLink">','<a href="{{href}}"><i class="icon fa fa-angle-left"></i>{{title}}</a>',"</div>"].join("")},getData:function(t,e,i){i({title:t.data("title"),href:t.data("href")})}}),KG.Class.define("MybizEditStoreLeftNav",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="hw-comp-MycountLeftNav">','<a class="hw-a js_editStore" href="editStore.html?id={{bizId}}">基本信息</a>','<a class="hw-a js_editStore_2" href="editStore_2.html?id={{bizId}}">更多描述</a>','<a class="hw-a js_editStore_3" href="editStore_3.html?id={{bizId}}">上传图片</a>',"</div>"].join("")},getData:function(t,e,i){var a=KG.data.get("page").split("-")[1],n=KG.data.get("id");i({page:a,bizId:n})},initEnd:function(){this.elem.find(".js_"+this.data.page).addClass("active").click(function(){return!1})}}),KG.Class.define("HWLoginRegBoxComp",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="hw-loginRegBoxComp">','<div class="c-tlt">','<h4><b>加入海外同城</b><b style="margin-left: 85px;">让生活更简单</b></h4>','<img src="../../image/haiwai1.png" />',"</div>",'<div class="c-left js_left">',"</div>",'<div class="c-right">',"<h4>用以下账号直接登录</h4>",'<a class="hw-btn hw-weixin"></a>','<a class="hw-btn hw-fb"></a>',"</div>",'<div class="c-btm">',"</div>","</div>"].join("")},setJqVar:function(){return{tlt:this.elem.find(".c-tlt h4 b"),left:this.elem.find(".js_left"),btm:this.elem.find(".c-btm")}},setLoginBox:function(){this.jq.tlt.hide();var t=["<h4>登陆海外同城</h4>",'<input type="text" placeholder="邮箱" />','<input type="password" placeholder="密码" />','<button class="hw-btn hw-blue-btn js_loginBtn">登陆</button>','<p>忘记账号或密码？<a href="#">在这里找回</a></p>'].join("");this.jq.left.html(t);var e=['<p>还没有海外帐户？<a class="hw-btn js_toReg">注册</a></p>'].join("");this.jq.btm.html(e)},setRegBox:function(){var t=['<input type="text" placeholder="邮箱" />','<input type="password" placeholder="密码" />','<input type="password" placeholder="确认密码" />','<button class="hw-btn hw-blue-btn js_regBtn">注册</button>','<p>点击注册表示您同意海外同城的<a href="#">使用协议</a>和<a href="#">隐私保护协议</a></p>'].join("");this.jq.left.html(t),this.jq.tlt.show();var e=['<h6>已有海外帐户？<a href="javascript:void(0)" class="js_toLogin">直接登录</a></h6>'].join("");this.jq.btm.html(e)},defineProperty:function(){return{type:{defaultValue:"reg"}}},initEvent:function(){this.elem.on("click",".js_toReg",this.setRegBox.bind(this)),this.elem.on("click",".js_toLogin",this.setLoginBox.bind(this)),this.elem.on("click",".js_regBtn",function(){util.dialog.showRegBox({})}),this.elem.on("click",".js_loginBtn",function(){util.dialog.showLoginBox({})})},initEnd:function(){"login"===this.prop.type?this.setLoginBox():"reg"===this.prop.type&&this.setRegBox()}})}(),KG.component={initEach:function(t,e,i){i=i||{},new(KG.Class.getByName(t))(e,i)},init:function(t){t=t||$("body");var e=t.find("[role]");e.each(function(){var t=$(this);if(!t.attr("init-end")&&!t.attr("init-self")){var e=t.attr("role");KG.component.initEach(e,t,{})}})},initWithElement:function(t,e,i){var a=t.attr("role");if(a)return new(KG.Class.getByName(a))(t,e,i)},getObj:function(t){var e=t.data("kg-obj");return e||null}},$(function(){KG.component.init()});
"use strict";!function(){KG.Class.define("BaseForm",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="container hw-comp-bform">',this.getInsideTemplate(),"</div>"].join("")},getInsideTemplate:function(){}}),KG.Class.define("BaseInput",{ParentClass:"BaseComponent",defineProperty:function(){return{value:{defaultValue:""},label:{},require:{},type:{defaultValue:"text"},delbtn:{}}},getTemplate:function(){return['<div class="form-group hw-comp-BaseInput">','<label class="lab {{if require}}require{{/if}}" for="{{uuid}}">{{label}}</label>','<label class="control-label hw-err"></label>','<input type="{{type}}" class="form-control" id="{{uuid}}" placeholder="{{placeholder}}">',"</div>"].join("")},getData:function(e,t,i){var n=this.prop;i({value:n.value,label:n.label,require:n.require,type:n.type,placeholder:e.attr("placeholder")||"",uuid:"lb_"+util.getUuid()})},initEvent:function(){var e=this;if(this.prop.delbtn){var t=this.elem.find("input");t.after('<i class="fa del fa-times-circle" style="display: none;"></i>'),this.jq.delBtn=this.elem.find(".del"),this.jq.delBtn.click(function(){t.val(""),e.checkDeleteIcon(),t.focus()}),t.bind("keyup",this.checkDeleteIcon.bind(this)),t.bind("paste",this.checkDeleteIcon.bind(this))}},initEnd:function(){this.prop.value&&this.elem.find("input").val(this.prop.value)},checkDeleteIcon:function(){var e=this.elem.find("input").val();e?this.jq.delBtn.show():this.jq.delBtn.hide()},getValue:function(){return this.elem.find("input").val()},setValue:function(e){this.elem.find("input").val(e)},showError:function(e){e?(this.elem.addClass("has-error"),this.elem.find(".hw-err").html(e)):(this.elem.removeClass("has-error"),this.elem.find(".hw-err").html(""))},reset:function(){this.elem.find("input").val(""),this.showError(!1)}}),KG.Class.define("BaseSelectInput",{ParentClass:"BaseInput",getTemplate:function(){return['<div class="form-group hw-comp-BaseSelectInput">','<label class="lab {{if require}}require{{/if}}">{{label}}</label>','<div class="dropdown hw-drop">','<button id="{{uuid}}" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">','<input type="text" readonly="true" class="form-control js_input" placeholder="{{placeholder}}">','<i class="icon fa fa-caret-down"></i>',"</button>",'<ul class="dropdown-menu" aria-labelledby="{{uuid}}">',"{{each list as item}}",'<li index="{{$index}}" class="js_drop">',this.getEachHtml(),"</li>","{{/each}}","</ul>","</div>","</div>"].join("")},initVar:function(){this.index=-1},getData:function(e,t,i){this.clickCallback=t.clickCallback,this.getEachHtml=t.getEachHtml||function(){return"{{item}}"};var n=this.prop;i({value:n.value,label:n.label,require:n.require,placeholder:e.attr("placeholder")||"",uuid:"dl_"+util.getUuid(),list:t.list})},initEvent:function(){var e=this,t=this.elem.find(".js_input");this.elem.find(".js_drop").click(function(){t.val($(this).text());var i=$(this).attr("index");e.index=i,e.clickCallback(e.data.list[i])})},initEnd:function(){},getValue:function(){return this.index<0?{}:this.data.list[this.index]},setValue:function(e){this.elem.find(".js_drop").filter('[index="'+e+'"]').trigger("click")},setOnlyValue:function(e){this.elem.find(".js_input").val(e)}}),KG.Class.define("MybizArticleForm",{ParentClass:"BaseForm",getInsideTemplate:function(){return["{{if pageTitle}}<h3>{{pageTitle}}<h3>{{/if}}",'<div placeholder="请选择店铺" class="js_biz" data-label="将文章发布到" data-require="true" role="BaseSelectInput" init-self="true"></div>','<div placeholder="请选择分类" class="js_cat" data-label="文章类别" data-require="true" role="BaseSelectInput" init-self="true"></div>','<div class="form-group">','<label class="require" for="lb_bbb">文章标题</label>','<input type="text" class="form-control js_title" id="lb_bbb" placeholder="e.g. 海底捞成功的秘密">',"</div>",'<div class="form-group">','<label class="require" for="lb_ccc">文章正文</label>','<textarea class="form-control" id="lb_ccc"></textarea>',"</div>",'<a href="javascript:void(0)" class="js_btn hw-btn hw-blue-btn">发表</a>'].join("")},defineProperty:function(){return{title:{defaultValue:""},type:{defaultValue:"create"}}},getData:function(e,t,i){var n=this.prop.title,a=this.prop.type,l=function(){return KG.request.getBizList({})},s=function(){return KG.request.getArticleCategoryList({})},r=[l,s];"edit"===a&&r.push(function(){return KG.request.getBizCouponList({})}),KG.request.defer(r,function(e,t){i({pageTitle:n,bizList:e,catList:t})})},initVar:function(){this.biz=null,this.cat=null},validate:function(e){return!0},initEvent:function(){var e=this;this.elem.find(".js_btn").click(function(){var t=e.getFormValue();return e.validate(t)?void KG.request.createStoreArticle(t,function(e,t){e&&console.log(t)}):!1})},getElemObj:function(){return{}},getFormValue:function(){return{category:this.cat,bizId:this.biz,title:this.elem.find(".js_title").val(),msgbody:this.ck.getData()}},initEnd:function(){var e=this;this.ck=CKEDITOR.replace("lb_ccc"),console.log(this.ck);var t=this.elem.find(".js_biz");KG.component.initWithElement(t,{list:this.data.bizList,clickCallback:function(t){console.log(t),e.biz=t.entityID},getEachHtml:function(){return"{{item.name_cn}}, {{item | storeFullAddress}}"}}),KG.component.initWithElement(this.elem.find(".js_cat"),{list:this.data.catList,clickCallback:function(t){console.log(t),e.cat=t.category_id},getEachHtml:function(){return"{{item.name}}"}})}}),KG.Class.define("MybizUploadCouponImage",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="hw-comp-MybizUploadStoreImage hw-coupon-uploadimage">','<div class="hw-add js_add">','<i class="icon fa fa-plus-square-o"></i>',"<p>添加新图片</p>",'<input class="js_input" type="file" />',"</div>","</div>"].join("")},setJqVar:function(){return{add:this.elem.find(".js_add"),fileInput:this.elem.find(".js_input")}},getData:function(e,t,i){var n=(KG.user.get("image"),t.list);i({list:n})},initEvent:function(){var e=this;this.jq.fileInput.change(function(){var t=this.files[0];e.uploadImageFn(t,function(t){e.addNewImage(t)}),$(this).val("")}),this.elem.click(function(t){var i=$(t.target),n=i.closest(".js_del");return n.length>0?(util.dialog.confirm1({YesText:"删除",msg:"您确定要删除这张照片吗？",YesFn:function(){e.deleteImage(n),util.dialog.hide()}}),!1):(n=i.closest(".js_img"),n.length>0?(e.showBigImage(n.find("img").attr("src")),!1):void 0)})},showBigImage:function(e){var t=this.getImageList(),i=util.indexOf(t,e);util.dialog.showFocusImage(i,t)},getImageList:function(){var e=this.elem.find(".js_img");return util.map(e,function(e){var t=$(e);return t.find("img").attr("src")})},getValue:function(){return this.getImageList()},deleteImage:function(e){var t=e.closest(".js_img");t.remove();var i=this.getImageList().length;3>i&&this.jq.add.show()},getEachHtml:function(e){var t=['<div class="hw-one js_img">','<img src="{{url}}" />','<b class="js_del">删除</b>',"</div>"].join("");return template.compile(t)({url:e})},uploadImageFn:function(e,t){util.uploadImage(e,function(e){var e=KG.config.SiteRoot+e;t(e)})},addNewImage:function(e){var t=this.getImageList().length;2===t&&this.jq.add.hide();var i=this.getEachHtml(e);this.jq.add.after(i)},initEnd:function(){var e=this,t=this.data.list;util.each(t,function(t){e.addNewImage(t)})}}),KG.Class.define("MybizCouponForm",{ParentClass:"BaseForm",getInsideTemplate:function(){return["{{if pageTitle}}<h3>{{pageTitle}}<h3>{{/if}}",'<div placeholder="请选择店铺" class="js_biz" data-label="将优惠发布到" data-require="true" role="BaseSelectInput" init-self="true"></div>','<div class="form-group">','<div class="js_title" role="BaseInput" data-label="优惠标题" data-require="true" placeholder="e.g. 美食府金秋品尝会，邀您免费试吃"></div>','<div class="form-group">','<label style="display: block;">优惠开始时间</label>','<input style="width: 410px;display: inline-block" type="text" class="form-control js_startDate" readonly="true" placeholder="10/20/2015">',"</div>",'<div class="form-group">','<label style="display: block;">优惠结束时间</label>','<input style="width: 410px;display: inline-block" type="text" class="form-control js_endDate" readonly="true" placeholder="10/20/2016">',"</div>",'<div class="form-group">','<label class="require" for="lb_ccc">优惠描述</label>','<textarea style="height: 170px;" placeholder="优惠宣传、细节、方式、如何报名等信息提升参与度" class="js_desc form-control" id="lb_ccc"></textarea>',"</div>",'<div class="form-group">','<label class="lab">优惠图片</label>','<div class="js_image" role="MybizUploadCouponImage" init-self="true"></div>',"</div>",'<a href="javascript:void(0)" class="hw-btn hw-blue-btn js_btn">{{btnText}}</a>'].join("")},setJqVar:function(){return{startDate:this.elem.find(".js_startDate"),startTime:this.elem.find(".js_startTime"),endDate:this.elem.find(".js_endDate"),endTime:this.elem.find(".js_endTime"),desc:this.elem.find(".js_desc"),btn:this.elem.find(".js_btn")}},defineProperty:function(){return{title:{defaultValue:""},type:{defaultValue:"create"}}},getElemObj:function(){return{title:KG.component.getObj(this.elem.find(".js_title")),image:KG.component.getObj(this.elem.find(".js_image"))}},getFormValue:function(){var e=this.getElemObj();return{biz:this.jq.biz.getValue().entityID,subject:e.title.getValue(),description:this.jq.desc.val(),startDate:this.jq.startDate.val(),endDate:this.jq.endDate.val(),imageList:e.image.getValue()}},validate:function(e){return e=e||this.getFormValue(),!0},getData:function(e,t,i){var n=this.prop.title,a=this.prop.type,l=function(){return KG.request.getBizList({})},s=[l];"edit"===a&&s.push(function(){return KG.request.getBizCouponList({})}),KG.request.defer(s,function(e){i({pageTitle:n,bizList:e,btnText:"edit"===a?"保存":"创建"})})},initEvent:function(){var e=this;this.jq.startDate.datepicker({format:"mm/dd/yyyy",autoclose:!0}),this.jq.endDate.datepicker({format:"mm/dd/yyyy",autoclose:!0}),this.jq.btn.click(function(){var t=e.getFormValue();return console.log(t),e.validate(t)?void("create"===e.prop.type&&KG.request.createStoreCouponEvent(t,function(e,t){e&&(console.log(t),location.href="http://www.haiwai.com/classifiedinfo/view.php?id="+t)})):!1})},initEnd:function(){var e=this.elem.find(".js_biz");this.jq.biz=KG.component.initWithElement(e,{list:this.data.bizList,clickCallback:function(e){console.log(e)},getEachHtml:function(){return"{{item.name_cn}}, {{item | storeFullAddress}}"}}),this.image=KG.component.initWithElement(this.elem.find(".js_image"),{list:this.data.imageList||[]})}}),KG.Class.define("BaseUploadImage",{ParentClass:"BaseComponent",setJqVar:function(){return{img:this.elem.find(".js_img"),btn:this.elem.find(".js_btn"),fileInput:this.elem.find('input[type="file"]')}},defineProperty:function(){return{image:{}}},initEvent:function(){var e=this.jq.btn,t=(this.jq.img,this);this.jq.fileInput.bind("change",function(i){var n=this.files[0];e.button("loading"),t.uploadImageFn(n,function(){e.button("reset")})})},uploadImageFn:function(e,t){var i=this;util.uploadImage(e,function(e){var e=KG.config.SiteRoot+e;i.jq.img.attr("src",e),t()})}})}();
"use strict";!function(){KG.Class.define("StarRank",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="hw-comp-star">',"{{each list as item}}",'{{if item==="full"}}','<i class="icon fa fa-star"></i>','{{else if item==="half"}}','<i class="icon fa fa-star-half-o"></i>',"{{else}}",'<i class="icon fa fa-star-o"></i>',"{{/if}}","{{/each}}","</div>"].join("")},getData:function(e,a,t){for(var i=parseFloat(e.data("rank")),s=[],l=1;6>l;l++)i>l?s.push("full"):l===i?s.push("full"):l===i+.5?s.push("half"):s.push("empty");t({list:s})}}),KG.Class.define("MyfavLeftUserNav",{ParentClass:"BaseComponent",getTemplate:function(){return['<div style="height: 200px;" class="hw-MybizLeftUserNav">','<a class="hw-img" href=""><img src="{{user.image}}" /></a>','<span class="hw-email">{{user.email}}</span>','<a href="javascript:void(0)" class="hw-a js_{{page}}" style="margin-top: 24px;">{{dir}}</a>',"</div>"].join("")},getData:function(e,a,t){var i=KG.user.get(),s=KG.data.get("page").split("-"),l=s[0];s=s[1]||"",l={myfav:"收藏店铺",mycoupon:"我的优惠",mysys:"系统消息"}[l],t({user:i,page:s,dir:l})},initEnd:function(){var e=this.data.page;this.elem.find(".js_"+e).addClass("active")}}),KG.Class.define("RightPanelList_1",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="panel hw-panel hw-comp-RightPanelList-1" style="width: 844px;float: right;">','<div class="panel-heading">',this.getHeadingTemplate(),"</div>",'<div class="hw-comp-store-list hw-right-panel-list panel-body">',this.getBodyTemplate(),"</div>","</div>"].join("")},setJqVar:function(){return{panelTitle:this.elem.find(".panel-heading"),panelBody:this.elem.find(".panel-body")}},getHeadingTemplate:function(){},getBodyTemplate:function(){}}),KG.Class.define("MyfavList",{ParentClass:"RightPanelList_1",getHeadingTemplate:function(){return['<div class="dropdown hw-drop">','<button id="dp_aaa" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">','<input type="text" readonly="true" class="form-control js_type" >','<i class="icon fa fa-caret-down"></i>',"</button>",'<ul class="dropdown-menu" aria-labelledby="dp_aaa">','<li data-type="all" class="js_a">全部收藏店铺({{list.length}})</li>','<li data-type="deal" class="js_a">正在优惠店铺({{dealList.length}})</li>','<li data-type="pause" class="js_a">暂停营业店铺({{pauseList.length}})</li>',"</ul>","</div>"].join("")},getBodyTemplate:function(){return""},setListHtml:function(e,a){var t=["{{each list as item}}",'<div class="hw-each">','<img class="hw-img" src="{{item.logo | absImage}}" />','{{if item.bizType==="pause"}}','<div class="mask">暂停营业</div>',"{{/if}}",'<div class="h4">',"<b>{{item.name_cn}}</b>",'<i class="icon icon-v">v</i>',"</div>",'<div style="margin-top: 0;" role="StarRank" data-rank="3.5"></div>','<span style="margin-left: 10px;font-size: 14px;">{{item.commentnum}}条评论</span>','<p style="font-size: 14px;margin-top:8px;">地址 : {{item | storeFullAddress}} &nbsp;&nbsp; 电话 : {{item.tel}}</p>','<div class="r">','<b class="hw-a js_share" style="margin-top: 18px;">分享</b>','<b class="hw-a js_toReply">评论</b>','<b param="{{item.bookmarkid}}" class="hw-a js_del">取消收藏</b>',"</div>","</div>","{{/each}}"].join("");t=template.compile(t)({list:e,type:{pause:"pause"===a?!0:!1,deal:"deal"===a?!0:!1}}),this.jq.panelBody.html(t)},getData:function(e,a,t){var i=[],s=[],l=[];KG.request.getMyfavStoreList({},function(e,a){console.log(e,a),e&&(i=a),util.each(i,function(e){"-1"===e.visible.toString()?(e.bizType="pause",s.push(e)):"1"===e.is_promote.toString()&&(e.bizType="deal",l.push(e))}),t({list:i,pauseList:s,dealList:l})})},initEvent:function(){var e=this,a=this.elem.find(".js_type");this.elem.find(".js_a").click(function(){var t=$(this);a.val(t.text());var i,s=t.data("type");"all"===s?i=e.data.list:"deal"===s?i=e.data.dealList:"pause"===s&&(i=e.data.pauseList),e.setListHtml(i)}),this.elem.on("click",".js_del",function(e){var a=$(e.target).attr("param");util.dialog.confirm({msg:"确认取消收藏此店铺么？",YesFn:function(t){KG.request.deleteMyFavStore({id:a},function(a,i){t(),a?$(e.target).closest(".hw-each").fadeOut(400,function(){$(this).remove()}):alert(i)})}})}),this.elem.on("click",".js_toReply",function(){alert("To Reply Page")}),this.elem.on("click",".js_share",function(e){var a="http:www.wenxuecity.com";alert("share biz url "+a),util.dialog.showQrCode(a)})},initEnd:function(){this.elem.find(".js_a").eq(0).trigger("click"),KG.component.init(this.elem)}})}();
"use strict";!function(){KG.Class.define("MycouponList",{ParentClass:"RightPanelList_1",getHeadingTemplate:function(){return['<div class="dropdown hw-drop">','<button id="dp_aaa" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">','<input type="text" readonly="true" class="form-control js_type" >','<i class="icon fa fa-caret-down"></i>',"</button>",'<ul class="dropdown-menu" aria-labelledby="dp_aaa">','<li class="js_a" param="0">全部优惠（{{listLen}}）</li>','<li class="js_a" param="1">正在优惠（{{runningLen}}）</li>','<li class="js_a" param="2">过期优惠（{{stopLen}}）</li>',"</ul>","</div>"].join("")},getBodyTemplate:function(){return""},getListTemplate:function(){return["{{each list as item}}",'<div class="hw-each">','<img class="hw-img" src="{{item.logo | absImage}}" />',"{{if !item.active_time}}",'<div class="mask">已过期</div>',"{{/if}}",'<div style="margin-top: 10px;" class="h4">',"<b>{{item.subject}}</b>","</div>",'<p style="font-size: 16px;margin-top:20px;">{{item.top_start_time}} 至 {{item.top_end_time}}</p>','<div class="r">',"{{if !item.active_time}}",'<b class="hw-a js_del" param="{{item.pk_id}}" style="margin-top: 48px;">删除</b>',"{{else}}",'<b class="hw-a js_sendphone" param="{{item.pk_id}}" style="margin-top: 18px;">发送短信至手机</b>','<b class="hw-a js_share" param="{{item.pk_id}}">分享</b>','<b class="hw-a js_del" param="{{item.pk_id}}">删除</b>',"{{/if}}","</div>","</div>","{{/each}}"].join("")},setListHtml:function(t){var i=template.compile(this.getListTemplate())({list:t});this.jq.panelBody.html(i)},getData:function(t,i,a){KG.request.getMycouponList({},function(t,i){var e=i,s=[],n=[];util.each(e,function(t){t.active_time?s.push(t):n.push(t)}),a({list:e,runningList:s,stopList:n,stopLen:n.length,runningLen:s.length,listLen:e.length})})},initEvent:function(){var t=this,i=this.elem.find(".js_type");this.elem.find(".js_a").click(function(){var a=$(this);i.val(a.text());var e=a.attr("param"),s=null;switch(e){case"0":s=t.data.list;break;case"1":s=t.data.runningList;break;case"2":s=t.data.stopList}t.setListHtml(s)}),this.jq.panelBody.on("click",".js_del",function(t){var i=$(this),a=i.attr("param");util.dialog.confirm({msg:"确认删除这条优惠么？",YesFn:function(t){t(),KG.request.deleteMyFavCoupon({id:a},function(t,i){console.log(t,i),t&&location.reload(!0)})}})}),this.jq.panelBody.on("click",".js_share",function(){var t=$(this);t.attr("param");util.dialog.showQrCode("http://www.haiwai.com")})},initEnd:function(){this.elem.find(".js_a").eq(0).trigger("click")}})}();
"use strict";!function(){KG.Class.define("MysysMessageList",{ParentClass:"RightPanelList_1",getHeadingTemplate:function(){return['<div class="dropdown hw-drop">','<button id="dp_aaa" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">','<input type="text" readonly="true" class="form-control js_type" >','<i class="icon fa fa-caret-down"></i>',"</button>",'<ul class="dropdown-menu" aria-labelledby="dp_aaa">','<li class="js_a">全部系统消息</li>',"</ul>","</div>"].join("")},getBodyTemplate:function(){return['<div class="hw-each">','<div class="h4">','<label style="margin-left: 0;cursor: pointer;" class="hw-u js_sel_all" for="ck_aaa">全选</label>',"</div>",'<div class="r">','<b class="hw-a js_del_all">删除</b>',"</div>","</div>","{{each list as item}}",'<div class="hw-each">','<div class="h4">','<input param="{{item.id}}" type="checkbox" class="js_check" value="">','<a href="messageDetail.html?id={{item.id}}" class="hw-u">海外管理员</a>','<a {{if item.view>0}}style="font-weight:400;"{{/if}} href="messageDetail.html?id={{item.id}}" class="hw-p">{{item.title}}</a>',"</div>",'<div class="r">','<span>{{item.dateline | formatDate:"mm月dd日"}}</span>','<b param="{{item.id}}" class="js_del hw-a">删除</b>',"</div>","</div>","{{/each}}",'<div class="hw-each">','<div class="h4">','<label style="margin-left: 0;cursor: pointer;" class="hw-u js_sel_all" for="ck_bbb">全选</label>',"</div>",'<div class="r">','<b class="hw-a js_del_all">删除</b>',"</div>","</div>"].join("")},getData:function(e,t,a){KG.request.getSystemMessageList({},function(e,t){a({list:t.rs})})},initEvent:function(){var e=this,t=this.elem.find(".js_type");this.elem.find(".js_a").click(function(){var e=$(this);t.val(e.text())}),this.elem.on("click",".js_del",function(t){var a=$(this).attr("param"),s=$(this).closest(".hw-each");e.deleteOneMessage(a,function(){s.fadeOut(200,function(){s.remove()})})}),this.elem.find(".js_sel_all").click(function(){var t=e.elem.find(".js_check");t.prop("checked",!0)}),this.elem.find(".js_del_all").click(function(){var t=e.elem.find(".js_check"),a=[];util.each(t,function(e){var t=$(e);t.prop("checked")&&a.push(t.attr("param"))}),e.deleteSelectMessage(a,function(){location.reload()})})},initEnd:function(){this.elem.find(".js_a").eq(0).trigger("click")},deleteOneMessage:function(e,t){util.dialog.confirm({msg:"确认要删除此系统消息么？",YesFn:function(a){a(),KG.request.deleteSystemMessageById({id:e},function(e,a){e&&t()})}})},deleteSelectMessage:function(e,t){util.dialog.confirm({msg:"确认要删除这些系统消息么？",YesFn:function(a){a(),KG.request.deleteSystemMessageById({ids:e},function(e,a){e?t():alert(a)})}})}}),KG.Class.define("MycountMessageDetail",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="hw-comp-MycountMessageDetail">',"<h4>{{data.title}}</h4>","<small>{{data.dateline | formatDate}}</small>","<p>{{#data.msgbody}}</p>",'<div class="hw-ft">','<a href="index.html" style="margin-left: 25px;" class="hw-btn hw-blue-btn">返回</a>','<button class="js_del hw-btn hw-light-btn">删除</button>',"</div>","</div>"].join("")},defineProperty:function(){return{msgId:{defaultValue:""}}},getData:function(e,t,a){var s=this.prop.msgId||KG.data.get("msgId");KG.request.getSystemMessageDetail({id:s},function(e,t){e&&a({id:s,data:t})})},initEvent:function(){var e=this.data.id;this.elem.find(".js_del").click(function(){util.dialog.confirm({msg:"确认要删除此系统消息么？",YesFn:function(){KG.request.deleteSystemMessageById({id:e},function(e,t){e&&(location.href="index.html")})}})})}})}();
"use strict";!function(){KG.Class.define("MycountLeftNav",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="hw-comp-MycountLeftNav">','<a class="hw-a js_info" href="info.html">基本信息</a>','<a class="hw-a js_password" href="password.html">修改密码</a>',"</div>"].join("")},getData:function(t,e,a){var i=KG.data.get("page").split("-")[1];a({page:i})},initEnd:function(){this.elem.find(".js_"+this.data.page).addClass("active")}}),KG.Class.define("MycountChangePasswordForm",{ParentClass:"BaseComponent",getTemplate:function(){return["<div>",'<div class="js_old" data-label="旧密码" data-require="true" data-type="password" role="BaseInput"></div>','<div class="js_pwd" data-label="新密码" data-require="true" data-type="password" role="BaseInput"></div>','<div class="js_pwd2" data-label="确认新密码" data-require="true" data-type="password" role="BaseInput"></div>','<a style="margin-top: 20px;float: right;" href="javascript:void(0)" class="hw-btn hw-blue-btn">保存</a>',"</div>"].join("")},initEvent:function(){this.elem.find(".hw-btn").click(this.submit.bind(this))},setJqVar:function(){return{oldObj:KG.component.getObj(this.elem.find(".js_old")),pwdObj:KG.component.getObj(this.elem.find(".js_pwd")),pwd2Obj:KG.component.getObj(this.elem.find(".js_pwd2"))}},submit:function(){var t=this.jq.oldObj,e=this.jq.pwdObj,a=this.jq.pwd2Obj,i=t.getValue(),s=e.getValue(),n=a.getValue();return i?s?s!==n?void a.showError("二次输入的密码不一致"):(util.alert(i+s+n),void this.reset()):void e.showError("请输入新密码"):void t.showError("请输入旧密码")},reset:function(){var t=this.jq.oldObj,e=this.jq.pwdObj,a=this.jq.pwd2Obj;t.reset(),e.reset(),a.reset()}}),KG.Class.define("UploadUserImage",{ParentClass:"BaseUploadImage",getTemplate:function(){return["<div>",'<div class="hw-img-box">','<img class="js_img" src="{{image}}" />','<b class="js_del">删除</b>',"</div>",'<button data-loading-text="正在上传..." class="hw-btn js_btn">从电脑上传图片</button>','<input type="file" />',"</div>"].join("")},getData:function(t,e,a){a({image:this.prop.image})},setJqVar:function(){return{delBtn:this.elem.find(".js_del")}},initEvent:function(){this.callParent("initEvent");var t=this.elem.find(".js_del");this.elem.find(".hw-img-box").hover(function(){t.slideDown(200)},function(){t.slideUp(200)});var e=this.jq;e.delBtn.click(function(){e.img.attr("src",KG.user.get("defaultImage"))})},uploadImageFn:function(t,e){var a=this;if(t){var i=new FileReader;i.onload=function(t){var i=t.target.result;KG.request.uploadUserImage({image:i},function(t,i){if(t){var s=KG.config.SiteRoot+i;a.jq.img.attr("src",s)}e()})},i.readAsDataURL(t)}}}),KG.Class.define("SelectLocationRange",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="hw-comp-SelectLocationRange">','<select class="js_country">',"{{each countryList as item}}",'<option value="{{item.id}}" {{if item.id==region[0]}}selected="true"{{/if}}>{{item.name}}</option>',"{{/each}}","</select>",'<select class="js_state"></select>',"<br />",'<select style="display: none;" class="js_city"></select>','<select style="display: none;" class="js_area"></select>',"</div>"].join("")},defineProperty:function(){return{region:{defaultValue:"1,-1,-1,-1"}}},setJqVar:function(){return{country:this.elem.find(".js_country"),state:this.elem.find(".js_state"),city:this.elem.find(".js_city"),area:this.elem.find(".js_area")}},getData:function(t,e,a){var i=this;KG.request.getAllAddressAreaInfo({},function(t,e){var s=i.getListData(e),n={},l=function(t){util.each(t,function(t){n[t.pk_id]=t,t.child&&l(t.child)})};l(e);var o=i.prop.region.split(",");a({countryList:s,all:n,region:o})})},initEventEnd:function(){var t=this;this.jq.country.change(function(){var e=$(this).val();t.changeCountry(e)}),this.jq.state.change(function(){var e=$(this).val();t.changeState(e)}),this.jq.city.change(function(){var e=$(this).val();t.changeCity(e)})},changeCountry:function(t,e){if("-1"===t)return this.jq.state.val("-1"),this.jq.city.val("-1").hide(),void this.jq.area.val("-1").hide();var a=this.getListData(this.data.all[t].child);this.setListHtml(a,this.jq.state,e)},changeState:function(t,e){if("-1"===t)return this.jq.city.val("-1").hide(),void this.jq.area.val("-1").hide();var a=this.getListData(this.data.all[t].child);this.setListHtml(a,this.jq.city,e)},changeCity:function(t,e){if("-1"===t)return void this.jq.area.val("-1").hide();var a=this.getListData(this.data.all[t].child);this.setListHtml(a,this.jq.area,e)},getListData:function(t){return util.map(t,function(t){return t.id=t.pk_id,t})},setListHtml:function(t,e,a){if(!t||t.length<1)return void e.hide();var i=['<option value="-1">请选择</option>',"{{each data as item}}",'<option value="{{item.id}}">{{item.name}}</option>',"{{/each}}"].join("");e.html(template.compile(i)({data:t})),a=a||"-1",e.show().find('[value="'+a+'"]').attr("selected",!0),e.trigger("change")},getValue:function(){var t,e=[this.jq.country.val(),this.jq.state.val(),this.jq.city.val(),this.jq.area.val()];return util.each(e,function(e){e&&"-1"!==e&&(t=e)}),t},setValue:function(t){var e=this.data.all[t];console.log(e)},initEnd:function(){var t=this.data.region,e=t[0],a=t[1],i=t[2],s=t[3];this.changeCountry(e,a),this.changeState(a,i),this.changeCity(i,s),this.initEventEnd()}}),KG.Class.define("MycountChangeInfoForm",{ParentClass:"BaseComponent",getTemplate:function(){return["<div>",'<div class="js_username" data-value="{{user.nick}}" data-label="用户名" data-require="true" role="BaseInput"></div>','<div class="js_regemail" data-value="{{user.contact_email}}" data-label="注册邮箱" data-require="true" data-type="email" role="BaseInput"></div>','<div class="form-group">','<label class="lab">头像</label>','<div data-image="{{user.avatar_url | absImage}}" class="hw-upload" role="UploadUserImage"></div>',"</div>",'<div class="hw-line"></div>','<div class="form-group">','<label class="lab require">所在地区</label>','<div class="js_loc" data-region="{{region}}" role="SelectLocationRange"></div>',"</div>",'<div class="js_phone" data-value="{{user.tel}}" data-label="联络电话" role="BaseInput"></div>','<div class="js_wx" data-value="{{user.ims_value}}" data-label="微信号" role="BaseInput"></div>','<div class="hw-line"></div>','<div class="form-group">','<label class="lab">个人介绍</label>','<textarea class="form-control hw-area js_desc">{{user.signature}}</textarea>',"</div>",'<a style="margin-top: 20px;float: right;" href="javascript:void(0)" class="js_btn hw-btn hw-blue-btn">保存</a>',"</div>"].join("")},setJqVar:function(){return{btn:this.elem.find(".js_btn")}},getElemObj:function(){return{nick:KG.component.getObj(this.elem.find(".js_username")),email:KG.component.getObj(this.elem.find(".js_regemail")),tel:KG.component.getObj(this.elem.find(".js_phone")),wechat:KG.component.getObj(this.elem.find(".js_wx")),region:KG.component.getObj(this.elem.find(".js_loc")),desc:this.elem.find(".js_desc")}},getData:function(t,e,a){KG.request.getUserDetailInfo({},function(t,e){console.log(e);for(var i=[],s=e.region_tree,n=3;n>-1;n--)i.push(s[n]?s[n].pk_id:"-1");a({region:i.join(","),user:e})})},initEvent:function(){this.jq.btn.click(this.submit.bind(this))},submit:function(){var t=this.getElemObj(),e={nickname:t.nick.getValue(),contact_email:t.email.getValue(),tel:t.tel.getValue(),wechat:t.wechat.getValue(),region:t.region.getValue(),signature:t.desc.val()};console.log(e),KG.request.modifyUserInfo(e,function(t,e){t||util.dialog.alert(e),util.alert("修改成功")})},initEnd:function(){}})}();
!function(){KG.Class.define("MybizEditStoreLeftDropdown",{ParentClass:"BaseSelectInput",getTemplate:function(){return['<div class="dropdown hw-comp-MybizEditStoreLeftDropdown">','<button id="{{uuid}}" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">','<input type="text" readonly="true" class="form-control js_input" value="{{value}}">','<i class="icon fa fa-caret-down"></i>',"</button>",'<ul class="dropdown-menu" aria-labelledby="{{uuid}}">',"{{each list as item}}",'<li index="{{$index}}" class="js_drop">',this.getEachHtml(),"</li>","{{/each}}","</ul>","</div>"].join("")},getData:function(t,i,e){this.getEachHtml=function(){return"{{item}}"};var a=["正在营业","暂停营业","删除店铺"];this.prop;e({value:a[0],placeholder:"",uuid:"dl_"+util.getUuid(),list:a,bizId:KG.data.get("id")})},clickCallback:function(t){var i=this;t===this.data.list[1]?util.dialog.confirm({title:"确认要暂停营业吗？",msg:"点击确认，您的店铺将会进入暂停营业的状态。暂停营业的店铺将不可以修改基本信息，但您可以在任何时候将它转为营业中的状态。",YesFn:function(t){i.stopStore.call(i),t()}}):t===this.data.list[2]&&util.dialog.confirm({title:"确认要删除这个店铺吗？",msg:"点击确认，我们将为您删除这个店铺的所有信息，包括基本信息，图片，店铺评级和评论等，并且不能再找回这些信息，请谨慎操作。",YesFn:function(t){i.deleteStore(),t()}})},stopStore:function(){alert(this.data.bizId)},deleteStore:function(){alert(this.data.bizId)}})}();
!function(){KG.Class.define("MybizCreateStoreStepInfo",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="hw-stepinfo {{step}}">','<div class="c c1"><i class="fa fa-check"></i></div>','<div class="d d1"></div>','<div class="c c2"><i class="fa fa-check"></i></div>','<div class="d d2"></div>','<div class="c c3"><i class="fa fa-check"></i></div>','<p class="p p1">基本信息</p>','<p class="p p2">更多描述</p>','<p class="p p3">上传图片</p>',"</div>"].join("")},defineProperty:function(){return{step:{defaultValue:"step1"}}},getData:function(t,e,i){i({step:this.prop.step})}}),KG.Class.define("MybizStoreInfoFormStep1",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="hw-comp-MybizStoreInfoFormStep1">','<div {{if biz}}data-value="{{biz.name_cn}}"{{/if}} class="js_name" role="BaseInput" data-label="店铺名称" data-require="true" placeholder="e.g. 小肥羊Fremont店 （请尽量用中文名，分店请尽量添加城市名）"></div>','<div {{if biz}}data-value="{{biz.tel}}"{{/if}} class="js_tel" role="BaseInput" data-label="营业电话" data-require="true" placeholder="e.g. 5107687776"></div>','<div class="js_cat" data-label="服务类别" data-require="true" role="BaseSelectInput" init-self="true" placeholder="请选择一种类别"></div>','<div {{if biz}}data-value="{{biz.address}}"{{/if}} class="js_address" role="BaseInput" data-label="店铺地址" placeholder="街道地址，如3442 Mackenzie Dr (可选)"></div>','<div {{if biz}}data-value="{{biz.zip}}"{{/if}} style="margin-left: 0;" class="js_zip hw-inline" role="BaseInput" data-require="true" data-label="邮编" placeholder="e.g. 94536"></div>','<div {{if biz}}data-value="{{biz.city}}"{{/if}} class="js_city hw-inline" data-delbtn="true" role="BaseInput" data-require="true" data-label="城市"></div>','<div {{if biz}}data-value="{{biz.state}}"{{/if}} class="js_state hw-inline" data-delbtn="true" role="BaseInput" data-require="true" data-label="州/省"></div>','<div class="form-group js_tag">',"<label>营业特色</label>",'<div class="hw-tagbox">',"</div>","</div>",'<button style="float: right;" class="js_btn hw-btn hw-blue-btn">下一步</button>',"<div>"].join("")},getData:function(t,e,i){var a=[function(){return KG.request.getAllStoreCategoryList({})}];KG.data.get("id")&&a.push(function(){return KG.request.getBizDetailById({bizId:KG.data.get("id")})}),KG.request.defer(a,function(t,e){i({catList:t,biz:e||!1})})},setJqVar:function(){return{tagBox:this.elem.find(".hw-tagbox"),btn:this.elem.find(".js_btn")}},getElemObj:function(){return{name:KG.component.getObj(this.elem.find(".js_name")),tel:KG.component.getObj(this.elem.find(".js_tel")),address:KG.component.getObj(this.elem.find(".js_address")),zip:KG.component.getObj(this.elem.find(".js_zip")),city:KG.component.getObj(this.elem.find(".js_city")),state:KG.component.getObj(this.elem.find(".js_state"))}},getFormValue:function(){var t=this.getElemObj(),e={bizName:t.name.getValue(),bizTel:t.tel.getValue(),bizTagId:this.jq.cat.getValue().pk_id,zip:t.zip.getValue(),address:t.address.getValue(),city:t.city.getValue(),state:t.state.getValue(),tags:this.getTagBoxValue()};return e},validate:function(){return!0},initEvent:function(){var t=this;this.jq.btn.click(function(){var e=t.getFormValue();console.log(e),t.validate(e)&&KG.request.createStoreByStep1(e,function(t,e){t&&(console.log(e),location.href="createStore_2.html?tmp_biz_id="+e.entityID+"&main_tag_id="+e.main_tag_id)})})},initEnd:function(){var t=this,e=this.elem.find(".js_cat");if(this.jq.cat=KG.component.initWithElement(e,{list:this.data.catList,getEachHtml:function(){return"{{item.name}}"},clickCallback:function(e){t.switchCategory.call(t,e)}}),this.data.biz){var i=util.map(this.data.catList,function(t){return t.pk_id});i=util.indexOf(i,this.data.biz.fk_main_tag_id);var a=this.data.catList[i];this.jq.cat.setOnlyValue(a.name),this.switchCategory(a,function(){util.each(t.data.biz.tags,function(e){t.jq.tagBox.find('[uid="'+e.pk_id+'"]').attr("checked",!0)})})}},switchCategory:function(t,e){e=e||util.noop;var i=t.pk_id,a=this;KG.request.getAllStoreTagByCategory({catId:i},function(t,i){t&&(a.setTagHtml(i),e())})},setTagHtml:function(t){var e='{{each list as item}}<label><input type="checkbox" uid="{{item.pk_id}}" />{{item.name}}</label>{{/each}}';e=template.compile(e)({list:t}),this.jq.tagBox.html(e)},getTagBoxValue:function(){var t=[];return this.jq.tagBox.find('input[type="checkbox"]').each(function(){var e=$(this);e.prop("checked")&&t.push(e.attr("uid"))}),t.join(",")}}),KG.Class.define("MybizStoreInfoFormStep2",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="hw-comp-MybizStoreInfoFormStep2">','<div class="js_dybox"></div>','<div class="js_link" role="BaseInput" data-label="店铺网址" placeholder="e.g. www.xiaofeiyang.com"></div>','<div class="js_wx" role="BaseInput" data-label="微信号" placeholder="e.g. xiaofeiyang"></div>','<div class="form-group">','<label class="lab">店铺描述</label>','<textarea style="height: 150px;" class="form-control hw-area js_desc"></textarea>',"</div>",'<a class="hw-btn hw-light-btn" style="border: none;font-weight: 400;" href="createStore.html">返回上一步</a>','<button style="float: right;" class="js_btn hw-btn hw-blue-btn">下一步</button>',"<div>"].join("")},setJqVar:function(){return{btn:this.elem.find(".js_btn")}},getElemObj:function(){return{net:KG.component.getObj(this.elem.find(".js_link")),wechat:KG.component.getObj(this.elem.find(".js_wx")),desc:this.elem.find(".js_desc")}},initEnd:function(){this.renderDynamicBox()},getFormValue:function(){var t=this.getElemObj();return{bizTmpId:this.data.tmpBizId,wechat:t.wechat.getValue(),description:t.desc.val()}},initEvent:function(){var t=this;this.jq.btn.click(function(){var e=t.getFormValue();e.dynamic=t.getDynamicData(),KG.request.createStoreByStep2(e,function(t,e){t&&(console.log(e),location.href="createStore_3.html?tmp_biz_id="+e+"&main_tag_id="+KG.data.get("mainTagId"))})})},getData:function(t,e,i){var a=KG.data.get("tmpBizId"),n=KG.data.get("mainTagId");KG.request.getTmpStoreDynamicField({mainTagId:n},function(t,e){t?(console.log(e),i({tmpBizId:a,dynamic:e})):i({tmpBizId:a,dynamic:[]})})},initVar:function(){this.dynamicObj={}},renderDynamicBox:function(){var t=this,e=this.data.dynamic;util.each(e,function(e){t.renderEachDynamic(e)})},getDynamicData:function(){var t={};return _.each(this.dynamicObj,function(e,i){t["dynamic_fields["+e.id+"][type]"]=e.type,t["dynamic_fields["+e.id+"][value]"]=util.isFunction(e.val)?e.val.call(e.obj):e.val}),t},renderEachDynamic:function(t){var e=this.elem.find(".js_dybox"),i="";switch(t.field_type){case"1":case"2":case"3":case"4":case"8":case"9":i='<div class="js_role" role_type="'+t.field_type+'" role="BaseInput" data-label="'+t.field_name+'" ></div>',e.append(i),this.dynamicObj[t.field_name]={obj:KG.component.initWithElement(e.find("[role_type]")),type:t.field_type,val:function(){return this.getValue()}};break;case"6":i='<div class="js_role" role_type="'+t.field_type+'" data-label="'+t.field_name+'" role="BaseSelectInput" init-self="true"></div>',e.append(i);var a=KG.component.initWithElement(e.find("[role_type]"),{list:_.map(t.default_option,function(t){return t.m_value}),clickCallback:function(t){console.log(t)}});this.dynamicObj[t.field_name]={obj:a,type:t.field_type,val:function(){return this.getValue()}};break;case"5":i='<div class="hw-dym" param="'+t.field_id+'"><span>'+t.field_name+"</span>",_.each(t.default_option,function(e){i+='<label><input type="radio" value="'+e.m_value+'" class="radio-inline" name="'+t.field_id+'" />'+e.m_value+"</label>"}),i+="</div>",e.append(i),this.dynamicObj[t.field_name]={obj:null,type:t.field_type,val:function(){var i="";return e.find('[param="'+t.field_id+'"]').find("input").each(function(){var t=$(this);t.prop("checked")&&(i=t.val())}),i}}}this.dynamicObj[t.field_name].id=t.field_id}}),KG.Class.define("UploadStoreImage",{ParentClass:"BaseUploadImage",getTemplate:function(){return["<div>",'<div class="hw-img-box">','<img class="js_img" src="{{image}}" />','<b class="js_del">删除</b>',"</div>",'<button data-loading-text="正在上传..." class="hw-btn js_btn">从电脑上传图片</button>','<input type="file" />',"</div>"].join("")},defineProperty:function(){return{biztype:{defaultValue:"tmp"},bizid:{}}},getData:function(t,e,i){i({image:this.prop.image})},setJqVar:function(){return{delBtn:this.elem.find(".js_del")}},initEvent:function(){this.callParent("initEvent");var t=this.elem.find(".js_del");this.elem.find(".hw-img-box").hover(function(){t.slideDown(200)},function(){t.slideUp(200)});var e=this.jq;e.delBtn.click(function(){e.img.attr("src","")})},uploadImageFn:function(t,e){var i=this,a={};"tmp"===this.prop.biztype&&(a.bizTmpId=this.prop.bizid);var n=new FileReader;n.onload=function(t){a.image=t.target.result,KG.request.uploadTmpBizLogo(a,function(t,a){t&&(console.log(a),i.jq.img.attr("src",KG.config.SiteRoot+a.files[0])),e()})},n.readAsDataURL(t)}}),KG.Class.define("MybizUploadStoreImage",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="hw-comp-MybizUploadStoreImage">','<div class="hw-add js_add">','<i class="icon fa fa-plus-square-o"></i>',"<p>添加新图片</p>",'<input class="js_input" type="file" />',"</div>","</div>"].join("")},setJqVar:function(){return{add:this.elem.find(".js_add"),fileInput:this.elem.find(".js_input")}},getData:function(t,e,i){var a=(KG.user.get("image"),e.list);i({list:a})},initEvent:function(){var t=this;this.jq.fileInput.change(function(){var e=this.files[0];t.uploadImageFn(e,function(e){t.addNewImage(e)}),$(this).val("")}),this.elem.click(function(e){var i=$(e.target),a=i.closest(".js_del");return a.length>0?(util.dialog.confirm1({YesText:"删除",msg:"您确定要删除这张照片吗？",YesFn:function(){t.deleteImage(a),util.dialog.hide()}}),!1):(a=i.closest(".js_img"),a.length>0?(t.showBigImage(a.find("img").attr("src")),!1):void 0)})},showBigImage:function(t){var e=this.getImageList(),i=util.indexOf(e,t);util.dialog.showFocusImage(i,e)},getImageList:function(){var t=this.elem.find(".js_img");return util.map(t,function(t){var e=$(t);return e.find("img").attr("src")})},getValue:function(){return this.getImageList()},deleteImage:function(t){var e=t.closest(".js_img");e.remove()},getEachHtml:function(t){var e=['<div class="hw-one js_img">','<img src="{{url}}" />','<b class="js_del">删除</b>',"</div>"].join("");return template.compile(e)({url:t})},uploadImageFn:function(t,e){util.uploadImage(t,function(t){var t=KG.config.SiteRoot+t;e(t)})},addNewImage:function(t){var e=this.getEachHtml(t);this.jq.add.after(e)},initEnd:function(){var t=this,e=this.data.list;util.each(e,function(e){t.addNewImage(e)})}}),KG.Class.define("MybizStoreInfoFormStep3",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="hw-comp-MybizStoreInfoFormStep3">',"{{if bigBgImageList}}",'<div class="form-group">','<label class="lab">选择店铺背景图片</label>','<div style="width: 700px;margin-left: -7px;">',"{{each bigBgImageList as item}}",'<div class="hw-bigimage">','<div class="js_bigimage c-box">','<img class="js_bigimage" src={{item.url}} />','<i class="fa fa-check"></i>',"</div>",'<a href="{{item.url}}" target="_blank">查看大图</a>',"</div>","{{/each}}","</div>","</div>","{{/if}}",'<div class="form-group">','<label class="lab">店铺Logo</label>','<p class="hw-img-p">店铺／专属页Logo图片是重要的品牌识别标识，建议您上传店铺Logo或职业头像，以增加专业性。该Logo也将用于您的店铺／专属页与用户互动的头像，如回复评论、发布文章、活动。 </p>','<div class="hw-upload" data-biztype="tmp" data-bizid="{{tmpId}}" role="UploadStoreImage"></div>',"</div>",'<div class="hw-line"></div>','<div class="form-group">','<label class="lab">店铺图片</label>','<div class="js_image" role="MybizUploadStoreImage" init-self="true"></div>',"</div>",'<a class="hw-btn hw-light-btn" style="float: left;border: none;font-weight: 400;" href="createStore_2.html">返回上一步</a>','<button style="float: right;" class="js_btn hw-btn hw-blue-btn">完成</button>',"</div>"].join("")},getData:function(t,e,i){var a=KG.data.get("tmpBizId"),n=KG.data.get("mainTagId");KG.request.getStoreBigBackgroundPic({mainTagId:n},function(t,e){var s;s=t?e:null,i({bigBgImageList:s,tmpId:a,tagId:n})})},setJqVar:function(){return{bigImage:this.elem.find(".js_bigimage"),btn:this.elem.find(".js_btn")}},initEvent:function(){var t=this;this.jq.bigImage.click(function(e){var i=$(this);return i.hasClass("active")?!1:(t.jq.bigImage.removeClass("active"),void i.addClass("active"))}),this.jq.btn.click(function(e){var i=t.getFormValue();KG.request.createStoreByStep3(i,function(t,e){t&&(location.href="http://beta.haiwai.com/biz/view.php?id="+e)})})},initEnd:function(){this.image=KG.component.initWithElement(this.elem.find(".js_image"),{list:this.data.imageList||[]}),this.elem.find(".js_bigimage").eq(0).trigger("click")},getFormValue:function(){return{bizTmpId:this.data.tmpId,bgPic:this.jq.bigImage.filter(".active").find("img").attr("src"),imageList:this.image.getValue()}}})}();