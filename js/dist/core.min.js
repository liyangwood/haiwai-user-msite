"use strict";!function(e,t,i){var n=e();e.fn.dropdownHover=function(i){return n=n.add(this.parent()),this.each(function(){var i,o=e(this).parent(),a={delay:500,instantlyCloseOthers:!0},r={delay:e(this).data("delay"),instantlyCloseOthers:e(this).data("close-others")},s=e.extend(!0,{},a,s,r);o.hover(function(){s.instantlyCloseOthers===!0&&n.removeClass("open"),t.clearTimeout(i),e(this).addClass("open")},function(){i=t.setTimeout(function(){o.removeClass("open")},s.delay)})})}}(jQuery,this),function(){this.KG&&(this._KG=KG),this.KG={}}.call(window),function(){var e="http://beta.haiwai.com";("www.haiwai.com"===location.host||"home.haiwai.com"===location.host)&&(e="http://"+location.host),location.href.indexOf("debug=asia")>0&&(e="http://104.199.130.54"),KG.config={root:"/haiwai-user-msite",SiteRoot:e,ApiRoot:e+"/service/api/",MD5_KEY:"m.y^w8oP01K#gs",GoogleMapApiKey:"AIzaSyCjKJoA5eBc75v5pQurBQ3IjP4vNkfoOzw",WeixinAppID:"wx4c519e506d840934",WeixinAppSecret:"a160e78f682317dbf6ed8ffe4e56bc30",WeixinLoginRedirectUrl:e+"/pc/page/site/index.html",SJAPP_AppleStore_Url:"https://itunes.apple.com/us/app/hai-wai-tong-cheng-shang-jia/id974815137",WenxuecityUrl:"http://www.wenxuecity.com"},KG.config.Wenxuecity_Ads_Url=KG.config.WenxuecityUrl+"#haiwai",KG.Const={},KG["default"]={BizBigBgPic:"../../image/default_bg_pic.png",articleImage:KG.config.SiteRoot+"/images/lifetools_default_article.png",couponImage:KG.config.SiteRoot+"/images/default_event_logo.png",storeImage:KG.config.SiteRoot+"/images/default_logo.jpeg"};var t={image:"http://www.sinomedianet.com/haiwai2015.3.19/images/default_avatar.png",defaultImage:"http://www.sinomedianet.com/haiwai2015.3.19/images/default_avatar.png",email:"",userid:"",tel:"",token:"",isLogin:!1};KG.user={get:function(e){return e?t[e]:t},reset:function(){t=_.extend(t,{image:"",email:"",userid:"",token:"",isLogin:!1})},logout:function(){var e={act:"logout",func:"passport"};return e=util.addUserIdToRequestData(e),KG.request.ajax(e,function(e,t){e&&(KG.user.reset(),util.storage.set("current-login-user",null),location.reload())})},set:function(e){return t.image=e.avatar_url,/^http/.test(t.image)||(t.image=KG.config.SiteRoot+t.image),t.isLogin=!0,_.extend(t,e),t},getUserDetailWithToken:function(e,i){e.pk_id&&(t.userid=e.pk_id,t.token=e.token,t.email=e.email,KG.request.getUserDetailInfo({},function(e,n){e&&(KG.user.set(n),util.storage.set("current-login-user",t),i(t))}))},login:function(e,t,i){var n=function(e,n){n.pk_id?KG.user.getUserDetailWithToken(n,t):i(n.msg?n.msg:n)};KG.request.login(e,n,i)},register:function(e,t,i){return KG.request.register(e,t,i)},update:function(){KG.request.getUserDetailInfo({},function(e,i){e&&(KG.user.set(i),util.storage.set("current-login-user",t))})},checkLogin:function(e){e=e||function(){};var i=util.storage.get("current-login-user");i&&i.token?(_.extend(t,i),KG.request.checkLogin({},function(t,i){t?(KG.user.set(i),e()):(KG.user.reset(),e())})):(KG.user.reset(),e())}};var i={};KG.data={get:function(e){return e?i[e]:i},add:function(e){util.extend(i,e||{})}},KG.validate={email:function(e){return e?util.validate.email(e)?[!0]:[!1,util["const"].InputEmailFormatError]:[!1,util["const"].InputEmail]},password:function(e){return e?e.length<6?[!1,"密码长度不能少于6位"]:[!0]:[!1,"请输入密码"]}}}();
!function(){function t(t){return a[t]||null}function e(){return"IObject.random-"+i++}"function"!=typeof Object.create&&(Object.create=function(t){var e=function(){};return e.prototype=t,new e});var n={extend:function(t,e){return e=e||!1,$.extend(e,this,t),this},proxy:function(t,e){return $.isArray(e)||(e=Array.prototype.slice.call(arguments,1)),t.apply(this,e)},call:function(t,e,n){return $.isArray(n)||(n=Array.prototype.slice.call(arguments,2)),e.apply(t,n)},getParent:function(t){var e=this.__base,n=this.__name;if(!t&&!n)return e;for(;e;){if(t&&e.__name===t)return e;if(n!==e.__name)return e;e=e.__base}return e},callParent:function(t,e,n){"string"!=typeof e&&(n=e,e=null);var r,a,i=null;return r=e?this.getParent(e):this.__base||this,r&&(a=r.fn[t],i=a.apply(this,n)),i}},r=function(t,e){return $.extend(t,e)},a={},i=0,o=function(i,o){var s=arguments;"string"!=typeof i?(o=s[0],i=e()):t(i)&&alert(i+" is already exist");var c=null;if(o.ParentClass&&(c=o.ParentClass,delete o.ParentClass),c&&"string"==typeof c&&(c=t(c),!c))throw console.log(o,i),o.ParentClass+" is not exist";var u=function(){this._init&&this._init.apply(this,arguments)};return o.Static&&(u._static=o.Static,delete o.Static),c?(u.prototype=Object.create(c.prototype||c),u.prototype.__base=c,u.prototype.constructor=u,u.prototype.__static=u._static):u.prototype.fn=o,u.fn=u.prototype,$.extend(u.fn,n),o&&r(u.fn,o),u.fn.__type="IObject",u.fn.__name=i,a[i]=u,u},s={define:o,getByName:t,getAll:function(){return a}};KG.Class=s}();
"use strict";!function(){var e=1,t={};_.extend(t,_),t.extend(t,{setPageTitle:function(e){e&&(document.title=e)},addUserIdToRequestData:function(e){return e=e||{},e.userid=KG.user.get("userid"),e.token=KG.user.get("token"),e},formatDate:function(e,t){function o(e){return 10>e?"0"+e:e}10===e.toString().length&&(e=1e3*parseInt(e));var n=new Date(e),i=n.getFullYear(),a=o(n.getMonth()+1),r=o(n.getDate()),l=o(n.getHours()),s=o(n.getMinutes()),c=o(n.getSeconds());return t.replace("yy",i).replace("mm",a).replace("dd",r).replace("h",l).replace("m",s).replace("s",c)},getUuid:function(){return"uuid_"+e++},uploadImage:function(e,t){if(e){var o=new FileReader;o.onload=function(e){var o=e.target.result;KG.request.uploadImage({image:o},function(e,o){e&&t(o.files[0])})},o.readAsDataURL(e)}},readFile:function(e,t){var o=new FileReader;o.onload=function(e){var o=e.target.result;t(o)},o.readAsDataURL(e)},getQrCode:function(e,t){return t=t||240,"http://api.qrserver.com/v1/create-qr-code/?size="+t+"x"+t+"&data="+encodeURIComponent(e)},showPageLoading:function(e){return!1},loading:function(e){return!1},replaceHtmlImgSrcToAbsolute:function(e){var t=new RegExp("<img.*src=(\"|')([^\"']+)(\"|')\\s*([\\w]+=(\"|')([^\"']*)(\"|')\\s*)*/>","g");return e.replace(t,function(e){console.log(e);var t=arguments[2];return/^http/.test(t)?e:e.replace(t,KG.config.SiteRoot+t)})},removeHtmlTag:function(e){return e.replace(/<([^>]*)>/g,"")},getLatAndLongWithAddress:function(e,t){var o="https://maps.googleapis.com/maps/api/geocode/json?address="+e+"&key="+KG.config.GoogleMapApiKey;$.getJSON(o,{},function(e){"OK"===e.status&&t(e.results[0].geometry.location)})}}),t.cookie={get:function(e){var t,o=new RegExp("(^| )"+e+"=([^;]*)(;|$)","gi");return(t=o.exec(unescape(document.cookie)))?t[2]:null},set:function(e,t,o,n,i){n=n||"/",o=o||"never";var a=e+"="+escape(t);if(o){"never"==o&&(o=5256e4);var r=new Date;r.setTime(r.getTime()+60*o*1e3),a+="; expires="+r.toGMTString()}n&&(a+="; path="+n),i&&(a+="; domain="+i),document.cookie=a},remove:function(e,t,o){document.cookie=e+"="+(t?"; path="+t:"")+(o?"; domain="+o:"")+"; expires="+new Date(0).toGMTString()}},t.dom={scrollTo:function(e){var t=$(window);t.scrollTop(e)},showErrorPopover:function(e,t,o){var n="#ff0000";return t===!1?void e.popover("destroy"):(o=o||{},void e.popover({placement:o.placement||"bottom",html:!0,trigger:o.trigger||"click",content:'<span style="color:'+n+'">'+t+"</span>"}).popover("show"))},loadingButton:function(e,t){t?(e.data("loading-text")||e.data("loading-text","Loading..."),e.addClass("btn-loading").button("loading")):e.removeClass("btn-loading").button("reset")}};var o={};t.message={register:function(e,t){var n=function(n,i){i=o[e]?o[e].data:i,t(n,i)};if($("body").unbind(e).bind(e,n),o[e]){var i=o[e];t(null,i.data)}},publish:function(e,t){o[e]={data:t},$("body").trigger(e,t)}};var n=null;t.dialog={setHiddenDialogFn:function(e){n=e},init:function(){var e=['<div class="modal fade" id="kg_modal_dialog" tabindex="-1" role="dialog">','<div class="modal-dialog" role="document">','<div class="modal-content box">',"</div>","</div>","</div>"].join("");e=$(e),e.on("hidden.bs.modal",function(){var t=e.find(".box");t.find(".js_yes").unbind("click"),t.find(".js_no").unbind("click"),t.empty(),n&&(n(),n=null)}),e.appendTo("body")},get:function(e){$("#kg_modal_dialog").length<1&&t.dialog.init();var o=$("#kg_modal_dialog");if(!e)return o;var n=t.extend({title:"信息提示",body:"点击确认，我们将为您删除这个店铺的所有信息，包括基本信息，图片，店铺评级和评论等，并且不能再找回这些信息，请谨慎操作。",foot:!0,type:"confirm",YesText:"确认",YesFn:t.noop,NoText:"取消",NoFn:function(e){e()},end:null},e),i=['{{if type!=="toast"}}','<div class="modal-header">','<button type="button" class="close" data-dismiss="modal" aria-label="Close"><i class="fa fa-times"></i></button>',"</div>","{{/if}}",'<div class="modal-body">',"{{if title}}",'<h4 class="hw-title">{{#title}}</h4>',"{{/if}}",'{{if body}}<div class="hw-body">{{#body}}</div>{{/if}}',"</div>","{{if foot}}",'<div class="modal-footer">','<button type="button" class="hw-btn hw-light-btn js_no">{{NoText}}</button>','{{if YesText}}<button type="button" class="hw-btn hw-blue-btn js_yes">{{YesText}}</button>{{/if}}',"</div>","{{/if}}"].join("");return i=template.compile(i)(n),o.find(".box").html(i),o.find(".js_yes").click(function(e){n.YesFn(function(){t.dialog.hide()},e)}),o.find(".js_no").click(function(e){n.NoFn(function(){t.dialog.hide()},e)}),o.attr("class","modal fade"),e["class"]&&o.addClass(e["class"]),o},show:function(e){var o=t.dialog.get(e);e.beforeShowFn&&e.beforeShowFn.call(o),$("body").hasClass("modal-open")?o.addClass("in"):o.modal("show")},hide:function(){var e=t.dialog.get();e.modal("hide")},showImageList:function(e,o){var n=['<div class="js_box">',"{{each list as item index}}",'<div role="BaseLoadingImageBox" param="{{index}}" data-url="{{item}}" class="img-item"></div>',"{{/each}}","</div>"].join("");n=template.compile(n)({list:e}),t.dialog.show({body:n,foot:!1,"class":"hw-dialog-imglist",title:"("+e.length+")"});var i=t.dialog.get();KG.component.init(i.find(".js_box")),i.find(".js_box").on("click",".img-item",function(){var e=$(this).attr("param");return o(e),!1})},showFocusImage:function(e,o){var n=['<div id="cb_cccc" class="carousel slide" data-ride="carousel">','<ol class="carousel-indicators">',"{{each list}}",'<li data-target="#cb_cccc" data-slide-to="{{$index}}" class="{{if index==$index}}active{{/if}}"></li>',"{{/each}}","</ol>",'<div class="carousel-inner" role="listbox">',"{{each list as url}}",'<div class="item {{if index==$index}}active{{/if}}">','<a target="_blank" href="{{url}}"><img src="{{url}}"></a>',"</div>","{{/each}}","</div>",'<a class="left carousel-control" href="#cb_cccc" role="button" data-slide="prev">','<span style="top:128px;" class="icon fa fa-angle-left" aria-hidden="true"></span>','<span class="sr-only">Previous</span>',"</a>",'<a class="right carousel-control" href="#cb_cccc" role="button" data-slide="next">','<span style="top:128px;" class="icon fa fa-angle-right" aria-hidden="true"></span>','<span class="sr-only">Next</span>',"</a>","</div>"].join("");return n=template.compile(n)({list:o,index:e}),t.dialog.show({body:n,foot:!1,"class":"hw-carousel",title:""}),t.dialog.get()},confirm:function(e){var o={title:e.msg,body:!1,NoText:"取消",YesText:e.YesText||"确认","class":"hw-confirm",YesFn:e.YesFn};e.title&&(o.title=e.title,o.body=e.msg),t.dialog.show(o)},confirm1:function(e){var o={title:e.msg,body:!1,NoText:e.NoText||"取消",YesText:e.YesText||"确认","class":"hw-confirm1",YesFn:e.YesFn};t.dialog.show(o)},showQrCode:function(e,o){var n='<div class="hw-qr"><img src="'+t.getQrCode(e,200)+'" /></div>';t.dialog.show({body:n,title:o||"打开微信扫一扫以下二维码即可打开本店页面，点击屏幕右上角分享按钮",foot:!1,"class":"hw-dialog-qrcode"})},showWeixinLoginQrCode:function(e){var o='<div class="hw-qr" id="js_weixin_qr"></div>';return t.dialog.show({body:o,title:"",foot:!1,"class":"hw-dialog-qrcode"}),console.log(e),new WxLogin({id:"js_weixin_qr",appid:KG.config.WeixinAppID,scope:"snsapi_login",redirect_uri:encodeURIComponent(e),state:"aaa",style:"black",href:""})},showLoginBox:function(e){var o={foot:!1,"class":"hw-dialog-login",body:'<div class="js_role" role="HWLoginRegBoxComp" data-type="login"></div>',beforeShowFn:function(){var e=this;KG.component.initWithElement(e.find(".js_role"))}};t.dialog.show(o)},showLoginAddPasswordBox:function(){var e={foot:!1,"class":"hw-dialog-logininfo",body:'<div class="js_role" role="HWBaseLoginAddPassword"></div>',beforeShowFn:function(){var e=this;KG.component.initWithElement(e.find(".js_role"))}};t.dialog.show(e)},showLoginAddEmailAndPasswordBox:function(){var e={foot:!1,"class":"hw-dialog-logininfo",body:'<div class="js_role" role="HWBaseLoginAddEmailAndPassword"></div>',beforeShowFn:function(){var e=this;KG.component.initWithElement(e.find(".js_role"))}};t.dialog.show(e)},showRegBox:function(e){var o={foot:!1,"class":"hw-dialog-login",body:'<div class="js_role" role="HWLoginRegBoxComp" data-type="reg"></div>',beforeShowFn:function(){var e=this;KG.component.initWithElement(e.find(".js_role"))}};t.dialog.show(o)},alert:function(e,o){o=o||"",t.dialog.show({foot:!1,title:e,body:"<p>"+o+"</p>","class":"hw-dialog-alert"})},showCouponDetail:function(e){var o={foot:!1,title:"","class":"hw-dialog-coupon",body:'<div class="js_role" role="HWSiteCouponDetailComp" data-coupon="'+e+'"></div>',beforeShowFn:function(){var e=this;KG.component.initWithElement(e.find(".js_role"))}};t.dialog.show(o)},showSelectLocationRegion:function(){var e={foot:!1,title:"选择地区","class":"hw-dialog-region",body:'<div class="js_role" role="HWSelectRegionLocation"></div>',beforeShowFn:function(){var e=this;KG.component.initWithElement(e.find(".js_role"))}};t.dialog.show(e)}},t.alert=function(e){t.dialog.alert(e)},t.toast={showError:function(e,o){var n='<div class="hw-icon" style="border: none;"><i style="color: #f4a62a; top:4px;font-size:32px;" class="fa fa-exclamation-circle"></i></div>';t.dialog.alert(n+e,"")},alert:function(e,o){o=o||"";var n='<div class="hw-icon"><i class="fa fa-check"></i></div>';t.dialog.alert(n+e,o),t.delay(function(){try{t.dialog.hide()}catch(e){}},3e3)}},t.url={param:function(e,t){t=t||location.search,e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var o=new RegExp("[\\?&]"+e+"=([^&#]*)"),n=o.exec(t);return null===n?"":decodeURIComponent(n[1].replace(/\+/g," "))},hash:function(){return location.hash.replace(/^#/,"")}},t.storage={set:function(e,o,n){n=t.extend({expires:"max"},n||{});var i=JSON.stringify({data:o});window.localStorage.setItem(e,i)},get:function(e){var t=window.localStorage.getItem(e);return t?JSON.parse(t).data:null}},t.path={go:function(e){location.href=e},article:function(e){return"../view/article.html?id="+e},store:function(e){return"../view/store.html?id="+e},toMSiteStore:function(e){return KG.config.SiteRoot+"/m/page/store.view.html?id="+e},toMSiteArticle:function(e){return KG.config.SiteRoot+"/m/page/article.view.html?id="+e},toMSiteCoupon:function(e){return KG.config.SiteRoot+"/m/page/coupon.view.html?id="+e}},t.validate={email:function(e){var t=/^(?:[\w\!\#\$\%\&\'\*\+\-\/\=\?\^\`\{\|\}\~]+\.)*[\w\!\#\$\%\&\'\*\+\-\/\=\?\^\`\{\|\}\~]+@(?:(?:(?:[a-zA-Z0-9](?:[a-zA-Z0-9\-](?!\.)){0,61}[a-zA-Z0-9]?\.)+[a-zA-Z0-9](?:[a-zA-Z0-9\-](?!$)){0,61}[a-zA-Z0-9]?)|(?:\[(?:(?:[01]?\d{1,2}|2[0-4]\d|25[0-5])\.){3}(?:[01]?\d{1,2}|2[0-4]\d|25[0-5])\]))$/;return t.test(e)},AmericanPhone:function(e){var t=/^[0-9]{10}$/;return t.test(e)},password:function(e){return e?e.length<6?!1:!0:!1}},t.pic={replaceToBig:function(e){return e.indexOf("s_pic0")>0&&(e=e.replace("s_pic0","pic0")),e}},t.helper={getBizListByType:function(e,o){o=o||"running";var n=[],i=[];t.each(e,function(e){"1"===e.visible?n.push(e):i.push(e)});var a=n;return"running"!==o&&(a=i),a}},t["const"]={InputEmail:"请输入邮箱",InputEmailFormatError:"输入邮箱格式不正确",InputPassword:"请输入密码",PasswordNotEqual:"二次输入的密码不一致"},window.util=KG.util=t,t.url.param("debug")||(console.log=console.error=function(){})}(),function(){template.helper("equal",function(e,t){return e===t}),template.helper("absImage",function(e){return/^http/.test(e)?e:KG.config.SiteRoot+e}),template.helper("siteUrl",function(e){return/^http/.test(e)?e:"http://"+e}),template.helper("formatDate",function(e,t){return util.formatDate(e,t||"yy年mm月dd日 h:m:s")}),template.helper("storeFullAddress",function(e){var t="";return e.address&&(t+=e.address+", "),e.city&&(t+=e.city+", "),e.state&&(t+=e.state.toUpperCase()+" "),e.zip&&(t+=e.zip),t}),template.helper("storeFullAddress1",function(e){return e.address_t+", "+e.city+", "+e.state+" "+e.zip}),template.helper("defaultUserImage",function(e){return e?e:KG.user.get("defaultImage")}),template.helper("decode",function(e){if(!e)return"";var t;try{t=decodeURIComponent(e)}catch(o){t=e}return t}),template.helper("htmlToTextNoBr",function(e){var t="";try{t=decodeURIComponent(e).replace(/<([^>]*)>/g,"")}catch(o){t=e.replace(/<([^>]*)>/g,"")}return t}),template.helper("htmlToText",function(e){var t="";try{t=decodeURIComponent(e).replace(/<([^>]*)>/g,"")}catch(o){t=e.replace(/<([^>]*)>/g,"")}return t=t.replace(/\n/g,"<br/>")}),template.helper("toArticlePath",function(e){return util.path.article(e)}),template.helper("toStorePath",function(e){return util.path.store(e)}),template.helper("logoPath",function(e){var t=e.logo[0].path;return/^http/.test(t)?t:KG.config.SiteRoot+t}),template.helper("formatPhone",function(e){var t=e.toString().split("");return t.splice(3,0,"-"),t.splice(7,0,"-"),t.join("")})}(),$(function(){window.fbAsyncInit=function(){FB.init({appId:"250258495319287",cookie:!0,xfbml:!0,version:"v2.5"})},function(e,t,o){var n,i=e.getElementsByTagName(t)[0];e.getElementById(o)||(n=e.createElement(t),n.id=o,n.src="//connect.facebook.net/en_US/sdk.js",i.parentNode.insertBefore(n,i))}(document,"script","facebook-jssdk");var e=["email","first_name","last_name","name","gender","picture"].join(",");window.util.Facebook={getTokenWithData:function(e,t){KG.request.oauthLoginWithFacebook({openID:e.id,email:e.email,nick:e.name,image:e.picture.data.url},function(e,o){e?t(!0,o):t(!1,o)})},login:function(t){FB.getLoginStatus(function(o){"connected"===o.status?FB.api("/me",function(e){console.log(e),util.Facebook.getTokenWithData(e,t)},{fields:e}):FB.login(function(o){console.log(o),"connected"===o.status?FB.api("/me",function(e){console.log(e),util.Facebook.getTokenWithData(e,t)},{fields:e}):(util.toast.showError("登录失败"),t(!1),_.delay(function(){location.reload()},2e3))})})}}});
KG.request={ajax:function(t,e,a){var i=KG.config.ApiRoot+"?format=json",n=t.method||"get";delete t.method;var r=$.Deferred();t.url&&(i+="&"+t.url,delete t.url),"post"===n&&(i+="&func="+t.func,i+="&act="+t.act);var o="json";return t.jsonp&&(o="jsonp",delete t.jsonp),$.ajax({type:n,url:i,data:t,dataType:"get"===n?"jsonp":o,success:function(t){return 404===t.status?void(location.href="../help/404.html"):(e&&e.call(null,t.status>0,t["return"]),void r.resolve(t["return"]))},error:function(t){a&&a(t),r.reject(t)}}),r},defer:function(t,e,a){var i=[];util.each(t,function(t){i.push(t())}),$.when.apply($,i).then(e,a)},mockData:function(t,e,a){var i=$.Deferred();return util.delay(function(){e&&e(!0,t),i.resolve(t)},500),i},getBizList:function(t,e,a){var i={func:"biz",userid:KG.user.get("userid"),detail:1,token:KG.user.get("token")};return this.ajax(i,e,a)},getBizDetailById:function(t,e,a){var i={func:"biz",act:"view",bizid:t.bizId,userid:KG.user.get("userid"),token:KG.user.get("token")};return this.ajax(i,e,a)},getBizCouponList:function(t,e,a){var i=[{id:123,logo:"/images/165/118/upload/classifiedinfo/19/f9/05/19f905692cf998e30745e31e9f3d28e9.jpg",title:"全场满100元送午餐券",count:100,bizInfo:{name:"小肥羊Fremont店",address:"Fremont, CA 98765"},stop:!0,startTime:1449772731230,endTime:1449772831230},{id:234,logo:"/images/165/118/upload/classifiedinfo/19/f9/05/19f905692cf998e30745e31e9f3d28e9.jpg",title:"全场满100元送午餐券",count:100,bizInfo:{name:"小肥羊Fremont店",address:"Fremont, CA 98765"},startTime:1449772731230,endTime:1449772831230}];return this.mockData(i,e,a)},getSystemMessageList:function(t,e,a){var i={func:"sysmsg"};return util.addUserIdToRequestData(i),console.log(i),this.ajax(i,e,a)},getSystemMessageDetail:function(t,e,a){var i={func:"sysmsg",act:"view",id:t.id};return util.addUserIdToRequestData(i),this.ajax(i,e,a)},deleteSystemMessageById:function(t,e,a){var i={func:"sysmsg",act:"delete"};return t.id?i["id[1]"]=t.id:t.ids&&util.each(t.ids,function(t,e){i["id["+(e+1)+"]"]=t}),util.addUserIdToRequestData(i),this.ajax(i,e,a)},uploadImage:function(t,e,a){var i={func:"article",act:"upload",method:"post",type:"image","uploadfield[]":t.image};return this.ajax(i,e,a)},uploadUserImage:function(t,e,a){var i={func:"passport",method:"post",act:"upload","uploadfield[]":t.image};return i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},getAllAddressAreaInfo:function(t,e,a){var i={func:"biz",act:"get_allregion"};return this.ajax(i,e,a)},getUserDetailInfo:function(t,e,a){var i={act:"getuser",check:md5(KG.config.MD5_KEY+KG.user.get("userid")),func:"passport",userid:KG.user.get("userid")};return this.ajax(i,function(t,a){e(!0,a[i.userid])},a)},getAllStoreCategoryList:function(t,e,a){var i={func:"biz",act:"tags"};return this.ajax(i,e,a)},getAllStoreTagByCategory:function(t,e,a){var i={func:"biz",act:"taglist",biztagid:t.catId};return this.ajax(i,e,a)},getMyfavStoreList:function(t,e,a){var i={func:"biz",act:"bookmark"};return t.is_active&&(i.is_active="1"),t.not_open&&(i.visible="-1"),i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},deleteMyFavStore:function(t,e,a){var i={func:"biz",act:"delete_bookmark",type:"biz",id:t.id,entityID:t.bizId};return i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},deleteMyFavCoupon:function(t,e,a){var i={func:"biz",act:"delete_bookmark",type:"classifiedinfo",id:t.id,entityID:t.id};return i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},getMycouponList:function(t,e,a){var i={func:"event",act:"bookmark"};return t.is_active&&(i.is_active="1"),t.not_active&&(i.is_active="0"),util.addUserIdToRequestData(i),this.ajax(i,e,a)},getSiteArticleList:function(t,e,a){var i={func:"view",act:"article_list",category_id:t.category};return"hot"===i.category_id&&delete i.category_id,t.lastid&&(i.lastid=t.lastid),this.ajax(i,e,a)},sendSmsToUserPhone:function(t,e,a){var i={func:"sms",act:"send_event",number:t.number,biz_name:encodeURIComponent(t.biz_name),event_title:encodeURIComponent(t.event_title),entityID:t.id};return util.addUserIdToRequestData(i),this.ajax(i,e,a)},modifyUserInfo:function(t,e,a){var i={func:"passport",act:"update",nick:t.nickname,region:t.region,contact_email:t.contact_email||"",email:t.email,tel:t.tel,wechat:t.wechat,signature:t.description};return i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},createStoreByStep1:function(t,e,a){var i={func:"biz",act:"pc_add",step:1,bizname:t.bizName,biztel:t.bizTel,biztagid:t.bizTagId,sec_tags:t.tags,address:t.address,city:t.city,state:t.state,zip:t.zip};return t.timeinfo&&_.isArray(t.timeinfo)&&_.each(t.timeinfo,function(t,e){i["timeinfo["+e+"][daytime]"]=t.daytime.join(","),i["timeinfo["+e+"][weektime]"]=t.weektime.join(",")}),i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},saveStoreByStep1:function(t,e,a){var i={func:"biz",act:"update",bizid:t.bizId,biztagid:t.bizTagId,name_cn:t.bizName,city:t.city,state:t.state,zip:t.zip,address:t.address,tel:t.bizTel,sec_tags:t.tags};return t.timeinfo&&_.isArray(t.timeinfo)&&_.each(t.timeinfo,function(t,e){i["timeinfo["+e+"][daytime]"]=t.daytime.join(","),i["timeinfo["+e+"][weektime]"]=t.weektime.join(",")}),i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},createStoreByStep2:function(t,e,a){var i={func:"biz",act:"pc_add",step:2,biz_tmpid:t.bizTmpId,wechat:t.wechat,description:t.description};return util.extend(i,t.dynamic||{}),i=util.addUserIdToRequestData(i),console.log(i),this.ajax(i,e,a)},saveStoreByStep2:function(t,e,a){var i={func:"biz",act:"update_field",bizid:t.bizId,website:t.website,briefintro:t.description,wechat:t.wechat};return util.extend(i,t.dynamic||{}),i=util.addUserIdToRequestData(i),console.log(i),this.ajax(i,e,a)},getTmpStoreDynamicField:function(t,e,a){var i={func:"biz",act:"get_dynamic_fields",main_tagid:t.mainTagId};return this.ajax(i,e,a)},getStoreDynamicField:function(t,e,a){var i={func:"biz",act:"get_biz_dynamic_fields",bizid:t.bizId,main_tagid:t.tagid};return this.ajax(i,e,a)},createStoreByStep3:function(t,e,a){var i={func:"biz",act:"pc_add",step:3,biz_tmpid:t.bizTmpId||"",background_pic:t.bgPic};return t.logo&&(i.logo=t.logo),util.each(t.imageList||[],function(t,e){i["uploadfield["+e+"]"]=t}),i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},updateStoreByStep3:function(t,e,a){var i={func:"biz",act:"update_upload",method:"post",bizid:t.bizId,background_pic:t.bgPic};return i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},getStoreBigBackgroundPic:function(t,e,a){var i={func:"biz",act:"get_background_pic",main_tagid:t.mainTagId};return this.ajax(i,e,a)},uploadTmpBizLogo:function(t,e,a){var i={func:"biz",act:"upload",method:"post",logo:1,"uploadfield[]":t.image};return"tmp"===t.type?(i.tmp=1,i.biz_tmpid=t.bizId):i.bizid=t.bizId,i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},uploadStoreImage:function(t,e,a){var i={func:"biz",act:"upload",method:"post","uploadfield[]":t.image,bizid:t.bizId};return"tmp"===t.type&&(i.biz_tmpid=t.bizId,i.tmp=1,delete i.bizid),i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},createStoreCouponEvent:function(t,e,a){var i={func:"event",act:"post",method:"post",subject:t.subject,description:t.description,fk_entityID:t.biz,start_date:t.startDate,end_date:t.endDate,fk_region_id:t.region};return i.start_date=moment.utc(i.start_date).unix(),"unlimit"!==i.end_date&&(i.end_date=moment.utc(i.end_date).unix()),util.each(t.imageList||[],function(t,e){i["files["+e+"]"]=t}),t.id&&(i.id=t.id),i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},getUserArticleAndCouponList:function(t,e,a){var i={func:"passport",act:"get_article_event",lastid_article:t.lastid_article};return i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},getUserCouponList:function(t,e,a){var i={func:"event",act:"list",lastid:t.lastid};return t.is_active&&(i.is_active=t.is_active),i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},getUserArticleList:function(t,e,a){var i={func:"article",act:"index",lastid:t.lastid_article};return i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},getArticleCategoryList:function(t,e,a){var i={func:"article",act:"tags"};return this.ajax(i,e,a)},createStoreArticle:function(t,e,a){var i={func:"article",act:"post",method:"post",category_id:t.category,title:t.title,msgbody:t.msgbody,fk_entityID:t.bizId,region_id:t.region};return t.id&&(i.id=t.id),i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},deleteCouponById:function(t,e,a){var i={func:"event",act:"del",id:t.id};return i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},changeStoreOpenStatus:function(t,e,a){var i={func:"biz",act:"closed",bizid:t.bizId,visible:t.status?1:-1};return i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},getStoreArticleDetail:function(t,e,a){var i={func:"article",act:"view",id:t.id};return i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},getCouponDetail:function(t,e,a){var i={func:"event",act:"view",id:t.id};return i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},login:function(t,e,a){var i={func:"passport",act:"login",method:"post",email:t.username,loginCode:md5(t.username+t.password+KG.config.MD5_KEY)};return this.ajax(i,e,a)},register:function(t,e,a){var i={func:"passport",act:"register",email:t.email,password:t.password,confirm_password:t.confirm_password,tou_accepted:1};return this.ajax(i,e,a)},checkLogin:function(t,e,a){var i={func:"passport",act:"checkToken",token:KG.user.get("token")};return this.ajax(i,e,a)},changePassword:function(t,e,a){var i={func:"passport",act:"password",userid:KG.user.get("userid"),password:t.password,old_password:t.old,pc:1};return i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},setUserPassword:function(t,e,a){var i={func:"password",act:"password",password:t.password};return i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},getStoreDetail:function(t,e,a){var i={func:"biz",act:"view",bizid:t.id};return i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},addFavForStore:function(t,e,a){var i={func:"biz",act:"add_bookmark",type:"biz",entityID:t.bizId};return i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},getStoreListByTag:function(t,e,a){var i={func:"view",act:"biz_list",tag:t.tag,subtag:t.subtag,subregion:t.subregion,page:t.page,publisher_type:t.publisher_type};return t.dy&&_.extend(i,t.dy),this.ajax(i,e,a)},getStoreCommentData:function(t,e,a){var i={func:"comment",act:"list",bizid:t.bizId,lastid:t.lastid,dataType:2};return t.has_pic&&(i.has_pic=1),this.ajax(i,e,a)},sendStoreComment:function(t,e,a){var i={func:"comment",act:"post",method:"post",bizid:t.bizId,msgbody:t.msg,dataType:2,dataID:t.bizId,star:t.star,biz_name:t.bizName,ownerID:t.ownerID,username:KG.user.get("nick")};return t.id&&(i.replyid=t.id,i.comment_userid=t.comment_userid,i.act="reply"),t.has_pic&&(i.has_pic="1"),i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},reportStoreComment:function(t,e,a){var i={func:"comment",act:"report",id:t.id,type:t.type,msgbody:t.msgbody||"",method:"post"};return i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},addLikeToStoreComment:function(t,e,a){var i={func:"comment",act:"buzz",id:t.id};return i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},getCouponListByTag:function(t,e,a){var i={func:"view",act:"event_list",tag:t.tag,subregion:t.subregion,lastid:t.lastid};return this.ajax(i,e,a)},getSiteHomePageData:function(t,e,a){var i={func:"view"};return this.ajax(i,e,a)},deleteStoreById:function(t,e,a){var i={func:"biz",act:"del",bizid:t.id};return i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},claimStoreById:function(t,e,a){var i={func:"biz",act:"claim_biz",bizid:t.id};return i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},searchStoreByKeyword:function(t,e,a){var i={func:"view",act:"biz_search",keyword:t.keyword,page:t.page||1};return this.ajax(i,e,a)},sendResetPasswordEmail:function(t,e,a){var i={func:"passport",act:"reset_password",email:t.email};return this.ajax(i,e,a)},resetPassword:function(t,e,a){var i={func:"passport",act:"modify_password",email:t.email,check_password:t.check,password:t.password};return this.ajax(i,e,a)},deleteStoreImage:function(t,e,a){var i={func:"biz",act:"delfile",fileid:t.fileid,bizid:t.bizId};return i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},getHotLocationRegion:function(t,e,a){var i={func:"passport",act:"get_region"};return this.ajax(i,e,a)},setHotLocationRegion:function(t,e,a){var i={func:"passport",act:"set_region",regionID:t.regionID};return this.ajax(i,e,a)},oauthLoginWithWeixinCode:function(t,e,a){var i={func:"passport",act:"mobile_login",login_type:"wechat",code:t.code};return this.ajax(i,e,a)},oauthLoginWithFacebook:function(t,e,a){var i={func:"passport",act:"mobile_login",login_type:"facebook",code:t.openID,email:t.email,nick:t.nick,image:t.image};return this.ajax(i,e,a)},uploadCouponImage:function(t,e,a){var i={func:"event",act:"upload",method:"post","uploadfield[]":t.image,eventID:t.id};return i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},deleteArticle:function(t,e,a){var i={func:"article",act:"del",id:t.id};return i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},pcRenZhengStore:function(t,e,a){var i={func:"biz",act:"verified",bizid:t.bizId,tel_tmp:t.tel};return i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},deleteCouponImage:function(t,e,a){var i={func:"event",act:"delfile",fileid:t.fileid,eventID:t.id};return i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},getAdsDetail:function(t,e,a){var i={func:"biz",act:"ads_view",postid:t.id};return t.bizinfo&&(i.bizinfo=1),i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},createAds:function(t,e,a){var i={func:"biz",method:"post",act:"ads_post",fk_entityID:t.bizId,fk_main_tag_id:t.tag,title:t.title,ad1:t.ad1,ad2:t.ad2,tel:t.tel,pic:t.logo,type:t.type,fk_region_id:t.region,share:encodeURIComponent(t.html)};return t.id&&(i.postid=t.id),i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},resubmitAds:function(t,e,a){var i={func:"biz",act:"ads_updatetime",postid:t.id};return i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},addUserEmailAndPassword:function(t,e,a){var i={func:"passport",act:"complete_mobile_login",email:t.email,password:t.password};return i=util.addUserIdToRequestData(i),this.ajax(i,e,a)},getCurrentRegionByIP:function(t,e,a){var i={func:"passport",act:"get_ip_region"};return this.ajax(i,e,a)},getRegionInfoByZipcode:function(t,e,a){var i={func:"biz",act:"get_region_by_zipcode",zipcode:t.zip};return this.ajax(i,e,a)}};
"use strict";!function(){KG.Class.define("BaseComponent",{_init:function(t,e,i){var n=this;this.box=t,this.config=i||{},this._initProp(),this.initStart(),this.getData(t,e,function(t){n.data=t,n.initVar(),n._initView(),n._initEvent(),n._initEnd(),n.doProcessPlaceholder()})},doProcessPlaceholder:function(){this.elem.find("input[placeholder]").add(this.elem.find("textarea[placeholder]")).each(function(){var t=$(this),e=t.attr("placeholder");t.focus(function(){var i=t.val();e=t.attr("placeholder")||e,i||t.removeAttr("placeholder")}).blur(function(){var i=t.val();i||t.attr("placeholder",e)})})},getTemplate:function(){},initVar:function(){},_initView:function(){this.initView(),this.html=template.compile(this.getTemplate())(this.data),this.elem=$(this.html),KG.component.init(this.elem),this.jq=util.extend(this.setJqVar(),this.callParent("setJqVar"))},setJqVar:function(){return{}},_initEvent:function(){this.initEvent(),util.message.register(this.__name,this.registerMessage.bind(this))},_initEnd:function(){this.elem.data("kg-obj",this);var t=this.box.attr("style"),e=this.box.attr("class"),i=this.box.attr("param");this.elem.attr("style",t),this.elem.addClass(e),this.elem.attr("param",i),this.box.replaceWith(this.elem),this.initEnd()},getData:function(t,e,i){i.call(this,{})},_initProp:function(){var t=util.extend(this.defineProperty(),this.callParent("defineProperty")),e={},i=this.box;util.each(t,function(t,n){t=t||{};var a=i.data(n);e[n]=util.isUndefined(a)?t.defaultValue:util.isFunction(t.getter)?t.getter(a):a}),this.prop=e},defineProperty:function(){return{}},initView:util.noop,initEnd:util.noop,initEvent:util.noop,registerMessage:util.noop,initStart:util.noop}),KG.Class.define("Header",{ParentClass:"BaseComponent",getTemplate:function(){var t=['<div class="dropdown-menu" aria-labelledby="js_right_dd_2">','<a style="border-bottom:1px dashed #ebebeb;" href="../mycount/info.html">'+(KG.user.get("nick")||KG.user.get("email"))+"</a>",'<a href="../myfav/list.html">我的收藏</a>','<a href="../mycoupon/list.html">我的领取</a>','<a href="../mysys/index.html">系统消息{{if user.system_msg}}({{user.system_msg}}){{/if}}</a>','<a href="../mycount/info.html">帐号设置</a>','<a class="js_logout" href="javascript:void(0)">退出登录</a>'].join("");return['<nav class="kg-header-comp" id="js_header_comp">','<div class="container">','<a class="logo" href="/"></a>','<div class="hw-loc js_loc" style="display: none;">',"<span></span>",'<i class="icon fa fa-caret-down"></i>',"</div>",'<div class="input-group search js_search">','<span class="input-group-addon hand js_tosearch"><i class="icon"></i></span>','<input type="text" class="form-control" data-placeholder="搜索本地店铺，专家服务…">',"</div>","{{if user.isLogin && user.has_biz}}",'<div class="right">','<div class="dropdown" style="margin-right: 40px;">','<button data-href="../mybiz/index.html" id="js_right_dd_1" type="button" data-toggle="dropdown" data-hover="dropdown" aria-haspopup="true" aria-expanded="false">','<img src="../../image/aa.png" />',"<span>店铺管理</span>","</button>",'<div class="dropdown-menu" aria-labelledby="js_right_dd_1">','<a href="../mybiz/index.html">我的店铺</a>','<a href="../mybiz/coupon.html">店铺优惠</a>','<a href="../mybiz/article.html">店铺文章</a>',"</div>","</div>",'<div class="dropdown">','<button data-href="../myfav/list.html" id="js_right_dd_2" class="c2" type="button" data-toggle="dropdown" data-hover="dropdown" aria-haspopup="true" aria-expanded="false">','<img src="{{user.image}}" />','{{if user.system_msg}}<span class="badge hw-badge">{{user.system_msg}}</span>{{/if}}',"<span>帐号管理</span>","</button>",t,"</div>","</div>","{{else if user.isLogin && !user.has_biz}}",'<div class="right">','<a style="float: left;margin-right: 20px;" class="hw-light-btn hw-btn" href="../site/landing.html">立即建店</a>','<div style="top:3px;" class="dropdown">','<button data-href="../myfav/list.html" id="js_right_dd_2" class="c2" type="button" data-toggle="dropdown" data-hover="dropdown" aria-haspopup="true" aria-expanded="false">','<img src="{{user.image}}" />','{{if user.system_msg}}<span class="badge hw-badge">{{user.system_msg}}</span>{{/if}}',"<span>帐号管理</span>","</button>",t,"</div>","</div>","{{else}}",'<div class="right">','<a class="hw-light-btn hw-btn" href="../site/landing.html">立即建店</a>','<a href="javascript:void(0)" class="hw-a js_login">登录</a>','<a href="javascript:void(0)" class="hw-a js_reg">注册</a>',"</div>","{{/if}}","</div>","</div>","</nav>"].join("")},getData:function(t,e,i){var n=KG.user.get();i({user:n})},initEvent:function(){this.data.user.isLogin?this.initEventByAfterLogin():this.initEventByBeforeLogin();var t=this.elem.find(".js_search");t.find("input").keyup(function(t){if(13!==t.keyCode)return!1;var e=$(this).val();return e?void(location.href="../site/search.html?keyword="+e):!1}),t.find(".js_tosearch").click(function(){var e=t.find("input").val();return e?void(location.href="../site/search.html?keyword="+e):(t.find("input").focus(),!1)}),this.elem.find(".js_loc").click(function(){util.dialog.showSelectLocationRegion()}),this.elem.find("button[data-href]").click(function(){var t=$(this).data("href");return location.href=t,!1})},initEventByAfterLogin:function(){this.elem.find(".js_logout").click(function(){KG.user.logout()})},initEventByBeforeLogin:function(){this.elem.find(".js_login").click(function(){util.dialog.showLoginBox()}),this.elem.find(".js_reg").click(function(){util.dialog.showRegBox()})},initEnd:function(){var t=KG.data.get("keyword");t&&this.elem.find(".js_search").find("input").val(t);var e=util.cookie.get("region_cn");e||(e="旧金山湾区"),this.elem.find(".js_loc").show().find("span").attr("title",e).html(e),this.elem.find('[data-hover="dropdown"]').dropdownHover(),this.elem.find("input[data-placeholder]").focus(function(){var t=$(this);t.val()&&t.val()!==t.data("placeholder")||t.removeClass("blur").val("")}).blur(function(){var t=$(this);t.val()||t.addClass("blur").val(t.data("placeholder"))}).blur()},getCurrentLocation:function(){var t=this.elem.find(".js_loc").find("span").html();return{name:t}}}),KG.Class.define("HeadingNav",{ParentClass:"BaseComponent",getTemplate:function(){return['<nav class="kg-header-nav-comp">','<div class="container">','<a href="../mybiz/index.html" class="nav js_mybiz">我的店铺</a>','<a href="../myfav/list.html" class="nav js_myfav">我的收藏</a>','<a href="../mycoupon/list.html" class="nav js_mycoupon">我的优惠</a>','<a href="../mysys/index.html" class="nav js_mysys">系统消息</a>','<a href="../mycount/info.html" class="nav js_mycount">账户</a>',"</div>","</nav>"].join("")},getData:function(t,e,i){var n=KG.data.get("page").split("-");n=n[0]||"",i({page:n})},initEnd:function(){var t=this.data.page;this.elem.find(".js_"+t).addClass("active")}}),KG.Class.define("HWSelectRegionLocation",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="hw-HWSelectRegionLocation">',"{{each list as item index}}",'<button param="{{index}}" class="js_one hw-btn hw-light-btn">{{item.cn}}</button>',"{{/each}}","</div>"].join("")},getData:function(t,e,i){KG.request.getHotLocationRegion({},function(t,e){var n=[];_.each(e,function(t,e){n.push({id:t.id,cn:t.area_name,name:e})});var a=util.cookie.get("region_IP_ID"),s=util.cookie.get("region_IP_ID_Name");a?(n.push({id:a,cn:"自动定位",name:s}),i({list:n})):KG.request.getCurrentRegionByIP({},function(t,e){util.cookie.set("region_IP_ID",e.pk_id),util.cookie.set("region_IP_ID_Name",e.name),n.push({id:e.pk_id,cn:"自动定位",name:e.name}),i({list:n})})})},initEvent:function(){var t=this;this.elem.on("click",".js_one",function(){var e=$(this),i=e.attr("param"),n=t.data.list[i];util.cookie.set("regionID",n.id),util.cookie.set("region_name",n.name),util.cookie.set("region_cn",n.cn),i>13&&util.cookie.set("region_cn",n.name),KG.request.setHotLocationRegion({regionID:n.id},function(t,e){location.reload()})})},initEnd:function(){var t=KG.component.getObj($("#js_header_comp")).getCurrentLocation().name,e=0;t&&(e=_.findIndex(this.data.list,function(e){return e.cn.toString()===t}),0>e&&(e=this.data.list.length-1)),this.elem.find(".js_one").eq(e).addClass("active")}}),KG.Class.define("HWBaseLoginAddPassword",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="hw-HWBaseLoginAddPassword">','<div class="hw-img"><img src="{{user.image}}"/></div>',"<p>{{user.email}}</p>","<h4>欢迎您！<br/>成为商家用户，请设置密码</h4>",'<div role="BaseInput" data-type="password" class="js_pwd" placeholder="密码（至少6个字符）"></div>','<button class="hw-btn hw-blue-btn js_btn">确定</button>',"</div>"].join("")},getData:function(t,e,i){var n=KG.user.get();i({user:n})},initEvent:function(){var t=this;this.elem.find(".js_btn").click(function(){var e=KG.component.getObj(t.elem.find(".js_pwd")),i=e.getValue();return i?util.validate.password(i)?(e.showError(),void KG.request.setUserPassword({password:i},function(t,e){t?(util.dialog.setHiddenDialogFn(null),util.toast.alert("设置成功")):alert(e)})):(e.showError("密码不能少于6位"),e.focus(),!1):(e.showError("请输入密码"),e.focus(),!1)})},initEnd:function(){util.dialog.setHiddenDialogFn(function(){location.href="../site/landing.html"})}}),KG.Class.define("HWBaseLoginAddEmailAndPassword",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="hw-HWBaseLoginAddPassword">','<div class="hw-img"><img src="{{user.image}}"/></div>',"<h4>欢迎您！<br/>成为商家用户，请绑定邮箱，设置密码</h4>",'<div role="BaseInput" class="js_email" placeholder="邮箱"></div>','<div role="BaseInput" data-type="password" class="js_pwd" placeholder="密码（至少6个字符）"></div>','<button class="hw-btn hw-blue-btn js_btn">确定</button>',"</div>"].join("")},getData:function(t,e,i){var n=KG.user.get();i({user:n})},initEvent:function(){var t=this;this.elem.find(".js_btn").click(function(){var e=KG.component.getObj(t.elem.find(".js_pwd")),i=e.getValue(),n=KG.component.getObj(t.elem.find(".js_email")),a=n.getValue(),s=KG.validate.email(a);return s[0]?(n.showError(),i?util.validate.password(i)?(e.showError(),void KG.request.addUserEmailAndPassword({email:a,password:i},function(t,e){t?(util.dialog.setHiddenDialogFn(null),util.toast.alert("设置成功")):alert(e)})):(e.showError("密码不能少于6位"),e.focus(),!1):(e.showError("请输入密码"),e.focus(),!1)):(n.showError(s[1]),n.focus(),!1)})},initEnd:function(){util.dialog.setHiddenDialogFn(function(){location.href="../site/landing.html"});var t=this,e=KG.component.getObj(t.elem.find(".js_email")),i=KG.component.getObj(t.elem.find(".js_pwd"));e.setBlurEvent(function(t){var e=KG.validate.email(t);e[0]?this.showError():this.showError(e[1])}),i.setBlurEvent(function(t){var e=KG.validate.password(t);e[0]?this.showError():this.showError(e[1])})}}),KG.Class.define("HWLoginRegBoxComp",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="hw-loginRegBoxComp">','<div class="c-tlt">','<h4><b>加入海外同城</b><b style="margin-left: 85px;">让生活更简单</b></h4>','<img src="../../image/haiwai1.png" />',"</div>",'<div class="c-left js_left">',"</div>",'<div class="c-right">',"<h4>用以下账号直接登录</h4>",'<a href="javascript:void(0)" class="hw-btn hw-weixin"><i class="icon"></i>微信扫一扫登录</a>','<a href="javascript:void(0)" data-loading-text="正在登录..." class="hw-btn hw-fb"><i class="icon"></i>facebook登录</a>',"</div>",'<div class="c-btm">',"</div>","</div>"].join("")},setJqVar:function(){return{tlt:this.elem.find(".c-tlt h4 b"),left:this.elem.find(".js_left"),btm:this.elem.find(".c-btm")}},setLoginBox:function(){this.jq.tlt.hide();var t=["<h4>登录海外同城</h4>",'<div class="c-error"></div>','<div role="BaseInput" data-type="text" class="js_email" placeholder="邮箱" ></div>','<div role="BaseInput" data-type="password" class="js_pwd" placeholder="密码（至少6个字符）" ></div>','<button class="hw-btn hw-blue-btn js_loginBtn">登录</button>','<p>忘记账号或密码？<a href="../mycount/forgetpassword.html">在这里找回</a></p>'].join("");this.jq.left.html(t);var e=['<p>还没有海外帐户？<a class="hw-btn js_toReg">注册</a></p>'].join("");this.jq.btm.html(e),this.initLoginBox()},initLoginBox:function(){var t=this;KG.component.init(this.jq.left);var e={email:KG.component.getObj(this.jq.left.find(".js_email")),pwd:KG.component.getObj(this.jq.left.find(".js_pwd"))};e.email.setBlurEvent(function(t){t?util.validate.email(t)?this.showError():this.showError(util["const"].InputEmailFormatError):this.showError(util["const"].InputEmail)}),e.pwd.setBlurEvent(function(t){t?this.showError():this.showError(util["const"].InputPassword)}),e.email.setEnterEvent(function(){t.elem.find(".js_loginBtn").trigger("click")}),e.pwd.setEnterEvent(function(){t.elem.find(".js_loginBtn").trigger("click")})},setRegBox:function(){var t=['<div class="c-error"></div>','<div role="BaseInput" data-type="text" class="js_email" placeholder="邮箱" ></div>','<div role="BaseInput" data-type="password" class="js_pwd" placeholder="密码（至少6个字符）" ></div>','<div role="BaseInput" data-type="password" class="js_pwd2" placeholder="确认密码" ></div>','<button class="hw-btn hw-blue-btn js_regBtn">注册</button>','<p>点击注册表示您同意海外同城的<a target="_blank" href="../help/terms.html">使用协议</a>和<a target="_blank" href="../help/privacy.html">隐私保护协议</a></p>'].join("");this.jq.left.html(t),this.jq.tlt.show();var e=['<h6>已有海外帐户？<a href="javascript:void(0)" class="js_toLogin">直接登录</a></h6>'].join("");this.jq.btm.html(e),this.initRegBox()},initRegBox:function(){var t=this;KG.component.init(this.jq.left);var e=this.getRegisterObj();e.email.setBlurEvent(function(t){var e=KG.validate.email(t);e[0]?this.showError():this.showError(e[1])}),e.pwd.setBlurEvent(function(t){var e=KG.validate.password(t);e[0]?this.showError():this.showError(e[1])}),e.pwd2.setBlurEvent(function(t){t!==e.pwd.getValue()?this.showError(util["const"].PasswordNotEqual):this.showError()}),e.email.setEnterEvent(function(){t.elem.find(".js_regBtn").trigger("click")}),e.pwd.setEnterEvent(function(){t.elem.find(".js_regBtn").trigger("click")}),e.pwd2.setEnterEvent(function(){t.elem.find(".js_regBtn").trigger("click")})},defineProperty:function(){return{type:{defaultValue:"reg"}}},initEvent:function(){var t=this;this.elem.on("click",".js_toReg",this.setRegBox.bind(this)),this.elem.on("click",".js_toLogin",this.setLoginBox.bind(this)),this.elem.on("click",".js_regBtn",function(){var e=$(this),i=t.getRegisterObj(),n=t.getRegisterValue(),a=KG.validate.email(n.email);if(!a[0])return i.email.showError(a[1]),i.email.focus(),!1;i.email.showError();var s=KG.validate.password(n.password);return s[0]?(i.pwd.showError(),n.password!==n.confirm_password?(i.pwd2.showError(util["const"].PasswordNotEqual),i.pwd2.focus(),!1):(i.pwd2.focus(),console.log(n),util.dom.loadingButton(e,!0),void KG.user.register(n,function(i,a){if(i){var s={username:n.email,password:n.password};KG.user.login(s,function(){util.dom.loadingButton(e,!1),location.reload()},function(t){util.dom.loadingButton(e,!1),util.toast.showError(t)})}else util.dom.loadingButton(e,!1),t.showError(a)}))):(i.pwd.showError(s[1]),i.pwd.focus(),!1)}),this.elem.on("click",".js_loginBtn",function(){var e=$(this),i=t.getLoginObj(),n=t.getLoginValue(),a=KG.validate.email(n.username);if(!a[0])return i.email.showError(a[1]),i.email.focus(),!1;i.email.showError();var s=KG.validate.password(n.password);return s[0]?(i.pwd.showError(),util.dom.loadingButton(e,!0),void KG.user.login(n,function(){util.dom.loadingButton(e,!1),location.reload()},function(i){util.dom.loadingButton(e,!1),t.showError(i)})):(i.pwd.showError(s[1]),i.pwd.focus(),!1)}),this.elem.on("click",".hw-weixin",function(){return util.dialog.showWeixinLoginQrCode(location.href),!1}),this.elem.on("click",".hw-fb",function(){var t=$(this);t.button("loading"),util.Facebook.login(function(e,i){e?KG.user.getUserDetailWithToken(i,function(){location.reload(),t.button("reset"),util.dialog.hide()}):(t.button("reset"),util.toast.showError(i))})})},showError:function(t){var e=null;e=-1!==t.indexOf("密码")?KG.component.getObj(this.jq.left.find(".js_pwd")):KG.component.getObj(this.jq.left.find(".js_email")),e.showError(t)},getLoginObj:function(){var t={email:KG.component.getObj(this.jq.left.find(".js_email")),pwd:KG.component.getObj(this.jq.left.find(".js_pwd"))};return t},getLoginValue:function(){var t=this.getLoginObj(),e={username:t.email.getValue(),password:t.pwd.getValue()};return e},getRegisterObj:function(){return{email:KG.component.getObj(this.jq.left.find(".js_email")),pwd:KG.component.getObj(this.jq.left.find(".js_pwd")),pwd2:KG.component.getObj(this.jq.left.find(".js_pwd2"))}},getRegisterValue:function(){var t=this.getRegisterObj();return{email:t.email.getValue(),password:t.pwd.getValue(),confirm_password:t.pwd2.getValue()}},initEnd:function(){"login"===this.prop.type?this.setLoginBox():"reg"===this.prop.type&&this.setRegBox()}})}(),KG.component={initEach:function(t,e,i){i=i||{},new(KG.Class.getByName(t))(e,i)},init:function(t){t=t||$("body");var e=t.find("[role]");e.each(function(){var t=$(this);if(!t.attr("init-end")&&!t.attr("init-self")){var e=t.attr("role");KG.component.initEach(e,t,{})}})},initWithElement:function(t,e,i){var n=t.attr("role");if(n)return new(KG.Class.getByName(n))(t,e,i)},getObj:function(t){var e=t.data("kg-obj");return e||null}},$(function(){return util.url.param("code")&&"aaa"===util.url.param("state")?(util.showPageLoading(!0),KG.request.oauthLoginWithWeixinCode({code:util.url.param("code")},function(t,e){util.showPageLoading(!1),t?KG.user.getUserDetailWithToken(e,function(t){return location.href=location.href.replace("code="+util.url.param("code"),"").replace("&state=aaa",""),!1}):(util.toast.showError(e),util.delay(function(){location.href="../site/index.html"},2e3))}),!1):(util.showPageLoading(!0),void KG.user.checkLogin(function(){var t=KG.user.get();if(KG.data.get("needLogin"))if(t.isLogin)KG.component.init();else{var e="../site/index.html";KG.data.get("needLoginToUrl")&&(e=KG.data.get("needLoginToUrl")),location.href=e}else KG.component.init();util.showPageLoading(!1)}))});
KG.Class.define("BaseForm",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="container hw-comp-bform">',this.getInsideTemplate(),"</div>"].join("")},getInsideTemplate:function(){}}),KG.Class.define("BaseInput",{ParentClass:"BaseComponent",defineProperty:function(){return{value:{defaultValue:""},label:{},require:{},type:{defaultValue:"text"},delbtn:{},format:{}}},getTemplate:function(){return['<div class="form-group hw-comp-BaseInput">','<label class="lab {{if require}}require{{/if}}" for="{{uuid}}">{{label}}</label>','<label class="control-label hw-err"></label>','<input type="{{type}}" class="form-control" id="{{uuid}}" placeholder="{{placeholder}}">',"</div>"].join("")},getData:function(e,t,i){var n=this.prop;i({value:n.value,label:n.label,require:n.require,type:n.type,placeholder:e.attr("placeholder")||"",uuid:"lb_"+util.getUuid()})},initEvent:function(){var e=this;if(this.prop.delbtn){var t=this.elem.find("input");t.after('<i class="fa del fa-times-circle" style="display: none;"></i>'),this.jq.delBtn=this.elem.find(".del"),this.jq.delBtn.click(function(){t.val(""),e.checkDeleteIcon(),t.focus()}),t.bind("keyup",this.checkDeleteIcon.bind(this)),t.bind("paste",this.checkDeleteIcon.bind(this))}"phone"===this.prop.format&&this.elem.find("input").bind("keydown",function(t){var i=e.getValue();if(!_.contains([8,9],t.keyCode)){if(t.keyCode<48||t.keyCode>57)return!1;if(i.length>9)return!1}})},setBlurEvent:function(e){var t=this;this.elem.find("input").blur(function(){var i=t.getValue();e.call(t,i)})},setEnterEvent:function(e){this.elem.find("input").keyup(function(t){13===t.keyCode&&e()})},initEnd:function(){this.prop.value&&this.elem.find("input").val(this.prop.value)},checkDeleteIcon:function(){var e=this.elem.find("input").val();e?this.jq.delBtn.show():this.jq.delBtn.hide()},focus:function(){this.elem.find("input").focus()},getValue:function(){var e=this.elem.find("input");return e.val()},setValue:function(e){this.elem.find("input").val(e)},showError:function(e){e?(this.elem.addClass("has-error"),this.elem.find(".hw-err").html(e)):(this.elem.removeClass("has-error"),this.elem.find(".hw-err").html(""))},reset:function(){this.elem.find("input").val(""),this.showError(!1)}}),KG.Class.define("BaseUploadImage",{ParentClass:"BaseComponent",setJqVar:function(){return{img:this.elem.find(".js_img"),btn:this.elem.find(".js_btn"),fileInput:this.elem.find('input[type="file"]')}},defineProperty:function(){return{image:{}}},initEvent:function(){var e=this.jq.btn,t=(this.jq.img,this);this.jq.fileInput.bind("change",function(i){var n=this.files[0];e.button("loading"),t.uploadImageFn(n,function(){e.button("reset")})})},uploadImageFn:function(e,t){var i=this;util.uploadImage(e,function(e){var e=KG.config.SiteRoot+e;i.jq.img.attr("src",e),t()})}}),KG.Class.define("StarRank",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="hw-comp-star">',"</div>"].join("")},initStart:function(){this.rank=0,this.enableClick=!1},getData:function(e,t,i){this.rank=parseFloat(e.data("rank"))||0,e.data("enable")&&(this.enableClick=!0),i({})},render:function(){for(var e=this.rank,t=[],i=1;6>i;i++)e>i?t.push("full"):i===e?t.push("full"):i===e+.5?t.push("half"):t.push("empty");var n=["{{each list as item index}}",'{{if item==="full"}}','<i index="{{index}}" class="icon fa fa-star icon_full"></i>','{{else if item==="half"}}','<i index="{{index}}" class="icon fa fa-star-half-o icon_half"></i>',"{{else}}",'<i index="{{index}}" class="icon fa fa-star-o icon_empty"></i>',"{{/if}}","{{/each}}"].join("");n=template.compile(n)({list:t}),this.elem.html(n)},setValue:function(e){this.rank=e,this.render()},getValue:function(){return this.rank},initEnd:function(){this.render()},initEvent:function(){var e=this;this.enableClick&&this.elem.on("click","i.fa",function(t){var i=$(t.target),n=i.attr("index");i.hasClass("icon_empty")?e.rank=parseFloat(n)+1:i.hasClass("icon_full")&&(e.rank=parseInt(n,10)),0===e.rank&&(e.rank=1),e.render()}).addClass("hand")}}),KG.Class.define("BaseSelectInput",{ParentClass:"BaseInput",getTemplate:function(){return['<div class="form-group hw-comp-BaseSelectInput">','<label class="lab {{if require}}require{{/if}}">{{label}}</label>','<label class="control-label hw-err"></label>','<div class="dropdown hw-drop">','<button id="{{uuid}}" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">','<input type="text" readonly="true" class="form-control js_input" placeholder="{{placeholder}}">','<i class="icon fa fa-caret-down"></i>',"</button>",'<ul class="dropdown-menu" aria-labelledby="{{uuid}}">',"{{each list as item}}",'<li index="{{$index}}" class="js_drop">',this.getEachHtml(),"</li>","{{/each}}","</ul>","</div>","</div>"].join("")},initVar:function(){this.index=-1},getData:function(e,t,i){this.clickCallback=t.clickCallback,this.getEachHtml=t.getEachHtml||function(){return"{{item}}"};var n=this.prop;i({value:n.value,label:n.label,require:n.require,placeholder:e.attr("placeholder")||"",uuid:"dl_"+util.getUuid(),list:t.list})},initEvent:function(){var e=this,t=this.elem.find(".js_input");this.elem.find(".js_drop").click(function(){t.val($(this).text());var i=$(this).attr("index");e.index=i,e.clickCallback(e.data.list[i])})},initEnd:function(){},getValue:function(){return this.index<0?{}:this.data.list[this.index]},setValue:function(e){this.elem.find(".js_drop").filter('[index="'+e+'"]').trigger("click")},setOnlyValue:function(e){this.elem.find(".js_input").val(e)},disable:function(e){e=e||!1,e?(this.elem.find("button").attr("disabled",e),this.elem.find(".js_input").attr("disabled",e)):(this.elem.find("button").removeAttr("disabled"),this.elem.find(".js_input").removeAttr("disabled"))}}),KG.Class.define("BaseLoadingImageBox",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="hw-comp-BaseLoadingImageBox hw-center-image">','<i class="icon icon-loading"></i>',"</div>"].join("")},defineProperty:function(){return{url:{}}},initEnd:function(){var e=this.prop.url;console.log(e),e?this.setUrl(e):this.elem.html("")},setUrl:function(e){var t=this,i=new Image;i.src=e,console.log(e),this.elem.html('<i class="icon icon-loading"></i>'),$(i).load(function(i){var n=$(this);t.renderImage(n[0],e)})},renderImage:function(e,t){var i,n,a="position:absolute;",l="width",s=this.elem.width(),o=this.elem.height();e.width/e.height>=s/o?(i=Math.ceil(e.width*o/e.height),a+="width:"+i+"px;height:100%;top:0;left:"+(s-i)/2+"px"):(a+="width:100%;height:auto;left:0;top:0;",l="height"),this.elem.empty();var n='<img style="'+a+'" src="'+t+'" />';this.elem.html(n)}}),KG.Class.define("BaseLoadingMoreStatusBar",{ParentClass:"BaseComponent",getTemplate:function(){return['<nav class="hw-comp-BaseLoadingMoreStatusBar">','<i class="loading" style="display: none;"></i>','<b class="js_more">加载更多</b>',"</nav>"].join("")},setJqVar:function(){return{loading:this.elem.find(".loading"),b:this.elem.find(".js_more")}},setState:function(e){"loading"===e?(this.jq.loading.show(),this.jq.b.hide()):"loaded"===e?(this.jq.loading.hide(),this.jq.b.show()):"hide"===e&&this.elem.hide()},setEvent:function(e){var t=this;this.jq.b.unbind("click").bind("click",function(i){t.setState("loading"),e(function(){t.setState("loaded")},t)})},trigger:function(){this.jq.b.trigger("click")}}),KG.Class.define("HWNoContentDiv",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="hw-HWNoContentDiv hw-center-image">','<p class="hw-text">{{text}}<p>',"</div>"].join("")},defineProperty:function(){return{text:{}}},getData:function(e,t,i){i({text:this.prop.text})}}),KG.Class.define("HWBaseGoogleAdIFrame",{ParentClass:"BaseComponent",getTemplate:function(){return'<div style="text-align:center;"><iframe style="border:0;width:100%;height:100%;"></iframe></div>'},defineProperty:function(){return{id:{}}},getAdUrl:function(){var e=this.prop.id;document.MAX_ct0="";var t="https:"==location.protocol?"https://cas.criteo.com/delivery/ajs.php?":"http://cas.criteo.com/delivery/ajs.php?",i=Math.floor(99999999999*Math.random()),n=t+"zoneid="+e+"&nodis=1&cb="+i;","!=document.MAX_used&&(n+="&exclude="+document.MAX_used);var a=document.charset?"&charset="+document.charset:document.characterSet?"&charset="+document.characterSet:"";return n+=a,a="&loc="+escape(window.location).substring(0,1600),n+=a,document.context&&(a="&context="+escape(document.context)),n+=a,"undefined"!=typeof document.MAX_ct0&&"http"==document.MAX_ct0.substring(0,4)&&(a="&ct0="+escape(document.MAX_ct0),n+=a),document.mmm_fo&&(a="&amp;mmm_fo=1",n+=a),n},initEnd:function(){var e=this,t=this.elem.find("iframe");_.delay(function(){var i=t[0];i=i.contentWindow?i.contentWindow:i.contentDocument.document?i.contentDocument.document:i.contentDocument;var n=e.getAdUrl();console.log(n),i.document.open(),i.document.write("<style>*{margin:0;padding:0;}</style>"),i.document.write('<script src="'+n+'"></script>'),i.document.close()},100)}});
KG.Class.define("SiteHeadingNav",{ParentClass:"BaseComponent",getTemplate:function(){return['<nav class="kg-header-nav-comp kg-site-header-nav-comp">','<div class="container">','<a href="javascript:void(0)" class="nav js_tab">本地商家<i class="icon glyphicon glyphicon-chevron-down"></i>',"</a>",'<a href="../site/couponlist.html" class="nav js_couponList">本地优惠</a>','<a href="../site/articlelist.html?category=hot" class="nav js_articleList">生活指南</a>','<div class="hw-box container">','<div class="left nodis"></div>',"</div>","</div>","</nav>"].join("")},defineProperty:function(){return{leftshow:{defaultValue:!1}}},initStart:function(){this.navData=[{logo:"food.png",title:[["餐饮美食",131]],children:[[["中国菜",131,135],["川菜",131,142],["粤菜",131,140],["火锅",131,148],["湘菜",131,150],["上海菜",131,138],["港式茶餐厅",131,141],["台湾菜",131,137]],[["日本料理",131,159],["韩国菜",131,166],["泰国菜",131,161],["越南菜",131,162],["西餐厅",131,165],["意大利菜",131,157],["法国菜",131,168]],[["奶茶店",131,181],["咖啡厅",131,188],["冰品店",131,182],["面包/蛋糕店",131,178]]]},{logo:"sat.png",title:[["教育、",214],["托儿、",226],["培训",245]],children:[[["课后辅导",214,214],["SAT",214,215],["数学",214,549],["英语",214,216],["中文学校",214,217],["钢琴",214,219],["小提琴",214,220],["其它乐器",214,221],["游泳",214,225],["武术",214,224],["艺术/绘画",214,223],["舞蹈",214,222],["教育咨询",214,610]],[["幼儿园",226,226],["托儿所",226,547],["双语幼儿园",226,609],["蒙特梭利教育",226,607]],[["职业培训",245,245],["电脑/IT",245,234],["地产执照",245,233],["社区大学",245,229],["驾驶学校",245,247]]]},{logo:"cleaner.png",title:[["家装、",41],["清洁、",459],["搬家",450]],children:[[["装修",41,41],["厨卫装修",41,36],["橱柜",41,37],["地毯地板",41,38],["门窗",41,50],["屋顶",41,55],["通渠",41,47],["电工",41,48],["空调/暖气",41,49]],[["清洁服务",459,459],["地毯清洗",459,212]],[["搬家公司",450,450]]]},{logo:"car.png",title:[["汽车经销、",67],["维修",195]],children:[[["汽车经销",67,67],["宝马",67,75],["奔驰",67,98],["奥迪",67,73],["雷克萨斯",67,93],["讴歌",67,71],["丰田",67,107],["本田",67,85],["大众",67,108]],[["汽车维修",195,195],["板金/喷漆",195,190],["传动器",195,200],["轮胎",195,191],["汽车玻璃",195,199]]]},{logo:"lawer.png",title:[["理财、",369],["保险、",383],["律师",391]],children:[[["理财",369,369],["会计师/会计服务",369,366],["报税服务",369,368],["财务规划",369,367],["教育基金",369,252]],[["保险",383,383],["医疗保险",383,384],["汽车保险",383,385],["房屋保险",383,386],["人寿保险",383,387]],[["律师",391,391],["人体伤害诉讼",391,392],["家事法",391,393],["刑事法",391,394],["酒后驾车处理",391,395],["移民法",391,396],["民事法",391,397],["商业法",391,398],["专利/商标法",391,399],["遗产法",391,404],["房地产法",391,405],["资产规划",391,613]]]},{logo:"loan.png",title:[["房产经纪、",27],["贷款",27,375]],children:[[["房产经纪",27,0],["贷款服务",27,375],["房地产估价",27,33],["地产管理",27,62]]]},{logo:"doctor.png",title:[["中医、",294],["牙医、",345],["家庭医生",297]],children:[[["中医",294,294],["针灸",294,295],["推拿",294,296],["中药参茸行",294,357]],[["牙科医生",345,345],["儿童牙科",345,346],["牙齿矫正",345,347],["人工植牙",345,348],["假牙修复",345,349],["根管治疗",345,351],["牙周病治疗",345,352]],[["家庭医生",297,297],["小儿科",297,298],["妇产科",297,301],["内科",297,305],["皮肤科",297,313],["整形外科",297,333]]]},{logo:"relax.png",title:[["美容休闲、",533],["旅游",479]],children:[[["美容休闲",533,533],["美发",533,531],["美甲",533,532],["医学美容",533,334],["足疗/脚底按摩",533,344],["KTV",533,498]],[["旅游",479,479],["旅行社",479,0],["机场接送",479,203],["旅游包车",479,204]]]},{logo:"store.png",title:[["个体微店",643]],children:[[["私家美食",643,645],["服装饰品",643,650],["生活用品",643,648],["其他",643,651]]]}]},getData:function(t,e,i){var n=KG.data.get("page").split("-");n=n[1]||"",i({page:n})},setJqVar:function(){return{box:this.elem.find(".hw-box"),left:this.elem.find(".hw-box .left")}},initEvent:function(){var t=this,e=this.jq.left,i=null;this.prop.leftshow?(e.removeClass("nodis"),this.elem.find(".js_tab").add(e).hover(function(){},function(){t.isOn=!1,t.removeAll&&t.removeAll()})):(this.elem.find(".js_tab").hover(function(){i&&window.clearTimeout(i),i=window.setTimeout(function(){e.show()},300)},function(){i&&window.clearTimeout(i),e.hide(),t.isOn=!1,t.removeAll&&t.removeAll()}),e.hover(function(){i&&window.clearTimeout(i),e.show()},function(){i&&window.clearTimeout(i),e.hide(),t.isOn=!1,t.removeAll&&t.removeAll()}))},initVar:function(){this.isOn=!1},initEnd:function(){this.setLeftBox();var t=this.data.page;this.elem.find(".js_"+t).addClass("active"),this.prop.leftshow&&this.elem.find(".js_tab").addClass("active")},setLeftBox:function(){function t(t){i(),t.addClass("hover");var e=t.next(".hw-item");1===e.length&&e.addClass("second");var s=t.find(".right");n.isOn?s.show():s.fadeIn(),n.isOn=!0}function e(t){t.removeClass("hover");var e=t.next(".hw-item");1===e.length&&e.removeClass("second");var i=t.find(".right");i.hide()}function i(){a&&window.clearTimeout(a),n.jq.left.find(".hw-item").each(function(){e($(this))})}var n=this,s="";_.each(this.navData,function(t,e){var i=['<div class="hw-item">','<div class="hw-one">','<img class="img-'+e+'" src="../../image/site/'+t.logo+'" />','<p class="cp">',"{{each list as item}}","{{if item[2]}}",'<a href="../site/storelist.html?tag={{item[1]}}&subtag={{item[2]}}">{{item[0]}}</a>',"{{else}}",'<a href="../site/storelist.html?tag={{item[1]}}">{{item[0]}}</a>',"{{/if}}","{{/each}}","</p>","</div>",n.getRightBoxHtml(t.children),"</div>"].join("");i=template.compile(i)({list:t.title}),s+=i}),this.jq.left.html(s);var a=(this.jq.left.find(".hw-item .right"),null);n.removeAll=i,this.jq.left.find(".hw-item").hover(function(){var e=$(this);a&&window.clearTimeout(a),a=window.setTimeout(function(){t(e)},300)},function(){})},getRightBoxHtml:function(t){if(t=t||[],t.length<1)return"";var e='<div class="right nodis">';return _.each(t,function(t){e+="<dl>";var i="",n="";_.each(t,function(t){var e="cb",s="../site/storelist.html?tag="+t[1];t[2]===t[1]?(e="ca",i+='<a class="'+e+'" href="'+s+'" target="_self">'+t[0]+"</a>"):0===t[2]?n+='<a class="'+e+'" href="'+s+'" target="_self">'+t[0]+"</a>":(s+="&subtag="+t[2],n+='<a class="'+e+'" href="'+s+'" target="_self">'+t[0]+"</a>")}),i?(e+="<dt>"+i+"</dt>",e+='<dd style="width:470px;">'+n+"</dd>"):e+="<dd>"+n+"</dd>",e+="</dl>"}),e+="</div>"}}),KG.Class.define("HWSiteCouponDetailComp",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="hw-HWSiteCouponDetailComp">','<div class="ca js_sbox nodis">',"</div>",'<div class="cb js_box nodis"></div>','<div class="cc js_acbox nodis"></div>','<div class="js_loading" style="display: none;">Loading ...</div>',"</div>"].join("")},defineProperty:function(){return{coupon:{}}},loading:function(t){var e=this.elem.find(".js_loading");t?e.css({"text-align":"center","font-size":"17px"}).show():e.hide()},getData:function(t,e,i){this.id=this.prop.coupon,this.couponData={},i({})},initEnd:function(){var t=this;this.loading(!0),KG.request.getCouponDetail({id:this.id},function(e,i){e&&(console.log(i),t.couponData=i,t.loading(!1),t.setStoreBoxHtml(i),t.setCouponBoxHtml(i),t.setActionBoxHtml(i))})},setJqVar:function(){return{storeBox:this.elem.find(".js_sbox"),box:this.elem.find(".js_box"),actionBox:this.elem.find(".js_acbox")}},setStoreBoxHtml:function(t){if(!t.bizinfo.entityID)return void this.jq.storeBox.hide();var e=['<a class="" href="{{biz.entityID | toStorePath}}">','<img src="{{biz.logo[0].path | absImage}}" />','<div class="h4">{{biz.name_cn || biz.name_en}}</div>',"<p>{{biz | storeFullAddress}}</p>","</a>"].join("");e=template.compile(e)({biz:t.bizinfo}),this.jq.storeBox.html(e).show()},setCouponBoxHtml:function(t){var e=["<h4>{{data.subject}}</h4>","{{#dyHtml}}","<label>活动详情</label>","<p>{{#data.description | decode}}</p>","{{if data.files}}","{{each data.files as img}}",'<div class="hw-img"><img src="{{img.path | absImage}}" /></div>',"{{/each}}","{{/if}}"].join(""),i="";_.each(t.dynamic_field||[],function(t){i+="<label>"+t.field_name+"</label><p>"+t.value+"</p>"}),console.log(!t.top_start_time||parseInt(t.top_start_time)<1||!t.top_end_time||parseInt(t.top_end_time)<1||-1!==t.top_end_time.indexOf("unlimit")),i+=!t.top_start_time||parseInt(t.top_start_time)<1||!t.top_end_time||parseInt(t.top_end_time)<1||-1!==t.top_end_time.indexOf("unlimit")?"<label>活动时间</label><p>不限时间</p>":"<label>活动时间</label><p>"+moment.unix(t.top_start_time).utc().format("MM/DD/YYYY")+" &nbsp;&nbsp;到&nbsp;&nbsp; "+moment.unix(t.top_end_time).utc().format("MM/DD/YYYY")+"</p>",e=template.compile(e)({data:t,dyHtml:template.compile(i)({data:t})}),this.jq.box.html(e),this.jq.box.removeClass("nodis"),t.bizinfo.entityID&&this.jq.box.css({"margin-top":"60px"})},setActionBoxHtml:function(t){var e=['<p style="margin:0;font-size;14px;color:#7d7d7d;">输入手机号，我们会将优惠发至您的手机，兑现时请出示该条优惠短信。</p>','<div style="width:400px;margin: 0 auto;" data-format="phone" class="js_tel" role="BaseInput" placeholder="请输入北美10位电话号码 例: 5101234567"></div>','<button class="hw-btn hw-blue-btn js_getCoupon">领取优惠</button>'].join("");e=template.compile(e)({data:t}),this.jq.actionBox.html(e).removeClass("nodis"),KG.component.init(this.jq.actionBox)},initEvent:function(){var t=this;this.elem.on("click",".js_getCoupon",function(){var e=KG.component.getObj(t.elem.find(".js_tel")),i=e.getValue();return i&&util.validate.AmericanPhone(i)?(e.showError(),void KG.request.sendSmsToUserPhone({number:i,biz_name:t.couponData.bizinfo.name_cn||t.couponData.bizinfo.name_en,event_title:t.couponData.subject,id:t.couponData.pk_id},function(t,e){t?util.toast.alert("短信已成功发送至 "+i,"出示短信内容给商家，就可以享受优惠！"):util.toast.showError(e)})):(e.showError("电话格式不正确"),void e.focus())})}}),KG.Class.define("HWBaseAdsBanner",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="hw-HWBaseAdsBanner">','<div class="hw-border"></div>','<div class="cb">','<a href="../site/landing.html" class="hw-btn hw-blue-btn">商家免费入驻</a>',"</div>",'<div class="cc">','<p class="pb1">建店就送30天</p>','<p class="pb1 pb2"><a class="pb1 pb2" href="'+KG.config.Wenxuecity_Ads_Url+'" target="_blank">文学城首页</a>广告</p>','<img src="../../image/adsprofile.png" />','<p class="pb">1. 免费创建店铺<br/>2. 选择广告模板，3分钟自制广告<br/>3. 广告发布到文学城首页30天</p>',"</div>","</div>"].join("")}}),KG.Class.define("HWBaseAdsBanner1",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="hw-HWBaseAdsBanner hw-HWBaseAdsBanner1">','<div class="hw-border"></div>','<div class="cb">','<a href="../site/landing.html" class="hw-btn hw-blue-btn">商家免费入驻</a>',"</div>",'<div class="cc">','<p class="h4">赠送文学城首页广告30天</p>','<img src="../../image/adsprofile.png" />',"</div>","</div>"].join("")}});
"use strict";KG.Class.define("MybizArticleForm",{ParentClass:"BaseForm",getInsideTemplate:function(){return["{{if pageTitle}}<h3>{{pageTitle}}<h3>{{/if}}",'<div placeholder="请选择店铺" class="js_biz" data-label="将文章发布到" data-require="true" role="BaseSelectInput" init-self="true"></div>','<div class="js_title" role="BaseInput" data-label="文章标题" data-require="true" placeholder="e.g. 海底捞成功的秘密"></div>','<div class="form-group">','<label class="require" for="lb_ccc">文章正文</label>','<label class="control-label hw-err"></label>','<textarea class="form-control" id="lb_ccc"></textarea>','<input style="display: none;" type="file" class="js_file" />',"</div>",'{{if type==="edit"}}<b class="hw-delete js_del">删除这篇文章</b>{{/if}}','<a href="javascript:void(0)" class="js_btn hw-btn hw-blue-btn">{{btnText}}</a>'].join("")},defineProperty:function(){return{title:{defaultValue:""},type:{defaultValue:"create"}}},getData:function(t,e,i){var a=this.prop.title,r=this.prop.type,n=KG.data.get("id"),s=function(){return KG.request.getBizList({})},l=[s];"edit"===r&&l.push(function(){return KG.request.getStoreArticleDetail({id:n})}),KG.request.defer(l,function(t,e){i({id:n,pageTitle:a,bizList:_.isArray(t)?t:[],articleData:e?e.view:{},type:r,btnText:"edit"===r?"保存":"发表"})})},initVar:function(){this.biz=null,this.cat=30},validate:function(t){var e=this.getElemObj();return t.bizId?(e.biz.showError(),t.title?(e.title.showError(),t.msgbody?($(this.ck.element.$).parent("div.form-group").removeClass("has-error").find(".hw-err").html(""),!0):($(this.ck.element.$).parent("div.form-group").addClass("has-error").find(".hw-err").html("请输入文章正文"),!1)):(e.title.showError("请输入文章标题"),e.title.focus(),!1)):(e.biz.showError("请选择要发布的店铺"),e.biz.focus(),!1)},initBlurEvent:function(){var t=this.getElemObj();t.title.setBlurEvent(function(e){e?this.showError():t.title.showError("请输入文章标题")})},initEvent:function(){var t=this;this.elem.find(".js_btn").click(function(){var e=$(this),i=t.getFormValue();return t.validate(i)?void("edit"===t.prop.type?(i.id=t.data.id,util.dom.loadingButton(e,!0),KG.request.createStoreArticle(i,function(t,i){util.dom.loadingButton(e,!1),t&&(console.log(i),util.toast.alert("修改成功"),util.delay(function(){location.href="article.html"},2e3))})):(util.dom.loadingButton(e,!0),KG.request.createStoreArticle(i,function(t,i){t&&(util.dom.loadingButton(e,!1),console.log(i),util.toast.alert("发表成功"),util.delay(function(){location.href="article.html"},2e3))}))):!1}),"edit"===this.prop.type&&this.elem.find(".js_del").click(function(){util.dialog.confirm1({msg:"确认要删除这篇文章么？",YesFn:function(){KG.request.deleteArticle({id:t.data.id},function(t,e){t?location.href="../mybiz/article.html":util.toast.showError(e)})}})}),this.initBlurEvent()},getElemObj:function(){return{biz:KG.component.getObj(this.elem.find(".js_biz")),title:KG.component.getObj(this.elem.find(".js_title"))}},getFormValue:function(){var t=this.getElemObj();return{category:this.cat,bizId:this.biz.entityID,title:t.title.getValue(),msgbody:this.ck.getData(),region:this.biz.fk_region_id}},getCKEditorConfig:function(){var t={toolbar:[["Bold","Italic","Underline","-","Image"]],extraPlugins:"autogrow",autoGrow_minHeight:280,height:280,removeButtons:"Subscript,Superscript",removePlugins:"elementspath",resize_enabled:!1,fontSize_sizes:"中号/16px;大号/24px;"};return t},initCKEditor:function(){var t=this,e=t.elem.find(".js_file");this.ck=CKEDITOR.replace("lb_ccc",this.getCKEditorConfig());var i=this.ck;return e.change(function(t){var a=t.target.files[0];return a?(util.uploadImage(a,function(t){t=util.pic.replaceToBig(t);var e='<img style="max-width:100%;" src="'+KG.config.SiteRoot+t+'" />';i.insertHtml(e)}),void e.val("")):!1}),this.ck.on("instanceReady",function(){i.addCommand("image",{modes:{wysiwyg:1,source:1},exec:function(t){console.log(arguments),e.trigger("click")}})}),i},initEnd:function(){var t=this;t.initCKEditor();var e=this.elem.find(".js_biz");KG.component.initWithElement(e,{list:this.data.bizList,clickCallback:function(e){console.log(e),t.biz=e},getEachHtml:function(){return"{{item.name_cn}}, {{item | storeFullAddress}}"}}),"edit"===this.prop.type?this.setFormValue(this.data.articleData):this.setDefaultValue()},setFormValue:function(t){console.log(t);var e=this.getElemObj();e.biz.setValue(_.findIndex(this.data.bizList,function(e){return t.fk_entityID===e.entityID})),e.biz.disable(!0),e.title.setValue(t.title);try{t.msgbody=decodeURIComponent(t.msgbody)}catch(i){}this.ck.setData(t.msgbody)},setDefaultValue:function(){var t=this.getElemObj();1===this.data.bizList.length&&t.biz.setValue(0)}}),KG.Class.define("MybizUploadCouponImage",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="hw-comp-MybizUploadStoreImage hw-coupon-uploadimage">','<div class="hw-add js_add">','<i class="icon hw-icon-plus"></i>',"<p>添加新图片</p>",'<input class="js_input" type="file" />',"</div>","</div>"].join("")},setJqVar:function(){return{add:this.elem.find(".js_add"),fileInput:this.elem.find(".js_input")}},getData:function(t,e,i){var a=e.list;this.type=util.url.param("id")?"edit":"create",i({list:a})},initEvent:function(){var t=this;this.jq.fileInput.change(function(){var e=this.files[0];t.uploadImageFn(e,function(e,i){t.addNewImage(e,i)}),$(this).val("")}),this.elem.click(function(e){var i=$(e.target),a=i.closest(".js_del");return a.length>0?(util.dialog.confirm1({YesText:"删除",msg:"您确定要删除这张照片吗？",YesFn:function(){t.deleteImage(a),util.dialog.hide()}}),!1):(a=i.closest(".js_img"),a.length>0?(t.showBigImage(a.find("img").attr("src")),!1):void 0)})},showBigImage:function(t){var e=this.getImageList(),i=util.indexOf(e,t);util.dialog.showFocusImage(i,e)},getImageList:function(){var t=this.elem.find(".js_img");return util.map(t,function(t){var e=$(t);return e.find("img").attr("src")})},getValue:function(){return this.getImageList()},deleteImage:function(t){var e,i=this,a=t.closest(".js_img");"create"===this.type?(a.remove(),e=this.getImageList().length,3>e&&this.jq.add.show()):KG.request.deleteCouponImage({fileid:a.find("b").attr("param"),id:util.url.param("id")},function(t,r){t&&(a.remove(),e=i.getImageList().length,3>e&&i.jq.add.show())})},getEachHtml:function(t,e){var i=['<div class="hw-one js_img">','<img src="{{url}}" />','<b param="'+e+'" class="js_del">删除</b>',"</div>"].join("");return template.compile(i)({url:t})},uploadImageFn:function(t,e){util.readFile(t,function(t){KG.request.uploadCouponImage({image:t,id:util.url.param("id")},function(t,i){if(t){var a=KG.config.SiteRoot+i[0].path;e(a,i[0].file_id)}})})},addNewImage:function(t,e){var i=this.getImageList().length;2===i&&this.jq.add.hide();var a=this.getEachHtml(t,e);this.jq.add.after(a)},initEnd:function(){var t=this,e=this.data.list;console.log(e),util.each(e,function(e){var i=e.path;/^http/.test(i)?t.addNewImage(i,e.pk_id):t.addNewImage(KG.config.SiteRoot+i,e.pk_id)})}}),KG.Class.define("MybizCouponForm",{ParentClass:"BaseForm",getInsideTemplate:function(){return["{{if pageTitle}}<h3>{{pageTitle}}<h3>{{/if}}",'<div placeholder="请选择店铺" class="js_biz" data-label="将优惠发布到" data-require="true" role="BaseSelectInput" init-self="true"></div>','<div class="form-group">','<div class="js_title" role="BaseInput" data-label="优惠标题" data-require="true" placeholder="e.g. 美食府金秋品尝会，邀您免费试吃"></div>','<div class="form-group">','<label class="require">开始时间</label>','<label style="right:150px;" class="control-label hw-err"></label>','<i class="before_input_icon icon fa fa-calendar-o js_cal_icon"></i>','<input style="width: 450px;display: block;position:relative;padding-left:46px;" type="text" class="form-control js_startDate" readonly="true" placeholder="'+moment().format("MM/DD/YYYY")+'">',"</div>",'<div class="form-group">','<label class="require">结束时间</label>','<label style="right:150px;" class="control-label hw-err"></label>','<i class="before_input_icon icon fa fa-calendar-o js_cal_icon"></i>','<input style="width: 450px;display: block;position:relative;padding-left:46px;" type="text" class="form-control js_endDate" readonly="true" placeholder="'+moment().add(14,"days").format("MM/DD/YYYY")+'">','<label style="vertical-align: top;position: absolute;top: 14px;left:465px;"><input style="position: relative; top: 13px;margin-right:8px;" class="js_endlimit" type="checkbox" />不限结束时间</label>',"</div>",'<div class="form-group">','<label class="require" for="lb_ccc">优惠描述</label>','<label class="control-label hw-err"></label>','<textarea style="height: 170px;" placeholder="优惠宣传、细节、方式、如何报名等信息提升参与度" class="js_desc form-control" id="lb_ccc"></textarea>',"</div>",'<div class="form-group">','<label class="lab">优惠图片</label>','<div class="js_image" role="MybizUploadCouponImage" init-self="true"></div>',"</div>",'{{if type==="create"}}','<div class="form-group">','<label style="font-weight: normal;">领取方式：用户输入手机号，系统会自动将优惠以短信形式发到用户手机。用户出示该条短信即可兑现。</label>','<label style="font-weight: normal;margin-top:5px;"><input style="height:auto;margin-right:8px;position:relative;top:-1px;" class="js_agree" checked="true" type="checkbox" />我同意用户展示优惠短信，即兑现优惠。</label>',"</div>","{{/if}}",'{{if type==="edit"}}<b class="hw-delete js_del_coupon">删除这个优惠</b>{{/if}}','<a href="javascript:void(0)" class="hw-btn hw-blue-btn js_btn">{{btnText}}</a>'].join("")},setJqVar:function(){return{startDate:this.elem.find(".js_startDate"),startTime:this.elem.find(".js_startTime"),endDate:this.elem.find(".js_endDate"),endTime:this.elem.find(".js_endTime"),desc:this.elem.find(".js_desc"),endlimit:this.elem.find(".js_endlimit"),btn:this.elem.find(".js_btn")}},defineProperty:function(){return{title:{defaultValue:""},type:{defaultValue:"create"}}},getElemObj:function(){return{title:KG.component.getObj(this.elem.find(".js_title")),image:KG.component.getObj(this.elem.find(".js_image"))}},getFormValue:function(){var t=this.getElemObj(),e=this.jq.biz.getValue(),i={biz:e.entityID,subject:t.title.getValue(),description:this.jq.desc.val(),startDate:this.jq.startDate.val(),endDate:this.jq.endDate.val(),imageList:t.image.getValue(),region:e.fk_subregion_id||e.fk_region_id};return this.jq.endlimit.prop("checked")&&(i.endDate="unlimit"),i},initBlurEvent:function(){var t=this,e=this.getElemObj();e.title.setBlurEvent(function(t){t?e.title.showError():e.title.showError("请输入优惠标题")}),_,this.jq.endDate.blur(function(){var e=$(this);_.delay(function(){var i=e.val();if(!i)return t.jq.endDate.parent("div.form-group").addClass("has-error").find(".hw-err").html("请选择结束时间"),!1;t.jq.endDate.parent("div.form-group").removeClass("has-error").find(".hw-err").html("");var a=t.getFormValue(),r=a.startDate?moment(a.startDate):moment(new Date);"unlimit"!==a.endDate&&moment(a.endDate).isBefore(r,"day")?t.jq.endDate.parent("div.form-group").addClass("has-error").find(".hw-err").html("结束时间不能早于开始时间"):"unlimit"!==a.endDate&&moment(a.endDate).isBefore(moment(new Date),"day")?t.jq.endDate.parent("div.form-group").addClass("has-error").find(".hw-err").html("结束时间不能早于当前时间"):t.jq.endDate.parent("div.form-group").removeClass("has-error").find(".hw-err").html("")},100)}),this.jq.desc.blur(function(){var e=$(this).val();e?t.jq.desc.parent("div.form-group").removeClass("has-error").find(".hw-err").html(""):t.jq.desc.parent("div.form-group").addClass("has-error").find(".hw-err").html("请输入优惠描述")})},validate:function(t){t=t||this.getFormValue();var e=this.getElemObj();if(!t.biz)return this.jq.biz.showError("请选择发布的店铺"),this.jq.biz.focus(),!1;if(this.jq.biz.showError(),!t.subject)return e.title.showError("请输入优惠标题"),e.title.focus(),!1;if(e.title.showError(),!t.startDate)return this.jq.startDate.parent("div.form-group").addClass("has-error").find(".hw-err").html("请选择开始时间"),this.jq.startDate.focus(),!1;if(this.jq.startDate.parent("div.form-group").removeClass("has-error").find(".hw-err").html(""),!t.endDate)return this.jq.endDate.parent("div.form-group").addClass("has-error").find(".hw-err").html("请选择结束时间"),this.jq.endDate.focus(),!1;this.jq.endDate.parent("div.form-group").removeClass("has-error").find(".hw-err").html("");var i=t.startDate?moment(t.startDate):moment(new Date);if("unlimit"!==t.endDate&&moment(t.endDate).isBefore(i,"day"))return this.jq.endDate.parent("div.form-group").addClass("has-error").find(".hw-err").html("结束时间不能早于开始时间"),this.jq.endDate.focus(),!1;if("unlimit"!==t.endDate&&moment(t.endDate).isBefore(moment(new Date),"day"))return this.jq.endDate.parent("div.form-group").addClass("has-error").find(".hw-err").html("结束时间不能早于当前时间"),this.jq.endDate.focus(),!1;if(this.jq.endDate.parent("div.form-group").removeClass("has-error").find(".hw-err").html(""),!t.description)return this.jq.desc.parent("div.form-group").addClass("has-error").find(".hw-err").html("请输入优惠描述"),this.jq.desc.focus(),!1;if(this.jq.desc.parent("div.form-group").removeClass("has-error").find(".hw-err").html(""),"create"===this.prop.type){var a=this.elem.find(".js_agree").prop("checked");if(!a)return util.dialog.alert("请同意优惠领取方式！"),!1}return!0},getData:function(t,e,i){var a=this.prop.title,r=this.prop.type,n=function(){return KG.request.getBizList({})},s=[n];"edit"===r&&s.push(function(){return KG.request.getCouponDetail({id:KG.data.get("id")})}),KG.request.defer(s,function(t,e){"create"===r&&(t=util.helper.getBizListByType(t,"running")),i({pageTitle:a,bizList:t,btnText:"edit"===r?"保存":"创建",type:r,couponData:e||null})})},initEvent:function(){var t=this;this.jq.startDate.datepicker({format:"mm/dd/yyyy",autoclose:!0}),this.jq.endDate.datepicker({format:"mm/dd/yyyy",autoclose:!0}),this.jq.btn.click(function(){var e=$(this),i=t.getFormValue();return console.log(i),t.validate(i)?("edit"===t.prop.type&&(i.id=KG.data.get("id")),util.dom.loadingButton(e,!0),KG.request.createStoreCouponEvent(i,function(i,a){if(util.dom.loadingButton(e,!1),i){if(console.log(a),"edit"===t.prop.type)return util.toast.alert("修改成功"),util.delay(function(){location.href="../mybiz/coupon.html"},2e3),!1;util.toast.alert("创建优惠成功！别忘了点击“分享”，让更多的人知道！"),_.delay(function(){location.href="../mybiz/coupon.html"},2e3)}}),void 0):!1}),this.elem.find(".js_endlimit").change(function(){t.jq.endDate.attr("disabled",$(this).prop("checked"))}),"edit"===this.prop.type&&this.elem.find(".js_del_coupon").click(function(){var t=KG.data.get("id");util.dialog.confirm1({msg:"确认要删除这个优惠么？",YesFn:function(){KG.request.deleteCouponById({id:t},function(t,e){t?location.href="../mybiz/coupon.html":util.toast.showError(e)})}})}),this.elem.find(".js_cal_icon").click(function(){var t=$(this);t.next("input").trigger("focus")}),this.initBlurEvent()},initEnd:function(){var t=this.elem.find(".js_biz");this.jq.biz=KG.component.initWithElement(t,{list:this.data.bizList,clickCallback:function(t){console.log(t)},getEachHtml:function(){return"{{item.name_cn}}, {{item | storeFullAddress}}"}});var e=[];"edit"===this.prop.type&&(e=this.data.couponData.files),this.image=KG.component.initWithElement(this.elem.find(".js_image"),{list:e}),"edit"===this.prop.type?this.setFormValue(this.data.couponData):this.setDefaultValue()},setFormValue:function(t){console.log(t);var e=this.getElemObj();this.jq.biz.setValue(_.findIndex(this.data.bizList,function(e){return t.fk_entityID===e.entityID})),this.jq.biz.disable(!0),e.title.setValue(t.subject),this.jq.desc.val(t.description),this.jq.startDate.datepicker("setDate",moment.unix(t.top_start_time).utc().format("MM/DD/YYYY")),!t.top_end_time||parseInt(t.top_end_time)<1||"unlimit"===t.top_end_time?(this.elem.find(".js_endlimit").prop("checked",!0),this.jq.endDate.attr("disabled",!0)):this.jq.endDate.datepicker("setDate",moment.unix(t.top_end_time).utc().format("MM/DD/YYYY"))},setDefaultValue:function(){1===this.data.bizList.length&&this.jq.biz.setValue(0),this.jq.startDate.datepicker("setDate",moment().format("MM/DD/YYYY"))}});
"use strict";!function(){KG.Class.define("MyfavLeftUserNav",{ParentClass:"BaseComponent",getTemplate:function(){return['<div style="height: auto;" class="hw-MybizLeftUserNav">','<a class="hw-img" href="javascript:void(0)"><img src="{{user.image}}" /></a>','<span class="hw-email">{{user.email}}<a style="display: block;" href="../mycount/info.html">[帐号设置]</a></span>','<a href="../myfav/list.html" class="hw-a js_myfav" style="margin-top:24px;">我的收藏</a>','<a href="../mycoupon/list.html" class="hw-a js_mycoupon">我的领取</a>','<a href="../mysys/index.html" class="hw-a js_mysys">系统消息</a>',"</div>"].join("")},getData:function(t,e,a){var i=KG.user.get(),s=KG.data.get("page").split("-");s=s[0]||"",a({user:i,page:s})},initEnd:function(){var t=this.data.page;this.elem.find(".js_"+t).addClass("active")}}),KG.Class.define("RightPanelList_1",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="panel hw-panel hw-comp-RightPanelList-1" style="width: 844px;float: right;">','<div class="panel-heading">',this.getHeadingTemplate(),"</div>",'<div class="hw-comp-store-list hw-right-panel-list panel-body">',this.getBodyTemplate(),"</div>","</div>"].join("")},setJqVar:function(){return{panelTitle:this.elem.find(".panel-heading"),panelBody:this.elem.find(".panel-body")}},getHeadingTemplate:function(){},getBodyTemplate:function(){}}),KG.Class.define("MyfavList",{ParentClass:"RightPanelList_1",getHeadingTemplate:function(){return['<div class="dropdown hw-drop">','<button id="dp_aaa" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">','<input type="text" readonly="true" class="form-control js_type" >','<i class="icon fa fa-caret-down"></i>',"</button>",'<ul class="dropdown-menu" aria-labelledby="dp_aaa">','<li data-type="all" class="js_a"></li>','<li data-type="deal" class="js_a"></li>','<li data-type="pause" class="js_a"></li>',"</ul>","</div>"].join("")},getBodyTemplate:function(){return'<div class="js_box"></div>'},setListHtml:function(t,e){var a=["{{each list as item}}",'<div class="hw-each">','<div class="hw-img" role="BaseLoadingImageBox" data-url="{{item | logoPath}}"></div>','{{if item.bizType==="pause"}}','<div class="mask">暂停营业</div>',"{{/if}}",'<div class="h4">','<a class="h4" target="_blank" href="{{item.entityID | toStorePath}}">{{item.name_cn}}</a>',"{{if item.event_info}}",'<i class="icon icon-coupon"></i>','<span class="hand cpt js_coupon" param="{{item.event_info.pk_id}}">{{item.event_info.subject}}</span>',"{{/if}}","</div>",'<div style="margin-top: 0;" role="StarRank" data-rank="{{item.star}}"></div>','<span style="margin-left: 10px;font-size: 14px;">{{item.commentnum}}条评论</span>','<p style="font-size: 14px;margin-top:8px;">地址 : {{item | storeFullAddress}} &nbsp;&nbsp; 电话 : {{item.tel}}</p>','<div class="r">','<b class="hw-a js_share" param="{{item.entityID}}" style="margin-top: 18px;">分享</b>','<a class="hw-a" href="{{item.entityID | toStorePath}}#hw-id-reply">评论</a>','<b param="{{item.entityID}}" class="hw-a js_del">取消收藏</b>',"</div>","</div>","{{/each}}"].join("");a=template.compile(a)({list:t,type:{pause:"pause"===e?!0:!1,deal:"deal"===e?!0:!1}}),t.length<1&&(a='<div role="HWNoContentDiv" style="height:180px;" data-text="暂无收藏店铺"></div>'),this.jq.panelBody.find(".js_box").html(a),KG.component.init(this.jq.panelBody)},initStart:function(){this.type=""},getListData:function(t,e){var a=this,i={};"pause"===t?i.not_open=!0:"deal"===t&&(i.is_active=!0),KG.request.getMyfavStoreList(i,function(i,s){if(console.log(i,s),i){a.setCount(s.count);var n=_.map(s.list,function(e){return e.bizType=t,"-1"===e.visible&&(e.bizType="pause"),e});a.setListHtml(n,t),e()}})},getData:function(t,e,a){a({})},setCount:function(t){var e=this.elem.find(".js_a");e.eq(0).html("全部收藏店铺("+t.all+")"),e.eq(1).html("正在优惠店铺("+t.is_active+")"),e.eq(2).html("暂停营业店铺("+t.is_closed+")")},initEvent:function(){var t=this,e=this.elem.find(".js_type");this.elem.find(".js_a").click(function(){var a=$(this);e.val(a.text());var i=a.data("type");return t.type===i?!1:(t.type=i,void t.getListData(i,function(){a.trigger("click")}))}),this.elem.on("click",".js_del",function(t){var e=$(t.target).attr("param");util.dialog.confirm({msg:"确认取消收藏此店铺么？",YesFn:function(a){KG.request.deleteMyFavStore({bizId:e},function(e,i){a(),e?$(t.target).closest(".hw-each").fadeOut(400,function(){$(this).remove()}):util.toast.showError(i)})}})}),this.elem.on("click",".js_share",function(t){var e=$(this).attr("param"),a=util.path.toMSiteStore(e);util.dialog.showQrCode(a)}),this.elem.on("click",".js_coupon",function(){var t=$(this).attr("param");util.dialog.showCouponDetail(t)})},initEnd:function(){this.elem.find(".js_a").eq(0).trigger("click")}})}();
"use strict";!function(){KG.Class.define("MycouponList",{ParentClass:"RightPanelList_1",getHeadingTemplate:function(){return['<div class="dropdown hw-drop">','<button id="dp_aaa" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">','<input type="text" readonly="true" class="form-control js_type" >','<i class="icon fa fa-caret-down"></i>',"</button>",'<ul class="dropdown-menu" aria-labelledby="dp_aaa">','<li class="js_a" param="0"></li>','<li class="js_a" param="1"></li>','<li class="js_a" param="2"></li>',"</ul>","</div>"].join("")},getBodyTemplate:function(){return""},initStart:function(){this.type=""},getListTemplate:function(){return["{{each list as item}}",'<div class="hw-each">',"{{if item.logo}}",'<div class="hw-img" data-url="{{item | logoPath}}" role="BaseLoadingImageBox"></div>',"{{/if}}",'{{if item.is_active==="0"}}','<div class="mask">已过期</div>',"{{/if}}",'{{if item.is_active==="0"}}','<div style="margin-top: 10px;" class="h4">','<b style="color:#9b9b9b;">{{item.subject}}</b>',"</div>","{{else}}",'<div style="margin-top: 10px;" class="h4 js_coupon hand" param={{item.pk_id}}>',"<b>{{item.subject}}</b>","</div>","{{/if}}",'{{if item.top_end_time==="unlimit"}}','<p style="font-size: 16px;margin-top:20px;">不限时间</p>',"{{else}}",'<p style="font-size: 16px;margin-top:20px;">{{item.top_start_time}} 至 {{item.top_end_time}}</p>',"{{/if}}",'<div class="r">',"{{if !item.active_time}}",'<b class="hw-a js_del" param="{{item.pk_id}}" style="margin-top: 48px;">删除</b>',"{{else}}",'<b style="margin-top:35px;" class="hw-a js_share" param="{{item.pk_id}}">分享</b>','<b class="hw-a js_del" param="{{item.pk_id}}">删除</b>',"{{/if}}","</div>","</div>","{{/each}}"].join("")},setListHtml:function(t){var i=template.compile(this.getListTemplate())({list:t});(!t||t.length<1)&&(i='<div role="HWNoContentDiv" style="height:180px;" data-text="暂无领取的优惠"></div>'),this.jq.panelBody.html(i),KG.component.init(this.jq.panelBody)},setCount:function(t){var i=this.elem.find(".js_a");i.eq(0).html("全部优惠（"+t.all+"）"),i.eq(1).html("正在优惠（"+t.is_active+"）"),i.eq(2).html("过期优惠（"+t.not_active+"）")},getListData:function(t,i){var e=this,a={};1===t?a.is_active=!0:2===t&&(a.not_active=!0),KG.request.getMycouponList(a,function(t,a){t?(e.setCount(a.count),e.setListHtml(a.list),i()):(e.setCount({all:"0",is_active:"0",not_active:"0"}),e.setListHtml([]),i())})},initEvent:function(){var t=this,i=this.elem.find(".js_type");this.elem.find(".js_a").click(function(){var e=$(this);i.val(e.text());var a=e.attr("param");return t.type===a?!1:(t.type=a,void t.getListData(parseInt(a,0),function(){e.trigger("click")}))}),this.jq.panelBody.on("click",".js_coupon",function(){var t=$(this).attr("param");return util.dialog.showCouponDetail(t),!1}),this.jq.panelBody.on("click",".js_del",function(t){var i=$(this),e=i.attr("param");util.dialog.confirm({msg:"确认删除这条优惠么？",YesFn:function(t){t(),KG.request.deleteMyFavCoupon({id:e},function(t,i){console.log(t,i),t&&location.reload(!0)})}})}),this.jq.panelBody.on("click",".js_share",function(){var t=$(this),i=t.attr("param"),e=util.path.toMSiteCoupon(i);util.dialog.showQrCode(e)})},initEnd:function(){this.elem.find(".js_a").eq(0).trigger("click")}})}();
"use strict";!function(){KG.Class.define("MysysMessageList",{ParentClass:"RightPanelList_1",getHeadingTemplate:function(){return['<div class="dropdown hw-drop">','<button id="dp_aaa" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">','<input type="text" readonly="true" class="form-control js_type" >','<i class="icon fa fa-caret-down"></i>',"</button>",'<ul class="dropdown-menu" aria-labelledby="dp_aaa">','<li class="js_a"></li>',"</ul>","</div>"].join("")},getBodyTemplate:function(){return['<div class="hw-each">','<div class="h4">','<label style="margin-left: 0;cursor: pointer;" class="hw-u js_sel_all" for="ck_aaa">全选</label>',"</div>",'<div class="r">','<b class="hw-a js_del_all">删除</b>',"</div>","</div>","{{each list as item}}",'<div class="hw-each">','<div class="h4">','<input param="{{item.id}}" type="checkbox" class="js_check" value="">','<a href="messageDetail.html?id={{item.id}}" class="hw-u">海外管理员</a>','<a {{if item.view>0}}style="font-weight:400;"{{/if}} href="messageDetail.html?id={{item.id}}" class="hw-p">{{item.title}}</a>',"</div>",'<div class="r">','<span>{{item.dateline | formatDate:"mm月dd日"}}</span>','<b param="{{item.id}}" class="js_del hw-a">删除</b>',"</div>","</div>","{{/each}}",'<div class="hw-each">','<div class="h4">','<label style="margin-left: 0;cursor: pointer;" class="hw-u js_sel_all" for="ck_bbb">全选</label>',"</div>",'<div class="r">','<b class="hw-a js_del_all">删除</b>',"</div>","</div>"].join("")},getData:function(e,t,a){KG.request.getSystemMessageList({},function(e,t){a({list:t.rs,count:{read:t.read,unread:t.unread,all:parseInt(t.read,10)+parseInt(t.unread,10)}})})},initEvent:function(){var e=this,t=this.elem.find(".js_type");this.elem.find(".js_a").click(function(){var e=$(this);t.val(e.text())}),this.elem.on("click",".js_del",function(t){var a=$(this).attr("param"),i=$(this).closest(".hw-each");e.deleteOneMessage(a,function(){i.fadeOut(200,function(){i.remove()})})}),this.elem.find(".js_sel_all").click(function(){var t=e.elem.find(".js_check");t.each(function(){var e=$(this);e.prop("checked",!e.prop("checked"))})}),this.elem.find(".js_del_all").click(function(){var t=e.elem.find(".js_check"),a=[];util.each(t,function(e){var t=$(e);t.prop("checked")&&a.push(t.attr("param"))}),e.deleteSelectMessage(a,function(){location.reload()})})},initEnd:function(){if(this.elem.find(".js_a").eq(0).html("全部系统消息"),this.elem.find(".js_a").eq(0).trigger("click"),this.data.list.length<1){this.elem.addClass("no_dis");var e='<div role="HWNoContentDiv" style="width:840px;float: right;height:240px;" data-text="暂无系统消息"></div>';this.elem.after(e),KG.component.initWithElement($('div[role="HWNoContentDiv"]'))}},deleteOneMessage:function(e,t){util.dialog.confirm({msg:"确认要删除此系统消息么？",YesFn:function(a){a(),KG.request.deleteSystemMessageById({id:e},function(e,a){e&&t()})}})},deleteSelectMessage:function(e,t){util.dialog.confirm({msg:"确认要删除这些系统消息么？",YesFn:function(a){a(),KG.request.deleteSystemMessageById({ids:e},function(e,a){e?t():alert(a)})}})}}),KG.Class.define("MycountMessageDetail",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="hw-comp-MycountMessageDetail">',"<h4>{{data.title}}</h4>","<small>{{data.dateline | formatDate}}</small>","<p>{{#data.msgbody}}</p>",'<div class="hw-ft">','<a href="index.html" style="margin-left: 25px;" class="hw-btn hw-blue-btn">返回</a>','<button class="js_del hw-btn hw-light-btn">删除</button>',"</div>","</div>"].join("")},defineProperty:function(){return{msgId:{defaultValue:""}}},getData:function(e,t,a){var i=this.prop.msgId||KG.data.get("msgId");KG.request.getSystemMessageDetail({id:i},function(e,t){e&&a({id:i,data:t})})},initEvent:function(){var e=this.data.id;this.elem.find(".js_del").click(function(){util.dialog.confirm({msg:"确认要删除此系统消息么？",YesFn:function(){KG.request.deleteSystemMessageById({id:e},function(e,t){e&&(location.href="index.html")})}})})}})}();
"use strict";KG.Class.define("MycountLeftNav",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="hw-comp-MycountLeftNav">','<a class="hw-a js_info" href="info.html">基本信息</a>','<a class="hw-a js_password" href="password.html">修改密码</a>',"</div>"].join("")},getData:function(t,e,i){var a=KG.data.get("page").split("-")[1];i({page:a})},initEvent:function(){this.elem.find(".js_password").click(function(){return KG.user.get("email")?void 0:(util.toast.showError("请先设置注册邮箱！"),!1)})},initEnd:function(){this.elem.find(".js_"+this.data.page).addClass("active")}}),KG.Class.define("MycountChangePasswordForm",{ParentClass:"BaseComponent",getTemplate:function(){return["<div>",'<div class="js_old" data-label="旧密码" data-require="true" data-type="password" role="BaseInput"></div>','<div class="js_pwd" data-label="新密码" data-require="true" data-type="password" role="BaseInput"></div>','<div class="js_pwd2" data-label="确认新密码" data-require="true" data-type="password" role="BaseInput"></div>','<a style="margin-top: 20px;float: right;" href="javascript:void(0)" class="hw-btn hw-blue-btn">保存</a>',"</div>"].join("")},initEvent:function(){var t=this;this.elem.find(".hw-btn").click(this.submit.bind(this)),this.jq.oldObj.setBlurEvent(function(t){t?this.showError():this.showError("请输入旧密码")}),this.jq.pwdObj.setBlurEvent(function(t){t?t.length<6?this.showError("密码长度不能小于6位"):this.showError():this.showError("请输入新密码")}),this.jq.pwd2Obj.setBlurEvent(function(e){e!==t.jq.pwdObj.getValue()?this.showError(util["const"].PasswordNotEqual):this.showError()})},setJqVar:function(){return{oldObj:KG.component.getObj(this.elem.find(".js_old")),pwdObj:KG.component.getObj(this.elem.find(".js_pwd")),pwd2Obj:KG.component.getObj(this.elem.find(".js_pwd2"))}},submit:function(){var t=this,e=this.jq.oldObj,i=this.jq.pwdObj,a=this.jq.pwd2Obj,s=e.getValue(),n=i.getValue(),r=a.getValue();return s?n?n.length<6?void i.showError("密码长度不能小于6位"):n!==r?void a.showError("二次输入的密码不一致"):void KG.request.changePassword({old:s,password:n},function(e,i){e?(util.toast.alert("修改成功"),t.reset()):util.dialog.alert(i)}):void i.showError("请输入新密码"):void e.showError("请输入旧密码")},reset:function(){var t=this.jq.oldObj,e=this.jq.pwdObj,i=this.jq.pwd2Obj;t.reset(),e.reset(),i.reset()}}),KG.Class.define("UploadUserImage",{ParentClass:"BaseUploadImage",getTemplate:function(){return["<div>",'<div class="hw-img-box">','<img class="js_img" src="{{image}}" />','<b class="js_del">删除</b>',"</div>",'<button data-loading-text="正在上传..." class="hw-btn js_btn">从电脑上传图片</button>','<input type="file" />',"</div>"].join("")},getData:function(t,e,i){i({image:this.prop.image})},setJqVar:function(){return{delBtn:this.elem.find(".js_del")}},initEvent:function(){this.callParent("initEvent");this.elem.find(".js_del");this.elem.find(".hw-img-box").hover(function(){},function(){});var t=this.jq;t.delBtn.click(function(){t.img.attr("src",KG.user.get("defaultImage"))})},uploadImageFn:function(t,e){var i=this;if(t){var a=new FileReader;a.onload=function(t){var a=t.target.result;KG.request.uploadUserImage({image:a},function(t,a){if(t){var s=KG.config.SiteRoot+a;i.jq.img.attr("src",s)}e()})},a.readAsDataURL(t)}}}),KG.Class.define("SelectLocationRange",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="hw-comp-SelectLocationRange">','<select class="js_country">',"{{each countryList as item}}",'<option value="{{item.id}}" {{if item.id==region[0]}}selected="true"{{/if}}>{{item.name}}</option>',"{{/each}}","</select>",'<select class="js_state"></select>',"<br />",'<select style="display: none;" class="js_city"></select>','<select style="display: none;" class="js_area no_dis"></select>',"</div>"].join("")},defineProperty:function(){return{region:{defaultValue:"1,-1,-1,-1"}}},setJqVar:function(){return{country:this.elem.find(".js_country"),state:this.elem.find(".js_state"),city:this.elem.find(".js_city"),area:this.elem.find(".js_area")}},getData:function(t,e,i){"-1"===this.prop.region.toString()&&(this.prop.region=1);var a=this;KG.request.getAllAddressAreaInfo({},function(t,e){var s=a.getListData(e),n={},r=function(t){util.each(t,function(t){n[t.pk_id]=t,t.child&&r(t.child)})};r(e);var o=a.prop.region.toString().split(",");i({countryList:s,all:n,region:o})})},initEventEnd:function(){var t=this;this.jq.country.change(function(){var e=$(this).val();t.changeCountry(e)}),this.jq.state.change(function(){var e=$(this).val();t.changeState(e)}),this.jq.city.change(function(){var e=$(this).val();t.changeCity(e)})},changeCountry:function(t,e){if(!t||"-1"===t.toString())return this.jq.state.val("-1"),this.jq.city.val("-1").hide(),void this.jq.area.val("-1").hide();var i=this.getListData(this.data.all[t].child);this.setListHtml(i,this.jq.state,e)},changeState:function(t,e){if(!t||"-1"===t.toString())return this.jq.city.val("-1").hide(),void this.jq.area.val("-1").hide();var i=this.getListData(this.data.all[t].child);this.setListHtml(i,this.jq.city,e)},changeCity:function(t,e){if(!t||"-1"===t.toString())return void this.jq.area.val("-1").hide();var i=this.getListData(this.data.all[t].child);this.setListHtml(i,this.jq.area,e)},getListData:function(t){return util.map(t,function(t){return t.id=t.pk_id,t})},setListHtml:function(t,e,i){if(!t||t.length<1)return void e.hide();var a=['<option value="-1">请选择</option>',"{{each data as item}}",'<option value="{{item.id}}">{{item.name}}</option>',"{{/each}}"].join("");e.html(template.compile(a)({data:t})),i=i||"-1",e.show().find('[value="'+i+'"]').attr("selected",!0),e.trigger("change")},getValue:function(){var t,e=[this.jq.country.val(),this.jq.state.val(),this.jq.city.val(),this.jq.area.val()];return util.each(e,function(e){e&&"-1"!==e&&(t=e)}),t},setValue:function(t){var e=this.data.all[t];console.log(e)},initEnd:function(){var t=this.data.region,e=t[0],i=t[1],a=t[2],s=t[3];this.changeCountry(e,i),this.changeState(i,a),this.changeCity(a,s),this.initEventEnd()}}),KG.Class.define("MycountChangeInfoForm",{ParentClass:"BaseComponent",getTemplate:function(){return["<div>",'<div class="js_username" data-value="{{user.nick}}" data-label="用户名" data-require="true" role="BaseInput"></div>','<div class="js_regemail" data-value="{{user.email}}" data-label="注册邮箱" data-require="true" data-type="email" role="BaseInput"></div>','<div class="form-group">','<label class="lab">头像</label>','<div data-image="{{user.avatar_url | absImage}}" class="hw-upload" role="UploadUserImage"></div>',"</div>",'<div class="hw-line"></div>','<div class="js_phone" data-format="phone" data-value="{{user.tel}}" placeholder="请输入北美10位电话号码 例: 5101234567" data-label="联络电话" role="BaseInput"></div>','<div class="js_wx" data-value="{{user.ims_value}}" data-label="微信号" role="BaseInput"></div>','<div class="hw-line"></div>','<div class="form-group">','<label class="lab">个人介绍</label>','<textarea class="form-control hw-area js_desc">{{user.signature}}</textarea>',"</div>",'<a style="margin-top: 20px;float: right;" href="javascript:void(0)" class="js_btn hw-btn hw-blue-btn">保存</a>',"</div>"].join("")},setJqVar:function(){return{btn:this.elem.find(".js_btn")}},getElemObj:function(){return{nick:KG.component.getObj(this.elem.find(".js_username")),email:KG.component.getObj(this.elem.find(".js_regemail")),tel:KG.component.getObj(this.elem.find(".js_phone")),wechat:KG.component.getObj(this.elem.find(".js_wx")),desc:this.elem.find(".js_desc")}},getData:function(t,e,i){for(var a=KG.user.get(),s=[],n=a.region_tree.reverse(),r=0,o=n.length;o>r;r++)s.push(n[r]?n[r].pk_id:"-1");i({region:s.join(","),user:a})},initBlurEvent:function(){var t=this.getElemObj();t.nick.setBlurEvent(function(t){t?this.showError():this.showError("请输入用户名")}),t.email.setBlurEvent(function(t){var e=KG.validate.email(t);e[0]?this.showError():this.showError(e[1])})},initEvent:function(){this.jq.btn.click(this.submit.bind(this)),this.initBlurEvent()},submit:function(){var t=this.getElemObj(),e={nickname:t.nick.getValue(),email:t.email.getValue(),tel:t.tel.getValue(),wechat:t.wechat.getValue(),description:t.desc.val()};return console.log(e),e.nickname?(t.nick.showError(),e.email?(t.email.showError(),void KG.request.modifyUserInfo(e,function(t,e){return t?(util.toast.alert("修改成功"),KG.user.update(),void _.delay(function(){location.reload()},2e3)):(util.toast.showError(e),!1)})):(t.email.showError("请输入注册邮箱"),t.email.focus(),!1)):(t.nick.showError("请输入用户名"),t.nick.focus(),!1)},initEnd:function(){KG.component.initWithElement(this.elem.find(".js_loc"))}}),KG.Class.define("HWMycountForgetPasswordForm",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="hw-HWMycountForgetPasswordForm">',"<p>请输入您的注册邮箱</p>",'<input type="text" class="form-control" />','<button class="hw-btn hw-blue-btn">找回密码</button>',"</div>"].join("")},initEvent:function(){var t=this.elem.find(".hw-btn"),e=this.elem.find("input");t.click(function(){var t=e.val();return util.validate.email(t)?(util.dom.showErrorPopover(e,!1),void KG.request.sendResetPasswordEmail({email:t},function(e,i){e?util.toast.alert("发送邮件成功","找回密码信息已发送至"+t+"，请查收邮件并按照提示操作！"):util.toast.showError(i)})):(util.dom.showErrorPopover(e,"注册邮箱格式错误",{placement:"right"}),!1)})}}),KG.Class.define("HWMycountResetPasswordForm",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="hw-HWMycountResetPasswordForm">','<div class="js_pwd" data-label="设置新密码" data-require="true" data-type="password" role="BaseInput"></div>','<div class="js_pwd1" data-label="确认新密码" data-require="true" data-type="password" role="BaseInput"></div>','<button class="hw-btn hw-blue-btn">保存</button>',"</div>"].join("")},getElemObj:function(){return{pwd:KG.component.getObj(this.elem.find(".js_pwd")),pwd1:KG.component.getObj(this.elem.find(".js_pwd1"))}},initEvent:function(){var t=this.getElemObj();this.elem.find(".hw-btn").click(function(){var e=t.pwd.getValue(),i=t.pwd1.getValue();if(!e||e.length<6)return t.pwd.showError("密码长度不能小于6位"),!1;if(t.pwd.showError(),e!==i)return t.pwd1.showError("二次输入的密码不一致"),!1;t.pwd1.showError();var a={check:KG.data.get("check"),email:KG.data.get("email"),password:e};KG.request.resetPassword(a,function(t,i){t?KG.user.login({username:KG.data.get("email"),password:e},function(t){location.href="../site/index.html"}):util.toast.showError(i)})})}});
KG.Class.define("MybizEditStoreLeftDropdown",{ParentClass:"BaseSelectInput",getTemplate:function(){return['<div class="dropdown hw-comp-MybizEditStoreLeftDropdown">','<button id="{{uuid}}" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">','<input type="text" readonly="true" class="form-control js_input" value="{{value}}">','<i class="icon fa fa-caret-down"></i>',"</button>",'<ul class="dropdown-menu" aria-labelledby="{{uuid}}">',"{{each list as item}}",'<li index="{{$index}}" class="js_drop">',this.getEachHtml(),"</li>","{{/each}}","</ul>","</div>"].join("")},getData:function(t,i,e){this.getEachHtml=function(){return"{{item}}"};var a=["正在营业","暂停营业","删除店铺"];this.prop;e({value:a[0],placeholder:"",uuid:"dl_"+util.getUuid(),list:a,bizId:KG.data.get("id")})},clickCallback:function(t){var i=this;t===this.data.list[1]?util.dialog.confirm({title:"确认要暂停营业吗？",msg:"点击确认，您的店铺将会进入暂停营业的状态。暂停营业的店铺将不可以修改基本信息，但您可以在任何时候将它转为营业中的状态。",YesFn:function(t){i.stopStore.call(i),t()}}):t===this.data.list[2]&&util.dialog.confirm({title:"确认要删除这个店铺吗？",msg:"点击确认，我们将为您删除这个店铺的所有信息，包括基本信息，图片，店铺评级和评论等，并且不能再找回这些信息，请谨慎操作。",YesFn:function(t){i.deleteStore(),t()}})},stopStore:function(){KG.request.changeStoreOpenStatus({bizId:this.data.bizId,status:!1},function(t,i){t&&(util.toast.alert("暂停成功"),_.delay(function(){location.href="../mybiz/index.html"},1e3))})},deleteStore:function(){KG.request.deleteStoreById({id:this.data.bizId},function(t){t&&(location.href="../mybiz/index.html")})}}),KG.Class.define("MybizLeftUserNav",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="hw-MybizLeftUserNav" style="height: auto;">','<a href="index.html" class="hw-a js_index">管理店铺</a>','<a href="coupon.html" class="hw-a js_coupon">发布优惠</a>','<a href="article.html" class="hw-a js_article">发布文章</a>',"</div>"].join("")},getData:function(t,i,e){var a=KG.user.get(),s=KG.data.get("page").split("-");s=s[1]||"",e({user:a,page:s})},initEnd:function(){var t=this.data.page;this.elem.find(".js_"+t).addClass("active")}}),KG.Class.define("MybizRightStoreRank",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="hw-MybizRightStoreRank">',"<span>您的店铺吸引力</span>",'<b class="js_rg">{{range}}%</b>','<div class="range"><em style="width:{{range}}%;"></em></div>',"<p>如何创建有影响力的店铺？</p>",'<a style="margin-top: 20px;" href="">完善店铺信息增加认知度</a>','<a href="">更多精美图片增加可信度</a>','<a href="">多发文章增加专业度</a>','<a href="">常发活动增加活跃度</a>',"</div>"].join("")},setJqVar:function(){return{wr:this.elem.find(".range").find("em"),txt:this.elem.find(".js_rg")}},getData:function(t,i,e){var a=this.prop.range;e({range:a})},setValue:function(t){this.data.range=t,this.jq.wr.css("width",t+"%"),this.jq.txt.text(t+"%")},registerMessage:function(t,i){this.setValue(i)},defineProperty:function(){return{range:{defaultValue:0}}}}),KG.Class.define("MybizRunningStoreList",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="hw-comp-store-list">',"{{each list as item}}",'<div class="hw-each" style="padding-left:112px;">','<div class="hw-img" role="BaseLoadingImageBox" style="width:96px;" data-url="{{item | logoPath}}"></div>','<a class="h4" href="{{item.entityID | toStorePath}}">{{item.name_cn ||item.name_en}}</a>',"<p>{{item | storeFullAddress}}</p>","<em>{{item.commentnum}}条评论</em>",'<div class="r">','<a class="hw-a" href="editStore.html?id={{item.entityID}}">修改店铺信息</a>','<b class="hw-a js_share" param="{{item.entityID}}">分享</b>',"</div>","</div>","{{/each}}","</div>"].join("")},getData:function(t,i,e){KG.request.getBizList({},function(t,i){var a=[];t&&(a=i);var s=[],n=[];util.each(a,function(t){"1"===t.visible?s.push(t):n.push(t)}),e({list:s}),KG.component.initWithElement($('div[role="MybizStopStoreList"]'),n),a.length>0&&$(".hw-MybizCreateNewStore").addClass("no_dis"),KG.component.initWithElement($('div[role="HWMybizIndexStoreAdsBlock"]'),{bizList:s})})},initEvent:function(){this.elem.on("click",".js_share",function(t){var i=$(this).attr("param"),e=util.path.toMSiteStore(i);return util.dialog.showQrCode(e),!1})},initEnd:function(){util.delay(function(){util.message.publish("MybizRightStoreRank",80)},1e3),this.data.list.length>0&&this.elem.parent(".hw-panel").removeClass("nodis")}}),KG.Class.define("MybizStopStoreList",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="hw-comp-store-list">',"{{each list as item}}",'<div class="hw-each" style="padding-left:112px;">','<div class="hw-img" role="BaseLoadingImageBox" style="width:96px;" data-url="{{item | logoPath}}"></div>','<a class="h4" href="{{item.entityID | toStorePath}}">{{item.name_cn ||item.name_en}}</a>',"<p>{{item.address}}, {{item.city}}, {{item.state}}, {{item.zip}}</p>","<em>{{item.commentnum}}新评论</em>",'<div class="r">','<a class="hw-a js_restart" param="{{item.entityID}}" href="javascript:void(0)">重新营业</a>','<a class="hw-a js_del" param="{{item.entityID}}" href="javascript:void(0)">删除</a>',"</div>","</div>","{{/each}}","</div>"].join("")},getData:function(t,i,e){var a=i;e({list:a})},initEvent:function(){var t=this;this.elem.find(".js_del").click(function(){var i=$(this);return util.dialog.confirm({title:"确认要删除这个店铺吗？",msg:"点击确认，我们将为您删除这个店铺的所有信息，包括基本信息，图片，店铺评级和评论等，并且不能再找回这些信息，请谨慎操作。",YesFn:function(e){e(),t.deleteStore(i.attr("param"))}}),!1}),this.elem.find(".js_restart").click(function(t){var i=$(this).attr("param");util.dialog.confirm({title:"确认要重新营业么？",msg:"点击确认，此店铺将重新开始营业。",YesFn:function(t){KG.request.changeStoreOpenStatus({bizId:i,status:!0},function(i,e){t(),i&&location.reload(!0)})}})})},deleteStore:function(t){KG.request.deleteStoreById({id:t},function(t){t&&location.reload()})},initEnd:function(){console.log(this.data.list),this.data.list.length>0&&this.elem.parent(".hw-panel").removeClass("nodis")}}),KG.Class.define("MybizRunningCouponList",{ParentClass:"BaseComponent",initStart:function(){this.lastid=null,this.list=[]},getTemplate:function(){return['<div class="hw-comp-store-list">','<div class="js_box"></div>','<div class="js_more" role="BaseLoadingMoreStatusBar"></div>',"</div>"].join("")},getData:function(t,i,e){KG.request.getBizList({},function(t,i){var e=[];t&&(e=i),e.length<1&&util.dialog.confirm1({msg:"您还没有创建店铺，请先建店！",YesText:"立即建店",YesFn:function(t){location.href="../mybiz/createStore.html"}});var a=[],s=[];util.each(e,function(t){"1"===t.visible?a.push(t):s.push(t)}),KG.component.initWithElement($('div[role="HWMybizIndexStoreAdsBlock"]'),{bizList:a})}),e({})},initEvent:function(){this.elem.on("click",".js_share",function(t){var i=$(this).attr("param"),e=util.path.toMSiteCoupon(i);return util.dialog.showQrCode(e),!1}),this.elem.on("click",".js_each",function(){var t=$(this).attr("param");util.dialog.showCouponDetail(t)})},initEnd:function(){var t=this,i=KG.component.getObj(this.elem.find(".js_more"));i.setEvent(function(e){t.getListData(function(a){a?(e(),t.list.length<6&&i.setState("hide")):i.setState("hide")})}),i.trigger()},getListData:function(t){var i=this;KG.request.getUserCouponList({is_active:"1",lastid:this.lastid},function(e,a){e?(i.list=i.list.concat(a),i.setListHtml(),a.length>0&&(i.lastid=_.last(a).pk_id,i.elem.parent(".hw-panel").removeClass("no_dis")),t(!0)):t(!1)})},setListHtml:function(){var t=this.list,i=["{{each list as item}}",'<div param="{{item.pk_id}}" class="hw-each js_each hand">','<div class="hw-img" role="BaseLoadingImageBox" data-url="{{item | logoPath}}"></div>','<h4 style="margin-top: 0;padding-top:20px;overflow: hidden;width:330px;text-overflow: ellipsis;">{{item.subject}}</h4>','<p style="color: #9b9b9b;font-size: 14px;margin-top:15px;">{{item.count}}人已经领取</p>','<div class="r">','<a class="hw-a" href="editCoupon.html?id={{item.pk_id}}">管理优惠</a>','<a class="hw-a js_share" param="{{item.pk_id}}" href="javascript:void(0)">分享</a>',"</div>","</div>","{{/each}}"].join("");i=template.compile(i)({list:t}),this.elem.find(".js_box").html(i),KG.component.init(this.elem.find(".js_box"))}}),KG.Class.define("MybizStopCouponList",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="hw-comp-store-list">','<div class="js_box"></div>','<div class="js_more" role="BaseLoadingMoreStatusBar"></div>',"</div>"].join("")},initStart:function(){this.lastid=null,this.list=[]},initEvent:function(){this.elem.on("click",".js_del",function(t){var i=$(this),e=i.attr("param");util.dialog.confirm({msg:"确认删除此优惠么？",YesFn:function(t){KG.request.deleteCouponById({id:e},function(e,a){t(),e?i.closest(".hw-each").fadeOut(400,function(){$(this).remove()}):alert(a)})}})})},setListHtml:function(){var t=this.list,i=["{{each list as item}}",'<div class="hw-each">','<div class="hw-img" role="BaseLoadingImageBox" data-url="{{item | logoPath}}"></div>','<h4 style="margin-top: 0;padding-top:10px;height:30px;">{{item.subject}}</h4>','<p style="color: #9b9b9b;font-size: 14px;margin-top:10px;">{{item.count}}人已经领取</p>','<p style="color: #9b9b9b;font-size: 14px;margin-top:5px;">{{item.startTime}} 至 {{item.endTime}}</p>','<div class="r">','<a class="hw-a js_del" param="{{item.pk_id}}" style="margin-top: 30px;" href="javascript:void(0)">删除</a>',"</div>","</div>","{{/each}}"].join("");i=template.compile(i)({list:t}),this.elem.find(".js_box").html(i),KG.component.init(this.elem.find(".js_box"))},getListData:function(t){var i=this;KG.request.getUserCouponList({is_active:"0",lastid:this.lastid},function(e,a){if(e){var s=[];util.each(a,function(t){t.startTime=t.top_start_time,t.endTime=t.top_end_time,s.push(t)}),i.list=i.list.concat(s),i.setListHtml(),s.length>0&&(i.lastid=_.last(s).pk_id,i.elem.parent(".hw-panel").removeClass("no_dis")),t(!0)}else t(!1)})},initEnd:function(){var t=this,i=KG.component.getObj(this.elem.find(".js_more"));i.setEvent(function(e){t.getListData(function(a){a?(e(),t.list.length<6&&i.setState("hide")):i.setState("hide")})}),i.trigger()}}),KG.Class.define("MybizCreateNewStore",{ParentClass:"BaseComponent",getTemplate:function(){var t={store:["添加新店铺",KG["default"].storeImage,"createStore.html"],coupon:["添加新优惠",KG["default"].couponImage,"createCoupon.html"],article:["添加新文章",KG["default"].articleImage,"createArticle.html"]},i=this.box.data("type");return['<a class="hw-MybizCreateNewStore" href="'+t[i][2]+'">','<div class="hw-img '+i+'"><img src="'+t[i][1]+'" /></div>','<i class="icon">＋</i>',"<b>",t[i][0],"</b>","</a>"].join("")},initEnd:function(){}}),KG.Class.define("MybizArticleList",{ParentClass:"BaseComponent",initStart:function(){this.list=[],this.lastid=null,this.count=0},getTemplate:function(){return["<div>",'<div class="panel-heading">','<b class="js_len"></b>',"</div>",'<div class="hw-comp-store-list panel-body js_box">',"</div>",'<div class="js_more" role="BaseLoadingMoreStatusBar"></div>',"</div>"].join("")},getData:function(t,i,e){KG.request.getBizList({},function(t,i){var e=[];t&&(e=i),e.length<1&&util.dialog.confirm1({msg:"您还没有创建店铺，请先建店！",YesText:"立即建店",YesFn:function(t){location.href="../mybiz/createStore.html"}});var a=[],s=[];util.each(e,function(t){"1"===t.visible?a.push(t):s.push(t)}),KG.component.initWithElement($('div[role="HWMybizIndexStoreAdsBlock"]'),{bizList:a})}),e({})},getListData:function(t){var i=this;KG.request.getUserArticleList({lastid_article:this.lastid},function(e,a){if(e&&a.list.length>0){var s=_.map(a.list,function(t){return t.link=util.path.article(t.id),t});i.list=i.list.concat(s),i.count=parseInt(a.count.all,10),i.setListHtml(),i.lastid=_.last(s).id,t(i.list.length<i.count?!0:!1)}else t(!1)})},initEvent:function(){this.elem.on("click",".js_share",function(t){var i=$(this),e=i.attr("param");util.dialog.showQrCode(e)})},setListHtml:function(){var t=this.list,i=["{{each list as item}}",'<div style="padding-left:145px;" class="hw-each">','<div class="hw-img" role="BaseLoadingImageBox" data-url="{{item | logoPath}}" style="width:130px;"></div>','<a class="hw-link" target="_blank" style="" href="{{item.link}}">{{item.title}}</a>','<p style="color: #9b9b9b;font-size: 14px;margin-top:20px;">发表于{{item.dateline | formatDate:"yy年mm月dd日"}}</p>','<div class="r">','<a class="hw-a" href="editArticle.html?id={{item.id}}">编辑</a>','<a class="hw-a js_share" param="{{item.link}}" href="javascript:void(0)">分享</a>',"</div>","</div>","{{/each}}"].join("");i=template.compile(i)({list:t}),this.elem.find(".js_len").html("文章 ("+this.count+")"),this.elem.find(".js_box").html(i),KG.component.init(this.elem.find(".js_box"))},initEnd:function(){var t=this,i=KG.component.getObj(this.elem.find(".js_more"));i.setEvent(function(e){t.getListData(function(a){t.list.length<1&&t.elem.closest(".hw-panel").hide(),a?e():i.setState("hide")})}),i.trigger()}}),KG.Class.define("BackPageLink",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="container hw-comp-BackPageLink">','<a href="{{href}}"><i class="icon fa fa-angle-left"></i>{{title}}</a>',"</div>"].join("")},getData:function(t,i,e){e({title:t.data("title"),href:t.data("href")})}}),KG.Class.define("MybizEditStoreLeftNav",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="hw-comp-MycountLeftNav">','<a class="hw-a js_editStore" href="editStore.html?id={{bizId}}">基本信息</a>','<a class="hw-a js_editStore_2" href="editStore_2.html?id={{bizId}}">更多描述</a>','<a class="hw-a js_editStore_3" href="editStore_3.html?id={{bizId}}">上传图片</a>',"</div>"].join("")},getData:function(t,i,e){var a=KG.data.get("page").split("-")[1],s=KG.data.get("id");e({page:a,bizId:s})},initEnd:function(){this.elem.find(".js_"+this.data.page).addClass("active").click(function(){return!1})}}),KG.Class.define("HWMybizIndexStoreAdsBlock",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="hw-HWMybizIndexStoreAdsBlock">','<h4 class="js_title">店铺文学城广告位</h4>','<div class="js_box"></div>',"</div>"].join("")},setTitle:function(t){t?this.elem.find(".js_title").html(t).show():this.elem.find(".js_title").hide()},showSelectBizDialog:function(t,i){var e=['<div class="hw-ads-bizlist">',"{{each list as item index}}",'<div class="hw-each">','<img src="{{item | logoPath}}" />',"<h4>{{item.name_cn || item.name_en}}</h4>",'<p class="hw-adress">{{item | storeFullAddress}}</p>','<p class="hw-tel">{{item.tel}}</p>','<button param="{{index}}" class="hw-btn hw-blue-btn js_select">选择</button>',"</div>","{{/each}}","</div>"].join("");e=template.compile(e)({list:t});var a={foot:!1,title:"请选择您要推广的店铺",body:e,"class":"hw-dialog-selectBizForAds",beforeShowFn:function(){var e=this;e.find(".hw-ads-bizlist").on("click",".js_select",function(){var e=$(this).attr("param");util.dialog.hide(),i(t[e])})}};util.dialog.show(a)},getData:function(t,i,e){var a=this;this.type=null,this.ads=null,this.bizList=i.bizList,console.log(this.bizList);var s=KG.user.get();s.ads_postid?KG.request.getAdsDetail({id:s.ads_postid},function(t,i){t?(a.type=i.status,a.ads=i,e({})):util.toast.showError(i)}):(this.type="create",e({}))},setJqVar:function(){return{box:this.elem.find(".js_box")}},initEvent:function(){},showCreateBox:function(){var t=this,i=['<div class="cg">','<img src="../../image/adsbanner1.png" />','我们为店主提供<a href="'+KG.config.Wenxuecity_Ads_Url+'" target="_blank">文学城首页</a>价值$300一个月免费广告服务，地理定向推广您在海外同城的店铺。一分钟即可自助创建160*90的图片广告。无需任何预付费信息，创建成功审核后自动发布。','<a class="hw-btn js_btn" href="javascript:void(0)">免费创建广告</a>',"</div>"].join("");this.jq.box.html(i),this.elem.find(".js_btn").click(function(){return t.bizList.length<1?(util.toast.showError("您没有可以创建广告的店铺"),!1):1===t.bizList.length?(location.href="../mybiz/createAds.html?store="+t.bizList[0].entityID,!1):void t.showSelectBizDialog(t.bizList,function(t){location.href="../mybiz/createAds.html?store="+t.entityID})}),this.setTitle(),this.elem.css({border:"1px solid #f4a62a","border-radius":"2px"})},showShowingBox:function(){var t=decodeURIComponent(this.ads.share);t+='<div class="cf"> 您创建的图片广告已在<a href="'+KG.config.Wenxuecity_Ads_Url+'" target="_blank">文学城首页</a>发布，我们的广告采用轮播的形式，即有其他店主新的广告，您的广告会自动下移，直到轮出广告区域。请随时留意您的广告是否下线，一个月以内可无限次自助上线广告。广告下线我们会在此处提示，请留意。</div>',t+='<a class="hw-btn hw-blue-btn js_btn" href="../mybiz/createAds.html?id='+this.ads.postid+'">修改广告</a>',this.jq.box.addClass("hw-showing").html(t),this.setTitle("广告已上线")},showWaitingBox:function(){var t=decodeURIComponent(this.ads.share);t+='<div class="cf">您的广告已创建，我们需要 1-2个工作日审核发布到<a href="'+KG.config.Wenxuecity_Ads_Url+'" target="_blank">文学城首页</a></div>',t+='<a class="hw-btn hw-blue-btn js_btn" href="../mybiz/createAds.html?id='+this.ads.postid+'">修改广告</a>',this.jq.box.addClass("hw-waiting").html(t),this.setTitle("广告正在审核中")},showInvisibleBox:function(){var t=decodeURIComponent(this.ads.share);t+='<div class="cf">由于广告过多，您的广告已轮出<a href="'+KG.config.Wenxuecity_Ads_Url+'" target="_blank">文学城首页</a>，一个月内可自助上线广告。</div>',t+='<a class="hw-btn hw-blue-btn js_btn" param="'+this.ads.postid+'" href="javascript:void(0)">重新上线</a>',this.jq.box.addClass("hw-waiting").html(t),this.elem.find(".js_btn").click(function(){var t=$(this).attr("param");KG.request.resubmitAds({id:t},function(t,i){t?(util.toast.alert("重新上线成功"),_.delay(function(){location.reload()},2e3)):util.toast.showError(i)})}),this.setTitle("广告已下线")},showClosedBox:function(){var t=decodeURIComponent(this.ads.share);t+='<div class="cf">您的一个月免费广告推广期已过，重新上线请查阅<a href="../help/ads_help.html" target="_blank">广告服务</a></div>',this.jq.box.addClass("hw-waiting").html(t),this.setTitle("广告已下线")},initEnd:function(){switch(this.type){case"create":this.showCreateBox();break;case"showing":this.showShowingBox();break;case"waiting":this.showWaitingBox();break;case"invisible":this.showInvisibleBox();break;case"closed":this.showClosedBox()}}}),KG.Class.define("HWMybizCrateAdsFormUploadImage",{ParentClass:"BaseUploadImage",getTemplate:function(){return["<div>",'<div class="hw-img-box">','<img class="js_img" src="{{image}}" />',"</div>",'<button data-loading-text="正在上传..." class="hw-btn js_btn">从电脑上传图片</button>','<input type="file" />',"</div>"].join("")},getData:function(t,i,e){e({image:this.prop.image})},setJqVar:function(){return{}},initEvent:function(){var t=this.jq.btn,i=(this.jq.img,this);this.jq.fileInput.bind("change",function(e){var a=this.files[0];t.button("loading"),i.uploadImageFn(a,function(){t.button("reset"),i.elem.trigger("change_end")})})},getImageUrl:function(){return this.jq.img.attr("src")}}),KG.Class.define("HWMybizCreateAdsPageForm",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="hw-HWMybizCreateAdsPageForm">','<label class="require hw-label">1.选择模版</label>','<dd class="s-tpl"><dd>','<label class="require hw-label">2.选择图片</label>','<div class="s-img" init-self="true" role="HWMybizCrateAdsFormUploadImage"></div>','<label class="hw-label require">3.填写内容</label>','<form class="form-horizontal s-form">','<div class="form-group">','<label class="col-sm-2 control-label require">标题</label>','<div class="col-sm-8">','<input type="text" param_len="14" class="form-control js_name" placeholder="">','<span class="hw-tip">建议填写店铺名称，或者想要宣传的产品/服务名称</span>',"</div>","</div>",'<div class="form-group">','<label class="col-sm-2 control-label require">文字第一行</label>','<div class="col-sm-10">','<input type="text" param_len="26" class="form-control js_ad1" placeholder="职位名称或营业特色">','<span class="hw-tip">建议填写职位名称，营业特色，电话号码或想要宣传的产品/服务等</span>',"</div>","</div>",'<div class="form-group">','<label class="col-sm-2 control-label require">文字第二行</label>','<div class="col-sm-10">','<input type="text" param_len="26" class="form-control js_ad2" placeholder="广告宣传语">','<span class="hw-tip">建议填写职位名称，营业特色，电话号码或想要宣传的产品/服务等</span>',"</div>","</div>",'<div class="form-group">','<label class="col-sm-2 control-label require">文字第三行</label>','<div class="col-sm-10">','<input type="text" param_len="26" class="form-control js_tel" placeholder="">','<span class="hw-tip">建议填写职位名称，营业特色，电话号码或想要宣传的产品/服务等</span>',"</div>","</div>",'<div class="s-btn">','<a href="../mybiz/index.html" class="hw-btn hw-light-btn hw-back">取消</a>','<button class="hw-btn hw-blue-btn hw-sub js_sub">'+(this.postid?"保存":"创建广告")+"</button>","</div>","</form>","</div>"].join("")},getData:function(t,i,e){var a=this;if(a.postid=KG.data.get("id"),util.loading(!0),a.postid)KG.request.getAdsDetail({id:a.postid,bizinfo:!0},function(t,i){util.loading(!1),t&&(a.bizId=i.fk_entityID,a.bizData=i.bizinfo,a.logo=i.pic,a.name=i.title,a.ad1=i.ad1,a.ad2=i.ad2,a.tel=i.tel,3===i.type?a.tpl=3:a.tpl="common"+i.type,e({}))});else{var s=util.url.param("store");if(!s)return util.toast.showError("店铺参数错误"),util.delay(function(){location.href="../mybiz/createStore.html"},2e3),!1;KG.request.getStoreDetail({id:s},function(t,i){util.loading(!1),t&&(a.bizId=s,a.bizData=i,a.logo=KG.config.SiteRoot+a.bizData.logo[0].path,a.tpl="common1",a.tel=a.bizData.tel,e({}))})}},initStart:function(){this.bizId=null,this.bizData=null,this.tpl="",this.logo="",this.name="",this.ad1="",this.ad2="",this.tel="",this.tagList={27:"canyinmeishi",131:"canyinmeishi",41:"jiazhuangqingjie",214:"kehoufudao",366:"kuijibaoxian",383:"kuijibaoxian",195:"qicheweixiu",643:"sijiaxiaodian",294:"zhongyiyayi",297:"zhongyiyayi",345:"zhongyiyayi",479:"xiuxianmeirong"}},setJqVar:function(){return{name:this.elem.find(".js_name"),ad1:this.elem.find(".js_ad1"),ad2:this.elem.find(".js_ad2"),tel:this.elem.find(".js_tel")}},setImageTemplate:function(){var t=this,i=["common1","common2"],e=this.bizData.fk_main_tag_id;this.tagList[e]?i.push(this.tagList[e]):i.push("canyinmeishi");var a=_.map(i,function(t){return'<img class="js_tpl" param="'+t+'" src="../../image/createad/'+t+'.png" />'}),s=this.elem.find(".s-tpl");s.html(a.join("")),"common1"===this.tpl?(s.find("img").eq(0).addClass("active"),this.setPlaceHolder(0)):"common2"===this.tpl?(s.find("img").eq(1).addClass("active"),this.setPlaceHolder(1)):(s.find("img").eq(2).addClass("active"),t.jq.ad2.attr("disabled",!0).parents(".form-group").addClass("disable"),this.setPlaceHolder(2))},initEvent:function(){var t=this;this.elem.find(".s-tpl").on("click","img",function(){var i=$(this);return i.hasClass("active")?!1:(i.parent().find("img").removeClass("active"),i.addClass("active"),t.setPlaceHolder(t.elem.find(".s-tpl img").index(i)),2===t.elem.find(".s-tpl img").index(i)?t.jq.ad2.attr("disabled",!0).parents(".form-group").addClass("disable"):t.jq.ad2.removeAttr("disabled").parents(".form-group").removeClass("disable"),void t.toPreviewAD())});var i=null;this.elem.find(".s-form").on("keyup","input",function(e){i&&window.clearTimeout(i),i=window.setTimeout(function(){t.toPreviewAD()},200)}),t.elem.find(".s-btn .js_sub").click(function(){var i=$(this),e=t.getSubmitData(),a="广告已成功创建！5分钟内将出现在文学城首页“海外同城”栏目两侧";return t.postid&&(e.id=t.postid,a="修改成功，5分钟内将出现在文学城首页“海外同城”栏目两侧"),console.log(e),e.title?e.ad1?e.tel?(util.dom.loadingButton(i,!0),KG.request.createAds(e,function(t,e){util.dom.loadingButton(i,!1),t?(util.toast.alert(a),util.delay(function(){location.href="../mybiz/index.html"},2e3)):util.toast.showError(e)}),!1):(util.toast.showError("请输入文字第三行"),!1):(util.toast.showError("请输入文字第一行"),!1):(util.toast.showError("请输入标题"),!1)})},initEnd:function(){var t=this;this.elem.find(".s-img").attr("data-image",this.logo),this.jq.logo=KG.component.initWithElement(this.elem.find(".s-img")),this.jq.logo.elem.bind("change_end",this.toPreviewAD.bind(this)),this.setImageTemplate(),this.jq.name.val(this.name),this.jq.ad1.val(this.ad1),this.jq.ad2.val(this.ad2),t.postid?this.jq.tel.val(this.tel):this.tel?this.jq.tel.val(template.helpers.formatPhone(this.tel)):this.jq.tel.val(this.tel),util.delay(function(){t.toPreviewAD()},100)},getFormValue:function(){return this.tpl=this.elem.find(".js_tpl").filter(".active").attr("param"),this.logo=this.jq.logo.getImageUrl(),this.name=this.jq.name.val(),this.ad1=this.jq.ad1.val(),this.ad2=this.jq.ad2.val(),this.tel=this.jq.tel.val(),{template:this.tpl,logo:this.logo,bizName:this.name,bizAd1:this.ad1,bizAd2:this.ad2,bizTel:this.tel,bizLink:KG.config.SiteRoot+"/pc/page/view/store.html?id="+this.bizId}},toPreviewAD:function(){var t=this.getFormValue();util.message.publish("HWMybizCreateAdsPagePreivew",t)},getSubmitData:function(){this.getFormValue();var t={title:this.name,ad1:this.ad1,ad2:this.ad2,tel:this.tel,bizId:this.bizId,tag:this.bizData.fk_main_tag_id,logo:this.logo,region:this.bizData.fk_region_id};return"common1"===this.tpl?t.type=1:"common2"===this.tpl?t.type=2:t.type=3,t.html=$(".hw-right-box .hw-preview").html(),t},setPlaceHolder:function(t){var i=[{title:"限5个中文字",ad1:"限7个中文字",ad2:"限7个中文字",tel:"限12个中文字"},{title:"限5个中文字",ad1:"限7个中文字",ad2:"限7个中文字",tel:"限12个中文字"},{title:"限7个中文字",ad1:"限13个中文字",ad2:"本模板不使用此行文字",tel:"限13个中文字"}],e=i[t];this.jq.name.attr("placeholder",e.title),this.jq.ad1.attr("placeholder",e.ad1),this.jq.ad2.attr("placeholder",e.ad2),this.jq.tel.attr("placeholder",e.tel)}}),KG.Class.define("HWMybizCreateAdsPagePreivew",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="hw-right-box"><div class="box">','<h4 class="hw-title">广告预览</h4>','<div class="hw-preview"></div>',"</div></div>"].join("")},registerMessage:function(t,i){this.setPreivewHtml(i)},setJqVar:function(){return{box:this.elem.find(".hw-preview")}},setPreivewHtml:function(t){var i;i="common1"===t.template||"common2"===t.template?"hw-ad-"+t.template:"hw-ad-t3 hw-ad-"+t.template;var e=['<a href="{{bizLink}}" target="_blank" class="hw-ad '+i+'">','<div class="hw-logo"><img src="{{logo}}"/></div>','<p class="hw-name">{{bizName}}</p>','<p class="hw-ad1">{{bizAd1}}</p>','<p class="hw-ad2">{{bizAd2}}</p>','<p class="hw-tel">{{bizTel}}</p>',"</a>"].join("");e=template.compile(e)(t),this.jq.box.html(e),this.elem.find(".box").show(),console.log(this.elem.offset())},initEnd:function(){this.elem.find(".box").affix({offset:{top:152}})}});
KG.Class.define("MybizCreateStoreStepInfo",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="hw-stepinfo {{step}}">','<div class="c c1"><i class="fa fa-check"></i></div>','<div class="d d1"></div>','<div class="c c2"><i class="fa fa-check"></i></div>','<div class="d d2"></div>','<div class="c c3"><i class="fa fa-check"></i></div>','<p class="p p1">基本信息</p>','<p class="p p2">更多描述</p>','<p class="p p3">上传图片</p>',"</div>"].join("")},defineProperty:function(){return{step:{defaultValue:"step1"}}},getData:function(t,i,e){e({step:this.prop.step})}}),KG.Class.define("MybizStoreInputDatepicker",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="form-group hw-MybizStoreInputDatepicker">',"<label>营业时间</label>",'<label class="control-label hw-err"></label>','<div class="cbbox">','<div class="cb js_b2">','<select class="js_start">',"{{each timelist as item}}",'<option value="{{item}}">{{item}}</option>',"{{/each}}","</select>","<b>－</b>",'<select class="js_end">',"{{each timelist as item}}",'<option value="{{item}}">{{item}}</option>',"{{/each}}","</select>","</div>",'<div class="cc">',"<span>适用于</span>","{{each DAY as item}}",'<b class="js_day">{{item}}</b>',"{{/each}}","</div>",'<button class="hw-btn hw-light-btn js_add">确定</button>',"</div>",'<div class="ca js_b1" style="display: none;">',"</div>","</div>"].join("")},initStart:function(){this.timelist=["休业","04:00AM","04:30AM","05:00AM","05:30AM","06:00AM","06:30AM","07:00AM","07:30AM","08:00AM","08:30AM","09:00AM","09:30AM","10:00AM","10:30AM","11:00AM","11:30AM","12:00PM","12:30PM","01:00PM","01:30PM","02:00PM","02:30PM","03:00PM","03:30PM","04:00PM","04:30PM","05:00PM","05:30PM","06:00PM","06:30PM","07:00PM","07:30PM","08:00PM","08:30PM","09:00PM","09:30PM","10:00PM","10:30PM","11:00PM","11:30PM","12:00AM","12:30AM","01:00AM","01:30AM","02:00AM","02:30AM","03:00AM","03:30AM"],this.DAY=["周一","周二","周三","周四","周五","周六","周日"],this.SD=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"],this.td=[]},setJqVar:function(){var t=this.elem.find(".js_b2");return{box:this.elem.find(".js_b1"),bb:t,start:t.find(".js_start"),end:t.find(".js_end")}},getData:function(t,i,e){e({timelist:this.timelist,DAY:this.DAY})},setBoxHtml:function(){var t=this.timelist[0],i=["{{each list as item index}}",'{{if item.start==="'+t+'"||item.end==="'+t+'"}}','<div><span class="ml">{{item.weekString}}</span> <span class="ml">'+t+'</span> <span param="{{index}}" class="js_del bn">删除</span></div>',"{{else}}",'<div><span class="ml">{{item.weekString}}</span> <span>{{item.start}}</span> － <span class="ml">{{item.end}}</span> <span param="{{index}}" class="js_del bn">删除</span></div>',"{{/if}}","{{/each}}"].join(""),e=_.map(this.td,function(t){return t.weekString=t.week.join(" "),t});i=template.compile(i)({list:e}),this.jq.box.html(i),this.checkListBox(),this.reset()},getAddData:function(){var t={start:this.jq.start.val(),end:this.jq.end.val()};return t.week=_.map(this.elem.find(".js_day").filter(".active"),function(t){return $(t).html()}),t},checkListBox:function(){var t=!1;this.td.length>0&&(t=!0),t?this.jq.box.show():this.jq.box.hide()},checkDayTime:function(t){if(-1!==util.indexOf(t,this.timelist[0]))return!0;var i=t[0],e=t[1];if(i={x:parseInt(i.substr(0,2),10),y:i.substr(5,2)},e={x:parseInt(e.substr(0,2),10),y:e.substr(5,2)},e.y===i.y){if(e.x>i.x)return!0}else if("PM"===e.y)return!0;return!1},showError:function(t){t?this.elem.addClass("has-error").find(".hw-err").html(t):this.elem.removeClass("has-error").find(".hw-err").html("")},initEvent:function(){var t=this;this.elem.on("click",".js_add",function(){var i=t.getAddData();return t.checkDayTime([i.start,i.end])?(t.showError(),i.week.length<1?(t.showError("请选择适用于周几"),!1):(t.showError(),t.td.push(i),void t.setBoxHtml())):(t.showError("时间格式错误"),!1)}),this.elem.on("click",".js_day",function(){$(this).hasClass("active")?$(this).removeClass("active"):$(this).addClass("active")}),this.jq.box.on("click",".js_del",function(){var i=$(this).attr("param");t.td.splice(i,1),t.setBoxHtml()}),this.jq.start.change(function(){$(this).val()===t.timelist[0]&&t.jq.end.val(t.timelist[0])}),this.jq.end.change(function(){$(this).val()===t.timelist[0]&&t.jq.start.val(t.timelist[0])})},reset:function(){this.elem.find(".js_day").removeClass("active"),this.jq.start.val("08:00AM"),this.jq.end.val("09:00PM")},initEnd:function(){this.checkListBox(),this.reset()},setValue:function(t){var i=this,e=[];_.each(t,function(t){var a={start:t.datetime1,end:t.datetime2},n=[];_.each(i.SD,function(e,a){"1"===t[e]&&n.push(i.DAY[a])}),a.week=n,e.push(a)}),i.td=e,i.setBoxHtml(),i.checkListBox()},setValueByOrigin:function(t){console.log(t);var i=this,e=[];_.each(t,function(t){var a={start:t.daytime[0],end:t.daytime[1]},n=[];_.each(t.weektime,function(t,e){"1"===t&&n.push(i.DAY[e])}),a.week=n,e.push(a)}),i.td=e,i.setBoxHtml(),i.checkListBox()},getValue:function(){var t=this,i=[];return _.each(this.td,function(e){var a={daytime:[e.start,e.end]},n=[];_.each(t.DAY,function(t){_.contains(e.week,t)?n.push("1"):n.push("0")}),a.weektime=n,i.push(a)}),i}}),KG.Class.define("MybizStoreInfoFormStep1",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="hw-comp-MybizStoreInfoFormStep1">','<div {{if biz}}data-value="{{biz.name_cn}}"{{/if}} class="js_name" role="BaseInput" data-label="店铺名称" data-require="true" placeholder="e.g. 小肥羊Fremont店 （请尽量用中文名，分店请尽量添加城市名）"></div>','<div {{if biz}}data-value="{{biz.tel}}"{{/if}} class="js_tel" role="BaseInput" data-label="营业电话" data-require="true" data-format="phone" placeholder="请输入北美10位电话号码 例: 5101234567"></div>','<div class="js_cat" data-label="服务类别" data-require="true" role="BaseSelectInput" init-self="true" placeholder="请选择一种类别"></div>','<div class="form-group js_tag" style="display: none;">',"<label>营业特色</label>",'<div class="hw-tagbox">',"</div>","</div>",'<div {{if biz}}data-value="{{biz.address}}"{{/if}} class="js_address" role="BaseInput" data-label="店铺地址" placeholder="街道地址，如3442 Mackenzie Dr (可选)"></div>','<div {{if biz}}data-value="{{biz.zip}}"{{/if}} style="margin-left: 0;" class="js_zip hw-inline" role="BaseInput" data-require="true" data-label="邮编" placeholder="e.g. 94536"></div>','<div {{if biz}}data-value="{{biz.city}}"{{/if}} class="js_city hw-inline" role="BaseInput" data-require="true" data-label="城市"></div>','<div style="position:relative;top:1px;float: right;" class="hw-inline form-group">','<label class="require">州/省</label>','<label class="control-label hw-err"></label>','<select class="js_state hw-inline">',this.stateListHtml,"</select>","</div>",'<div class="js_wktime" role="MybizStoreInputDatepicker"></div>','<button style="float: right;" class="js_btn hw-btn hw-blue-btn">{{btnText}}</button>',"<div>"].join("")},getData:function(t,i,e){var a=this;this.type="create";var n=[function(){return KG.request.getAllStoreCategoryList({})}];KG.data.get("id")&&(this.type="edit",n.push(function(){return KG.request.getBizDetailById({bizId:KG.data.get("id")})})),util.loading(!0),KG.request.defer(n,function(t,i){util.loading(!1),i||"fromstorage"!==util.url.hash()||(i=util.storage.get(a.__name),i.name_cn=i.bizName,i.tel=i.bizTel,i.fk_main_tag_id=i.bizTagId,i.tags=_.map(i.tags.split(","),function(t){return{pk_id:t}})),e({catList:t,biz:i||!1,type:a.type,btnText:"create"===a.type?"下一步":"保存"})})},setJqVar:function(){return{tagBox:this.elem.find(".hw-tagbox"),btn:this.elem.find(".js_btn")}},initStart:function(){this.stateListHtml=['<option value="-1">请选择州/省</option>','<optgroup label="United States">','<option value="AL">Alabama</option>','<option value="AK">Alaska</option>','<option value="AZ">Arizona</option>','<option value="AR">Arkansas</option>','<option value="CA">California</option>','<option value="CO">Colorado</option>','<option value="CT">Connecticut</option>','<option value="DE">Delaware</option>','<option value="DC">District Of Columbia</option>','<option value="FL">Florida</option>','<option value="GA">Georgia</option>','<option value="HI">Hawaii</option>','<option value="ID">Idaho</option>','<option value="IL">Illinois</option>','<option value="IN">Indiana</option>','<option value="IA">Iowa</option>','<option value="KS">Kansas</option>','<option value="KY">Kentucky</option>','<option value="LA">Louisiana</option>','<option value="ME">Maine</option>','<option value="MD">Maryland</option>','<option value="MA">Massachusetts</option>','<option value="MI">Michigan</option>','<option value="MN">Minnesota</option>','<option value="MS">Mississippi</option>','<option value="MO">Missouri</option>','<option value="MT">Montana</option>','<option value="NE">Nebraska</option>','<option value="NV">Nevada</option>','<option value="NH">New Hampshire</option>','<option value="NJ">New Jersey</option>','<option value="NM">New Mexico</option>','<option value="NY">New York</option>','<option value="NC">North Carolina</option>','<option value="ND">North Dakota</option>','<option value="OH">Ohio</option>','<option value="OK">Oklahoma</option>','<option value="OR">Oregon</option>','<option value="PA">Pennsylvania</option>','<option value="RI">Rhode Island</option>','<option value="SC">South Carolina</option>','<option value="SD">South Dakota</option>','<option value="TN">Tennessee</option>','<option value="TX">Texas</option>','<option value="UT">Utah</option>','<option value="VT">Vermont</option>','<option value="VA">Virginia</option>','<option value="WA">Washington</option>','<option value="WV">West Virginia</option>','<option value="WI">Wisconsin</option>','<option value="WY">Wyoming</option>',"</optgroup>",'<optgroup label="Canada">','<option value="AB">Alberta</option>','<option value="BC">British Columbia</option>','<option value="MB">Manitoba</option>','<option value="NB">New Brunswick</option>','<option value="NL">Newfoundland and Labrador</option>','<option value="NS">Nova Scotia</option>','<option value="ON">Ontario</option>','<option value="PE">Prince Edward Island</option>','<option value="QC">Quebec</option>',' <option value="SK">Saskatchewan</option>','<option value="NT">Northwest Territories</option>','<option value="NU">Nunavut</option>','<option value="YT">Yukon</option>',"</optgroup>"].join("")},getElemObj:function(){return{name:KG.component.getObj(this.elem.find(".js_name")),tel:KG.component.getObj(this.elem.find(".js_tel")),address:KG.component.getObj(this.elem.find(".js_address")),zip:KG.component.getObj(this.elem.find(".js_zip")),city:KG.component.getObj(this.elem.find(".js_city")),state:this.elem.find(".js_state"),timeinfo:KG.component.getObj(this.elem.find(".js_wktime"))}},getFormValue:function(){var t=this.getElemObj(),i={bizName:t.name.getValue(),bizTel:t.tel.getValue(),bizTagId:this.jq.cat.getValue().pk_id,zip:t.zip.getValue(),address:t.address.getValue(),city:t.city.getValue(),state:t.state.val().toUpperCase(),tags:this.getTagBoxValue()};return i.timeinfo=t.timeinfo.getValue(),i},validate:function(t){var i=this.getElemObj();if(!t.bizName)return i.name.showError("店铺名称不能为空"),i.name.focus(),!1;if(i.name.showError(),!t.bizTel)return i.tel.showError("店铺电话不能为空"),i.tel.focus(),!1;if(!util.validate.AmericanPhone(t.bizTel))return i.tel.showError("店铺电话格式不对"),i.tel.focus(),!1;if(i.tel.showError(),"create"===this.type){if(!t.bizTagId)return this.jq.cat.showError("请选择店铺类别"),this.jq.cat.focus(),!1;this.jq.cat.showError()}else t.bizTagId=this.data.biz.fk_main_tag_id;return t.zip?(i.zip.showError(),t.city?(i.city.showError(),"-1"===t.state?(i.state.parent("div.form-group").addClass("has-error").find(".hw-err").html("请选择州/省"),!1):(i.state.parent("div.form-group").removeClass("has-error").find(".hw-err").html(""),!0)):(i.city.showError("请输入城市"),i.city.focus(),!1)):(i.zip.showError("请输入邮编"),i.zip.focus(),!1)},initBlurEvent:function(){var t=this.getElemObj();t.name.setBlurEvent(function(t){t?this.showError():this.showError("店铺名称不能为空")}),t.tel.setBlurEvent(function(t){t?util.validate.AmericanPhone(t)?this.showError():this.showError("店铺电话格式不对"):this.showError("店铺电话不能为空")}),t.zip.setBlurEvent(function(i){i?t.zip.showError():t.zip.showError("请输入邮编")}),t.city.setBlurEvent(function(i){i?t.city.showError():t.city.showError("请输入城市")}),t.state.blur(function(){"-1"===t.state.val()?t.state.parent("div.form-group").addClass("has-error").find(".hw-err").html("请选择州/省"):t.state.parent("div.form-group").removeClass("has-error").find(".hw-err").html("")})},initEvent:function(){var t=this;this.jq.btn.click(function(){var i=$(this),e=t.getFormValue();return console.log(e),t.validate(e)?void("edit"===t.type?(e.bizId=KG.data.get("id"),util.dom.loadingButton(i,!0),KG.request.saveStoreByStep1(e,function(t,a){if(util.dom.loadingButton(i,!1),t){var n={msg:'<div class="hw-icon"><i class="fa fa-check"></i></div>修改成功',YesText:"去看看",NoText:"关闭",YesFn:function(){util.path.go(util.path.store(e.bizId))}};util.dialog.confirm1(n)}})):(util.storage.set(t.__name,e),util.dom.loadingButton(i,!0),KG.request.createStoreByStep1(e,function(t,e){util.dom.loadingButton(i,!1),t&&(console.log(e),location.href="createStore_2.html?tmp_biz_id="+e.entityID+"&main_tag_id="+e.main_tag_id)}))):!1});var i=this.getElemObj();i.zip.elem.find("input").keyup(function(){var t=i.zip.getValue();5===t.length&&KG.request.getRegionInfoByZipcode({zip:t},function(t,e){t&&(console.log(e),e.city&&i.city.setValue(e.city),e.state&&i.state.val(e.state))})}),this.initBlurEvent()},initEnd:function(){var t=this,i=this.elem.find(".js_cat");if(this.jq.cat=KG.component.initWithElement(i,{list:this.data.catList,getEachHtml:function(){return"{{item.name}}"},clickCallback:function(i){t.switchCategory.call(t,i),util.dom.scrollTo(140)}}),"edit"===this.type&&this.jq.cat.disable(!0),this.data.biz){var e=util.map(this.data.catList,function(t){return t.pk_id});e=util.indexOf(e,this.data.biz.fk_main_tag_id);var a=this.data.catList[e];-1!==e?this.jq.cat.setValue(e):a={pk_id:this.data.biz.fk_main_tag_id},this.switchCategory(a,function(){util.each(t.data.biz.tags,function(i){t.jq.tagBox.find('[uid="'+i.pk_id+'"]').attr("checked",!0)})}),this.elem.find(".js_state").val(this.data.biz.state.toUpperCase()),"create"===this.type?this.getElemObj().timeinfo.setValueByOrigin(this.data.biz.timeinfo):this.getElemObj().timeinfo.setValue(this.data.biz.timeinfo.unformat)}if("create"===this.type){var n=KG.user.get();n.email?n.pwd||util.dialog.showLoginAddPasswordBox():util.dialog.showLoginAddEmailAndPasswordBox()}},switchCategory:function(t,i){i=i||util.noop;var e=t.pk_id,a=this;KG.request.getAllStoreTagByCategory({catId:e},function(t,e){t&&(a.setTagHtml(e),i())})},setTagHtml:function(t){var i='{{each list as item}}<label><input type="checkbox" uid="{{item.pk_id}}" />{{item.name}}</label>{{/each}}';i=template.compile(i)({list:t}),this.jq.tagBox.html(i),this.elem.find(".js_tag").show()},getTagBoxValue:function(){var t=[];return this.jq.tagBox.find('input[type="checkbox"]').each(function(){var i=$(this);i.prop("checked")&&t.push(i.attr("uid"))}),t.join(",")}}),KG.Class.define("MybizStoreInfoFormStep2",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="hw-comp-MybizStoreInfoFormStep2">','<div class="js_dybox"></div>','<div class="js_link" role="BaseInput" data-label="店铺网址" placeholder="e.g. www.xiaofeiyang.com"></div>','<div class="js_wx" role="BaseInput" data-label="微信号" placeholder="e.g. xiaofeiyang"></div>','<div class="form-group">','<label class="lab require">店铺简介</label>','<label class="control-label hw-err"></label>','<textarea style="height: 150px;" class="form-control hw-area js_desc"></textarea>',"</div>","{{if backLink}}",'<a class="hw-btn hw-light-btn" style="border: none;font-weight: 400;padding: 0;text-align: left;" href="{{backLink}}">返回上一步</a>',"{{/if}}",'<button style="float: right;" class="js_btn hw-btn hw-blue-btn">下一步</button>',"<div>"].join("")},setJqVar:function(){return{btn:this.elem.find(".js_btn")}},getElemObj:function(){return{net:KG.component.getObj(this.elem.find(".js_link")),wechat:KG.component.getObj(this.elem.find(".js_wx")),desc:this.elem.find(".js_desc")}},initEnd:function(){this.renderDynamicBox();var t=this.getElemObj();if("edit"===this.type)t.net.setValue(this.data.biz.website),t.wechat.setValue(this.data.biz.wechat),t.desc.val(this.data.biz.briefintro),this.jq.btn.html("保存");else if("fromstorage"===util.url.hash()){var i=util.storage.get(this.__name);console.log(i),t.net.setValue(i.website),t.wechat.setValue(i.wechat),t.desc.val(i.description)}},getFormValue:function(){var t=this.getElemObj();return{bizTmpId:this.data.tmpBizId,wechat:t.wechat.getValue(),website:t.net.getValue(),description:t.desc.val()}},validate:function(t){var i=this.getElemObj();return t.description?(i.desc.parent("div.form-group").removeClass("has-error").find(".hw-err").html(""),!0):(i.desc.parent("div.form-group").addClass("has-error").find(".hw-err").html("请输入店铺简介"),!1)},initEvent:function(){var t=this;this.jq.btn.click(function(){var i=$(this),e=t.getFormValue();return e.dynamic=t.getDynamicData(),t.validate(e)?void("create"===t.type?(util.storage.set(t.__name,e),util.dom.loadingButton(i,!0),KG.request.createStoreByStep2(e,function(t,e){util.dom.loadingButton(i,!1),t?(console.log(e),location.href="createStore_3.html?tmp_biz_id="+e+"&main_tag_id="+KG.data.get("mainTagId")):alert(e)})):"edit"===t.type&&(e.bizId=t.id,delete e.bizTmpId,util.dom.loadingButton(i,!0),KG.request.saveStoreByStep2(e,function(e,a){if(util.dom.loadingButton(i,!1),e){var n={msg:'<div class="hw-icon"><i class="fa fa-check"></i></div>修改成功',YesText:"去看看",NoText:"关闭",YesFn:function(){util.path.go(util.path.store(t.id))}};util.dialog.confirm1(n)}else util.toast.showError("修改失败，请检查")}))):!1})},initStart:function(){this.type="create",KG.data.get("id")&&(this.id=KG.data.get("id"),this.type="edit")},getData:function(t,i,e){var a=this,n="";if("create"===this.type){var o=KG.data.get("tmpBizId"),s=KG.data.get("mainTagId");n="createStore.html?tmp_biz_id="+o+"&main_tag_id="+s+"#fromstorage",KG.request.getTmpStoreDynamicField({mainTagId:s},function(t,i){t?(console.log(i),e({tmpBizId:o,backLink:n,dynamic:i})):e({tmpBizId:o,backLink:n,dynamic:[]})})}else if("edit"===this.type){var l=function(){return KG.request.getBizDetailById({bizId:a.id})};KG.request.defer([l],function(t){console.log(t),KG.request.getStoreDynamicField({bizId:a.id,tagid:t.fk_main_tag_id},function(i,a){e({dynamic:a,backLink:n,biz:t})})})}},initVar:function(){this.dynamicObj={}},renderDynamicBox:function(){var t=this,i=this.data.dynamic;util.each(i,function(i){t.renderEachDynamic(i)})},getDynamicData:function(){var t={};return _.each(this.dynamicObj,function(i,e){t["dynamic_fields["+i.id+"][type]"]=i.type,t["dynamic_fields["+i.id+"][value]"]=util.isFunction(i.val)?i.val.call(i.obj):i.val}),t},renderEachDynamic:function(t){var i=this.elem.find(".js_dybox"),e="";switch(t.field_type){case"1":case"2":case"3":case"4":case"8":case"9":e='<div class="js_role" role_type="'+t.field_type+'" role="BaseInput" data-label="'+t.field_name+'" ></div>',i.append(e),this.dynamicObj[t.field_name]={obj:KG.component.initWithElement(i.find("[role_type]")),type:t.field_type,val:function(){return this.getValue()}},t.value&&this.dynamicObj[t.field_name].obj.setValue(t.value);break;case"6":e='<div class="js_role" role_type="'+t.field_type+'" data-label="'+t.field_name+'" role="BaseSelectInput" init-self="true"></div>',i.append(e);var a=_.map(t.default_option,function(t){return t.m_value}),n=KG.component.initWithElement(i.find("[role_type]"),{list:a,clickCallback:function(t){console.log(t)}});if(this.dynamicObj[t.field_name]={obj:n,type:t.field_type,val:function(){return this.getValue()}},t.value){var o=_.findIndex(a,function(i){return t.value===i});this.dynamicObj[t.field_name].obj.setValue(o)}break;case"5":e='<div class="hw-dym" param="'+t.field_id+'"><span>'+t.field_name+"</span>",_.each(t.default_option,function(i){e+='<label><input type="radio" value="'+i.m_value+'" class="radio-inline" name="'+t.field_id+'" />'+i.m_value+"</label>"}),e+="</div>",i.append(e),this.dynamicObj[t.field_name]={obj:null,type:t.field_type,val:function(){var e="";return i.find('[param="'+t.field_id+'"]').find("input").each(function(){var t=$(this);t.prop("checked")&&(e=t.val())}),e}},t.value&&i.find('input[type="radio"]').filter('[value="'+t.value+'"]').prop("checked",!0);break;case"7":e='<div class="hw-dym" param="'+t.field_id+'"><span>'+t.field_name+"</span>",_.each(t.default_option,function(i){e+='<label><input type="checkbox" value="'+i.m_value+'" class="radio-inline" name="'+t.field_id+'" />'+i.m_value+"</label>"}),e+="</div>",i.append(e),this.dynamicObj[t.field_name]={obj:null,type:t.field_type,val:function(){var e=[];return i.find('[param="'+t.field_id+'"]').find("input").each(function(){var t=$(this);t.prop("checked")&&e.push(t.val())}),e}},t.value&&_.each(t.value,function(t){i.find('input[type="checkbox"]').filter('[value="'+t+'"]').prop("checked",!0)})}this.dynamicObj[t.field_name]&&(this.dynamicObj[t.field_name].id=t.field_id)}}),KG.Class.define("UploadStoreImage",{ParentClass:"BaseUploadImage",getTemplate:function(){return["<div>",'<div class="hw-img-box">','<div style="width:100%;height:100%;" class="js_img" role="BaseLoadingImageBox" data-url="{{image}}"></div>','<b class="js_del">删除</b>',"</div>",'<button data-loading-text="正在上传..." class="hw-btn js_btn">从电脑上传图片</button>','<input type="file" />',"</div>"].join("")},defineProperty:function(){return{biztype:{defaultValue:"tmp"},bizid:{},image:{}}},getData:function(t,i,e){e({image:this.prop.image||KG["default"].storeImage})},setJqVar:function(){return{delBtn:this.elem.find(".js_del"),img:this.elem.find(".js_img"),imgObj:KG.component.getObj(this.elem.find(".js_img"))}},initEvent:function(){this.callParent("initEvent");var t=this,i=this.elem.find(".js_del");this.elem.find(".hw-img-box").hover(function(){var e=t.getImageUrl();return e&&e!==KG["default"].storeImage?void i.slideDown(200):!1},function(){i.slideUp(200)});var e=this.jq;e.delBtn.click(function(){e.imgObj.setUrl(KG["default"].storeImage)})},uploadImageFn:function(t,i){var e=this,a={};"tmp"===this.prop.biztype?(a.bizId=this.prop.bizid,a.type="tmp"):(a.type="biz",a.bizId=this.prop.bizid);var n=new FileReader;n.onload=function(t){a.image=t.target.result,KG.request.uploadTmpBizLogo(a,function(t,a){t&&(console.log(a),e.jq.imgObj.setUrl(KG.config.SiteRoot+a.files[0])),i()})},n.readAsDataURL(t)},initEnd:function(){},getImageUrl:function(){return this.jq.img.find("img").attr("src")}}),KG.Class.define("MybizUploadStoreImage",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="hw-comp-MybizUploadStoreImage">','<div class="hw-add js_add">','<i style="width:90px;height:90px;" class="icon hw-icon-plus"></i>',"<p>添加新图片</p>",'<input class="js_input" type="file" />',"</div>","</div>"].join("")},defineProperty:function(){return{type:{}}},setJqVar:function(){return{add:this.elem.find(".js_add"),fileInput:this.elem.find(".js_input")}},getData:function(t,i,e){var a=i.list;e({list:a})},initEvent:function(){var t=this;this.jq.fileInput.change(function(){var i=this.files[0];t.uploadImageFn(i,function(i,e){t.addNewImage(i,e.fileid)}),$(this).val("")});var i=t.prop.type;this.elem.on("click",".js_del",function(e){var a=$(this),n=$(this).attr("param");return util.dialog.confirm1({YesText:"删除",msg:"您确定要删除这张照片吗？",YesFn:function(e){"edit"===i?t.deleteImage(n,function(){a.parent(".js_img").remove()}):a.parent(".js_img").remove(),e()}}),!1}).on("click",".js_img",function(){return t.showBigImage($(this).find("img").attr("src")),!1})},showBigImage:function(t){var i=this.getImageList(),e=util.indexOf(i,t);util.dialog.showFocusImage(e,i)},getImageList:function(){var t=this.elem.find(".js_img");return util.map(t,function(t){var i=$(t);return i.find("img").attr("src")})},getValue:function(){return this.getImageList()},deleteImage:function(t,i){KG.request.deleteStoreImage({fileid:t,bizId:KG.data.get("id")},function(t,e){t?i():util.toast.showError(e)})},getEachHtml:function(t,i){var e=['<div class="hw-one js_img hand">','<div style="width:100%;height:100%;" role="BaseLoadingImageBox" data-url="{{url}}"></div>','<b param="'+i+'" class="js_del">删除</b>',"</div>"].join("");return template.compile(e)({url:t})},uploadImageFn:function(t,i){"edit"===this.prop.type?util.readFile(t,function(t){KG.request.uploadStoreImage({image:t,bizId:KG.data.get("id")},function(t,e){t?i(KG.config.SiteRoot+e.files[0],e):util.toast.showError(e)})}):util.readFile(t,function(t){KG.request.uploadStoreImage({image:t,bizId:util.url.param("tmp_biz_id"),type:"tmp"},function(t,e){t?i(KG.config.SiteRoot+e.files[0],e):util.toast.showError(e)})})},addNewImage:function(t,i){var e=this.getEachHtml(t,i);this.jq.add.after(e),KG.component.init(this.elem)},initEnd:function(){var t=this,i=this.data.list;util.each(i,function(i){var e=KG.config.SiteRoot+i.path;t.addNewImage(e,i.pk_id)})}}),KG.Class.define("MybizStoreInfoFormStep3",{ParentClass:"BaseComponent",getTemplate:function(){return['<div class="hw-comp-MybizStoreInfoFormStep3">',"{{if bigBgImageList}}",'<div class="form-group">','<label class="lab">选择背景图片，体现店铺风格、基调</label>','<div style="width: 700px;margin-left: -7px;">',"{{each bigBgImageList as item}}",'<div class="hw-bigimage">','<div class="js_bigimage c-box">','<img class="js_bigimage1" src={{item.url}} />','<i class="fa fa-check"></i>',"</div>",'<a href="{{item.url}}" target="_blank">查看大图</a>',"</div>","{{/each}}","</div>","</div>","{{/if}}",'<div class="form-group">','<label class="lab">店铺头像（可选）</label>','<p class="hw-img-p">店铺头像是您店铺的重要识别，建议采用店铺标识、职业头像或者主要产品的图片。</p>',"{{if tmpId}}",'<div class="hw-upload js_logo" data-biztype="tmp" init-self="true" data-bizid="{{tmpId}}" role="UploadStoreImage"></div>',"{{else}}",'<div class="hw-upload js_logo" init-self="true" data-image="{{biz | logoPath}}" data-biztype="biz" data-bizid="{{bizId}}" role="UploadStoreImage"></div>',"{{/if}}","</div>",'<div class="hw-line"></div>','<div class="form-group">','<label class="lab">上传图片（可选）</label>','<div class="js_image" data-type="'+this.type+'" role="MybizUploadStoreImage" init-self="true"></div>',"</div>",'{{if backLink}}<a class="hw-btn hw-light-btn" style="float: left;border: none;font-weight: 400;" href="{{backLink}}">返回上一步</a>{{/if}}','<button style="float: right;" class="js_btn hw-btn hw-blue-btn">{{btnText}}</button>',"</div>"].join("")},defineProperty:function(){return{type:{}}},getData:function(t,i,e){var a;if(this.type=this.prop.type,"create"===this.type){var n=KG.data.get("tmpBizId"),o=KG.data.get("mainTagId");KG.request.getStoreBigBackgroundPic({mainTagId:o},function(t,i){var s;s=t?i:null,a="createStore_2.html?tmp_biz_id="+n+"&main_tag_id="+o+"#fromstorage",e({bigBgImageList:s,backLink:a,tmpId:n,tagId:o,btnText:"完成"})})}else{KG.request.getBizDetailById({bizId:KG.data.get("id")},function(t,i){KG.request.getStoreBigBackgroundPic({mainTagId:i.fk_main_tag_id},function(t,a){var n;n=t?a:null,e({bigBgImageList:n,bizId:KG.data.get("id"),backLink:null,tagId:o,biz:i,btnText:"保存"})})})}},initStart:function(){},setJqVar:function(){return{bigImage:this.elem.find(".js_bigimage"),btn:this.elem.find(".js_btn")}},initEvent:function(){var t=this;this.jq.bigImage.click(function(i){var e=$(this);return e.hasClass("active")?!1:(t.jq.bigImage.removeClass("active"),void e.addClass("active"))}),this.jq.btn.click(function(i){var e=$(this),a=t.getFormValue();if(console.log(a),"create"===t.type){var n=t.jq.logo.getImageUrl();n&&(a.logo=n),util.dom.loadingButton(e,!0),KG.request.createStoreByStep3(a,function(t,i){util.dom.loadingButton(e,!1),t&&(util.storage.set("hw-create-store-flag",i),location.href=util.path.store(i))})}else a.bizId=t.data.bizId,util.dom.loadingButton(e,!0),KG.request.updateStoreByStep3(a,function(i,a){util.dom.loadingButton(e,!1);var n={msg:'<div class="hw-icon"><i class="fa fa-check"></i></div>修改成功',YesText:"去看看",NoText:"关闭",YesFn:function(){util.path.go(util.path.store(t.data.bizId))}};util.dialog.confirm1(n)})})},showSuccessDialog:function(t){var i='<div class="hw-icon"><i class="fa fa-check"></i></div>您的店铺已建成！';util.dialog.show({foot:!0,title:i,body:"<p>您马上就可以管理和分享您的店铺，我们会在24小时之内完成审核，将您的店铺发布到海外同城首页和文学城首页。</p>","class":"hw-confirm",YesFn:function(){var i=util.path.store(t);location.href=i},YesText:"查看我的店铺",NoFn:function(){var t="../mybiz/index.html";location.href=t},NoText:"管理我的店铺"})},initEnd:function(){var t=this;this.image=KG.component.initWithElement(this.elem.find(".js_image"),{list:this.data.biz?this.data.biz.files:[]});var i=0;t.data.biz&&(i=_.findIndex(this.data.bigBgImageList,function(i){return i.url===t.data.biz.background_pic})),this.elem.find(".js_bigimage1").eq(i).trigger("click"),this.jq.logo=KG.component.initWithElement(this.elem.find(".js_logo"),{})},getFormValue:function(){return{bizTmpId:this.data.tmpId,bgPic:this.jq.bigImage.filter(".active").find("img").attr("src"),imageList:this.image.getValue()}}});